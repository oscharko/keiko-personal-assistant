{"version":3,"mappings":"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","names":["appLogo","appServicesAuthTokenUrl","appServicesAuthTokenRefreshUrl","appServicesAuthLogoutUrl","fetchAuthSetup","response","authSetup","useLogin","requireAccessControl","enableUnauthenticatedAccess","requireLogin","msalConfig","loginRequest","tokenRequest","getRedirectUri","getAppServicesToken","checkNotExpired","appServicesToken","currentDate","getAppServicesTokenFromMe","r","json","acc","item","token","checkBetaAuthEnabled","betaAuthEnabled","isUsingAppServicesLogin","appServicesLogout","checkLoggedIn","client","getToken","error","getUsername","activeAccount","getTokenClaims","BACKEND_URI","getHeaders","idToken","betaToken","configApi","askApi","request","headers","parsedResponse","chatApi","shouldStream","url","getSpeechApi","text","blob","getCitationFilePath","citation","cleanedCitation","uploadFileApi","deleteUploadedFileApi","filename","listUploadedFilesApi","postChatHistoryApi","getChatHistoryListApi","count","continuationToken","getChatHistoryApi","id","deleteChatHistoryApi","RetrievalMode","activityTypeLabels","getStepLabel","step","isWebCitation","reference","normalizeAnswerText","answer","isStreaming","parsedAnswer","lastIndex","i","buildActivityStepMap","mapping","thoughts","thoughtWithPlan","thought","index","collectCitations","possibleCitations","citationActivityDetails","activitySteps","externalResults","parts","resolveSharePointUrl","result","urlParts","urlFilename","fragments","citationMap","citationList","part","resolvedReference","existing","backendDetail","activityId","stepMeta","activityLabel","detail","renderCitation","onCitationClicked","stepBadgeLabel","stepBadgeTitle","supElement","jsx","renderToStaticMarkup","e","path","parseAnswerToHtml","citations","fragment","AnswerIcon","Sparkle28Filled","supportedLngs","i18next","HttpApi","LanguageDetector","initReactI18next","daTranslation","enTranslation","esTranslation","frTranslation","jaTranslation","nlTranslation","ptBRTranslation","trTranslation","itTranslation","plTranslation","SpeechSynthesis","synth","getUtterance","lngCode","utterance","voice","SpeechOutputBrowser","t","i18n","useTranslation","currentLng","isPlaying","setIsPlaying","useState","startOrStopSpeech","color","IconButton","SpeechOutputAzure","speechConfig","isLoading","setIsLoading","localPlayingState","setLocalPlayingState","playAudio","speechUrl","jsxs","Fragment","Answer","isSelected","onThoughtProcessClicked","onSupportingContentClicked","onFollowupQuestionClicked","showFollowupQuestions","showSpeechOutputAzure","showSpeechOutputBrowser","followupQuestions","useMemo","sanitizedAnswerHtml","DOMPurify","copied","setCopied","handleCopy","tempElement","node","textToCopy","err","Stack","styles","ReactMarkdown","rehypeRaw","remarkGfm","isWeb","displayIndex","webEntry","w","titleOrUrl","AnswerLoading","animatedStyles","useSpring","animated","AnswerError","onRetry","ErrorCircle24Regular","PrimaryButton","useCustomSpeechRecognition","SpeechRecognition","speechRecognition","SpeechInput","updateQuestion","isRecording","setIsRecording","startRecording","event","input","stopRecording","Tooltip","Button","Mic28Filled","LoginContext","createContext","_","QuestionInput","onSend","disabled","placeholder","clearOnSend","initQuestion","showSpeechInput","question","setQuestion","loggedIn","useContext","isComposing","setIsComposing","useEffect","sendQuestion","onEnterPress","ev","handleCompositionStart","handleCompositionEnd","onQuestionChange","_ev","newValue","disableRequiredAccessControl","sendQuestionDisabled","TextField","Send28Filled","Example","value","onClick","ExampleList","onExampleClicked","useMultimodalAnswering","DEFAULT_EXAMPLES","MULTIMODAL_EXAMPLES","UserChatMessage","message","MarkdownViewer","src","content","setContent","setError","removeAnchorLinks","markdown","ancorLinksRegex","markdownText","Spinner","SpinnerSize","MessageBar","MessageBarType","Link","parseSupportingContentItem","title","SupportingContent","supportingContent","textItems","imageItems","webItems","c","ind","parsed","img","AnalysisPanelTabs","calcPercent","base","normalized","TokenUsageStackedBar","tokenUsage","labels","includeReasoning","reasoningValue","outputValue","safeOutputValue","promptValue","safeReasoningValue","promptPercent","reasoningPercent","outputPercent","minimumFlex","promptFlex","reasoningFlex","outputFlex","TokenUsageValueBar","label","tone","grouping","toneClass","groupingClass","percent","flexGrow","barStyle","TokenUsageGraph","reasoningEffort","variant","totalLabel","additionalTotals","supplementaryUsages","total_tokens","showPrimaryBars","promptLabel","reasoningLabel","outputLabel","resolvedTotalLabel","supplementary","extra","segment","SyntaxHighlighter","renderDetail","usage","search","webSearch","sharepointSearch","a11yLight","AgentPlan","queryPlan","onEffortExtracted","results","getStepQuery","getResultsForStep","stepQuery","filtered","uniqueMap","stepNumberLookup","React","lookup","iterations","planningIndices","indices","iterationsList","prePlanningSteps","planningIndex","idx","nextPlanningIndex","iterationSteps","effort","iterationIndex","headerLabel","stepId","stepNumber","stepResults","truncateImageUrl","val","ThoughtProcess","setEffort","hasAgenticPlan","k","key","pivotItemDisabledStyle","AnalysisPanel","activeTab","activeCitation","citationHeight","className","onActiveTabChanged","isDisabledThoughtProcessTab","dataPoints","isDisabledSupportingContentTab","isDisabledCitationTab","setCitation","useMsal","fetchCitation","originalHash","citationContent","citationObjectUrl","renderFileViewer","Pivot","pivotItem","PivotItem","HistoryItem","onSelect","onDelete","isModalOpen","setIsModalOpen","handleDelete","useCallback","Delete24Regular","DeleteHistoryModal","isOpen","onClose","onConfirm","DefaultButton","HistoryProviderOptions","NoneProvider","answers","IndexedDBProvider","dbName","storeName","openDB","db","cursor","loadedItems","timestamp","tx","current","CosmosDBProvider","session","useHistoryManager","provider","HISTORY_COUNT_PER_LOAD","HistoryPanel","notify","onChatSelected","historyManager","history","setHistory","hasMoreHistory","setHasMoreHistory","loadMoreHistory","items","prevHistory","handleSelect","groupedHistory","groupHistory","Panel","PanelType","group","InfiniteLoadingButton","today","yesterday","lastWeek","lastMonth","groups","itemDate","func","buttonRef","useRef","observer","entries","entry","HistoryButton","History24Regular","SettingsButton","Settings24Regular","ClearChatButton","UploadFile","isCalloutVisible","setIsCalloutVisible","isUploading","setIsUploading","deletionStatus","setDeletionStatus","uploadedFile","setUploadedFile","uploadedFileError","setUploadedFileError","uploadedFiles","setUploadedFiles","handleButtonClick","listUploadedFiles","files","handleRemoveFile","handleUploadFile","file","formData","Add24Regular","Callout","Label","Text","TokenClaimsDisplay","instance","claims","setClaims","ToString","a","o","originalKey","columns","createTableColumn","b","DataGrid","DataGridHeader","DataGridRow","renderHeaderCell","DataGridHeaderCell","DataGridBody","rowId","renderCell","DataGridCell","LanguagePicker","onLanguageChange","handleLanguageChange","option","languagePickerId","useId","LocalLanguage24Regular","Dropdown","code","details","stackTokens","labelCalloutStackStyles","iconButtonStyles","iconProps","HelpCallout","props","toggleIsCalloutVisible","useBoolean","descriptionId","iconButtonId","VectorSettings","updateRetrievalMode","updateSearchTextEmbeddings","updateSearchImageEmbeddings","showImageOptions","defaultRetrievalMode","defaultSearchTextEmbeddings","defaultSearchImageEmbeddings","retrievalMode","setRetrievalMode","searchTextEmbeddings","setSearchTextEmbeddings","searchImageEmbeddings","setSearchImageEmbeddings","onRetrievalModeChange","onSearchTextEmbeddingsChange","checked","onSearchImageEmbeddingsChange","retrievalModeId","retrievalModeFieldId","vectorFieldsId","vectorFieldsFieldId","Checkbox","Settings","promptTemplate","temperature","retrieveCount","agenticReasoningEffort","seed","minimumSearchScore","minimumRerankerScore","useSemanticRanker","useSemanticCaptions","useQueryRewriting","excludeCategory","includeCategory","sendTextSources","sendImageSources","showSemanticRankerOption","showQueryRewritingOption","showReasoningEffortOption","showMultimodalOptions","showVectorOption","onChange","streamingEnabled","useSuggestFollowupQuestions","promptTemplatePrefix","promptTemplateSuffix","showAgenticRetrievalOption","useAgenticKnowledgeBase","hideMinimalRetrievalReasoningOption","useWebSource","showWebSourceOption","useSharePointSource","showSharePointSourceOption","promptTemplateId","promptTemplateFieldId","temperatureId","temperatureFieldId","seedId","seedFieldId","agenticRetrievalId","agenticRetrievalFieldId","webSourceId","webSourceFieldId","sharePointSourceId","sharePointSourceFieldId","searchScoreId","searchScoreFieldId","rerankerScoreId","rerankerScoreFieldId","retrieveCountId","retrieveCountFieldId","agenticReasoningEffortId","agenticReasoningEffortFieldId","includeCategoryId","includeCategoryFieldId","excludeCategoryId","excludeCategoryFieldId","semanticRankerId","semanticRankerFieldId","queryRewritingFieldId","reasoningEffortFieldId","semanticCaptionsId","semanticCaptionsFieldId","shouldStreamId","shouldStreamFieldId","suggestFollowupQuestionsId","suggestFollowupQuestionsFieldId","webSourceDisablesStreamingAndFollowup","retrievalReasoningOptions","renderLabel","labelId","fieldId","helpText","Chat","isConfigPanelOpen","setIsConfigPanelOpen","isHistoryPanelOpen","setIsHistoryPanelOpen","setPromptTemplate","setTemperature","setSeed","setMinimumRerankerScore","setMinimumSearchScore","setRetrieveCount","setRetrievalReasoningEffort","setUseSemanticRanker","setUseQueryRewriting","setReasoningEffort","setStreamingEnabled","setShouldStream","previousShouldStreamRef","forcedStreamingRef","setUseSemanticCaptions","setIncludeCategory","setExcludeCategory","setUseSuggestFollowupQuestions","setSendTextSources","setSendImageSources","lastQuestionRef","chatMessageStreamEnd","setIsStreaming","setActiveCitation","activeAnalysisPanelTab","setActiveAnalysisPanelTab","selectedAnswer","setSelectedAnswer","setAnswers","streamedAnswers","setStreamedAnswers","speechUrls","setSpeechUrls","setShowMultimodalOptions","setShowSemanticRankerOption","setShowQueryRewritingOption","setShowReasoningEffortOption","setShowVectorOption","showUserUpload","setShowUserUpload","showLanguagePicker","setshowLanguagePicker","setShowSpeechInput","setShowSpeechOutputBrowser","setShowSpeechOutputAzure","showChatHistoryBrowser","setShowChatHistoryBrowser","showChatHistoryCosmos","setShowChatHistoryCosmos","setShowAgenticRetrievalOption","webSourceSupported","setWebSourceSupported","webSourceEnabled","setWebSourceEnabled","sharePointSourceSupported","setSharePointSourceSupported","sharePointSourceEnabled","setSharePointSourceEnabled","setUseAgenticRetrieval","setHideMinimalRetrievalReasoningOption","streamingDisabledByOverrides","audio","getConfig","config","defaultRetrievalEffort","handleAsyncRequest","responseBody","askResponse","updateState","newContent","resolve","latestResponse","readNDJSONStream","historyProvider","updateStreamingPreference","isStreamingEnabledOverride","disablesStreamingOverride","desiredShouldStream","makeApiRequest","clearChat","handleSettingsChange","field","normalizedShouldStream","effectiveWebSource","normalizedWebSource","example","onShowCitation","onToggleTab","tab","Helmet","streamedAnswer","q","newLang","x","LoginButton","setLoggedIn","username","setUsername","handleLoginPopup","handleLogoutPopup","Layout","menuOpen","setMenuOpen","isBetaAuth","setIsBetaAuth","menuRef","data","handleLogout","toggleMenu","handleClickOutside","NavLink","isActive","Outlet","LayoutWrapper","mounted","isLoggedIn","BetaLogin","onLoginSuccess","password","setPassword","handleLogin","errorData","handleKeyPress","BetaAuthWrapper","children","isAuthenticated","setIsAuthenticated","setBetaAuthEnabled","checkBetaAuth","handleLoginSuccess","initializeIcons","router","createHashRouter","__vitePreload","root","ReactDOM","msalInstance","PublicClientApplication","EventType","appTree","I18nextProvider","HelmetProvider","MsalProvider","RouterProvider"],"ignoreList":[],"sources":["../../../frontend/src/assets/applogo.svg","../../../frontend/src/authConfig.ts","../../../frontend/src/api/api.ts","../../../frontend/src/api/models.ts","../../../frontend/src/components/AnalysisPanel/agentPlanUtils.ts","../../../frontend/src/components/Answer/AnswerParser.tsx","../../../frontend/src/components/Answer/AnswerIcon.tsx","../../../frontend/src/i18n/config.ts","../../../frontend/src/components/Answer/SpeechOutputBrowser.tsx","../../../frontend/src/components/Answer/SpeechOutputAzure.tsx","../../../frontend/src/components/Answer/Answer.tsx","../../../frontend/src/components/Answer/AnswerLoading.tsx","../../../frontend/src/components/Answer/AnswerError.tsx","../../../frontend/src/components/QuestionInput/SpeechInput.tsx","../../../frontend/src/loginContext.tsx","../../../frontend/src/components/QuestionInput/QuestionInput.tsx","../../../frontend/src/components/Example/Example.tsx","../../../frontend/src/components/Example/ExampleList.tsx","../../../frontend/src/components/UserChatMessage/UserChatMessage.tsx","../../../frontend/src/components/MarkdownViewer/MarkdownViewer.tsx","../../../frontend/src/components/SupportingContent/SupportingContentParser.ts","../../../frontend/src/components/SupportingContent/SupportingContent.tsx","../../../frontend/src/components/AnalysisPanel/AnalysisPanelTabs.tsx","../../../frontend/src/components/AnalysisPanel/TokenUsageGraph.tsx","../../../frontend/src/components/AnalysisPanel/AgentPlan.tsx","../../../frontend/src/components/AnalysisPanel/ThoughtProcess.tsx","../../../frontend/src/components/AnalysisPanel/AnalysisPanel.tsx","../../../frontend/src/components/HistoryItem/HistoryItem.tsx","../../../frontend/src/components/HistoryProviders/IProvider.ts","../../../frontend/src/components/HistoryProviders/None.ts","../../../frontend/src/components/HistoryProviders/IndexedDB.ts","../../../frontend/src/components/HistoryProviders/CosmosDB.ts","../../../frontend/src/components/HistoryProviders/HistoryManager.ts","../../../frontend/src/components/HistoryPanel/HistoryPanel.tsx","../../../frontend/src/components/HistoryButton/HistoryButton.tsx","../../../frontend/src/components/SettingsButton/SettingsButton.tsx","../../../frontend/src/components/ClearChatButton/ClearChatButton.tsx","../../../frontend/src/components/UploadFile/UploadFile.tsx","../../../frontend/src/components/TokenClaimsDisplay/TokenClaimsDisplay.tsx","../../../frontend/src/i18n/LanguagePicker.tsx","../../../frontend/src/components/HelpCallout/HelpCallout.tsx","../../../frontend/src/components/VectorSettings/VectorSettings.tsx","../../../frontend/src/components/Settings/Settings.tsx","../../../frontend/src/pages/chat/Chat.tsx","../../../frontend/src/components/LoginButton/LoginButton.tsx","../../../frontend/src/pages/layout/Layout.tsx","../../../frontend/src/layoutWrapper.tsx","../../../frontend/src/components/BetaLogin/BetaLogin.tsx","../../../frontend/src/components/BetaAuthWrapper/BetaAuthWrapper.tsx","../../../frontend/src/index.tsx"],"sourcesContent":["export default \"data:image/svg+xml,%3csvg%20font-size='120px'%20aria-hidden='true'%20aria-label='Chat%20logo'%20fill='rgba(115,%20118,%20225,%201)'%20class='___12fm75w%20f1w7gpdv%20fez10in%20fg4l7m0'%20role='img'%20width='1em'%20height='1em'%20viewBox='0%200%2020%2020'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M7.4%2012.8a1.04%201.04%200%200%200%201.59-.51l.45-1.37a2.34%202.34%200%200%201%201.47-1.48l1.4-.45A1.04%201.04%200%200%200%2012.25%207l-1.37-.45A2.34%202.34%200%200%201%209.4%205.08L8.95%203.7a1.03%201.03%200%200%200-.82-.68%201.04%201.04%200%200%200-1.15.7l-.46%201.4a2.34%202.34%200%200%201-1.44%201.45L3.7%207a1.04%201.04%200%200%200%20.02%201.97l1.37.45a2.33%202.33%200%200%201%201.48%201.48l.46%201.4c.07.2.2.37.38.5Zm6.14%204.05a.8.8%200%200%200%201.22-.4l.25-.76a1.09%201.09%200%200%201%20.68-.68l.77-.25a.8.8%200%200%200-.02-1.52l-.77-.25a1.08%201.08%200%200%201-.68-.68l-.25-.77a.8.8%200%200%200-1.52.01l-.24.76a1.1%201.1%200%200%201-.67.68l-.77.25a.8.8%200%200%200%200%201.52l.77.25a1.09%201.09%200%200%201%20.68.68l.25.77c.06.16.16.3.3.4Z'%20fill='rgba(115,%20118,%20225,%201)'%3e%3c/path%3e%3c/svg%3e\"","// Refactored from https://github.com/Azure-Samples/ms-identity-javascript-react-tutorial/blob/main/1-Authentication/1-sign-in/SPA/src/authConfig.js\n\nimport { IPublicClientApplication } from \"@azure/msal-browser\";\n\nconst appServicesAuthTokenUrl = \".auth/me\";\nconst appServicesAuthTokenRefreshUrl = \".auth/refresh\";\nconst appServicesAuthLogoutUrl = \".auth/logout?post_logout_redirect_uri=/\";\n\ninterface AppServicesToken {\n    id_token: string;\n    access_token: string;\n    user_claims: Record<string, any>;\n    expires_on: string;\n}\n\ninterface AuthSetup {\n    // Set to true if login elements should be shown in the UI\n    useLogin: boolean;\n    // Set to true if access control is enforced by the application\n    requireAccessControl: boolean;\n    // Set to true if the application allows unauthenticated access (only applies for documents without access control)\n    enableUnauthenticatedAccess: boolean;\n    /**\n     * Configuration object to be passed to MSAL instance on creation.\n     * For a full list of MSAL.js configuration parameters, visit:\n     * https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/configuration.md\n     */\n    msalConfig: {\n        auth: {\n            clientId: string; // Client app id used for login\n            authority: string; // Directory to use for login https://learn.microsoft.com/entra/identity-platform/msal-client-application-configuration#authority\n            redirectUri: string; // Points to window.location.origin. You must register this URI on Azure Portal/App Registration.\n            postLogoutRedirectUri: string; // Indicates the page to navigate after logout.\n            navigateToLoginRequestUrl: boolean; // If \"true\", will navigate back to the original request location before processing the auth code response.\n        };\n        cache: {\n            cacheLocation: string; // Configures cache location. \"sessionStorage\" is more secure, but \"localStorage\" gives you SSO between tabs.\n            storeAuthStateInCookie: boolean; // Set this to \"true\" if you are having issues on IE11 or Edge\n        };\n    };\n    loginRequest: {\n        /**\n         * Scopes you add here will be prompted for user consent during sign-in.\n         * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\n         * For more information about OIDC scopes, visit:\n         * https://learn.microsoft.com/entra/identity-platform/permissions-consent-overview#openid-connect-scopes\n         */\n        scopes: Array<string>;\n    };\n    tokenRequest: {\n        scopes: Array<string>;\n    };\n}\n\n// Fetch the auth setup JSON data from the API if not already cached\nasync function fetchAuthSetup(): Promise<AuthSetup> {\n    const response = await fetch(\"/auth_setup\");\n    if (!response.ok) {\n        throw new Error(`auth setup response was not ok: ${response.status}`);\n    }\n    return await response.json();\n}\n\nconst authSetup = await fetchAuthSetup();\n\nexport const useLogin = authSetup.useLogin;\n\nexport const requireAccessControl = authSetup.requireAccessControl;\n\nexport const enableUnauthenticatedAccess = authSetup.enableUnauthenticatedAccess;\n\nexport const requireLogin = requireAccessControl && !enableUnauthenticatedAccess;\n\n/**\n * Configuration object to be passed to MSAL instance on creation.\n * For a full list of MSAL.js configuration parameters, visit:\n * https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/configuration.md\n */\nexport const msalConfig = authSetup.msalConfig;\n\n/**\n * Scopes you add here will be prompted for user consent during sign-in.\n * By default, MSAL.js will add OIDC scopes (openid, profile, email) to any login request.\n * For more information about OIDC scopes, visit:\n * https://learn.microsoft.com/entra/identity-platform/permissions-consent-overview#openid-connect-scopes\n */\nexport const loginRequest = authSetup.loginRequest;\n\nconst tokenRequest = authSetup.tokenRequest;\n\n// Build an absolute redirect URI using the current window's location and the relative redirect URI from auth setup\nexport const getRedirectUri = () => {\n    return window.location.origin + authSetup.msalConfig.auth.redirectUri;\n};\n\n// Cache the app services token if it's available\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/this#global_context\ndeclare global {\n    var cachedAppServicesToken: AppServicesToken | null;\n}\nglobalThis.cachedAppServicesToken = null;\n\n/**\n * Retrieves an access token if the user is logged in using app services authentication.\n * Checks if the current token is expired and fetches a new token if necessary.\n * Returns null if the app doesn't support app services authentication.\n *\n * @returns {Promise<AppServicesToken | null>} A promise that resolves to an AppServicesToken if the user is authenticated, or null if authentication is not supported or fails.\n */\nconst getAppServicesToken = (): Promise<AppServicesToken | null> => {\n    const checkNotExpired = (appServicesToken: AppServicesToken) => {\n        const currentDate = new Date();\n        const expiresOnDate = new Date(appServicesToken.expires_on);\n        return expiresOnDate > currentDate;\n    };\n\n    if (globalThis.cachedAppServicesToken && checkNotExpired(globalThis.cachedAppServicesToken)) {\n        return Promise.resolve(globalThis.cachedAppServicesToken);\n    }\n\n    const getAppServicesTokenFromMe: () => Promise<AppServicesToken | null> = () => {\n        return fetch(appServicesAuthTokenUrl)\n            .then(r => {\n                if (r.ok) {\n                    return r.json().then(json => {\n                        if (json.length > 0) {\n                            return {\n                                id_token: json[0][\"id_token\"] as string,\n                                access_token: json[0][\"access_token\"] as string,\n                                user_claims: json[0][\"user_claims\"].reduce((acc: Record<string, any>, item: Record<string, any>) => {\n                                    acc[item.typ] = item.val;\n                                    return acc;\n                                }, {}) as Record<string, any>,\n                                expires_on: json[0][\"expires_on\"] as string\n                            } as AppServicesToken;\n                        }\n\n                        return null;\n                    });\n                }\n\n                return null;\n            })\n            .catch(() => null); // Prevent console errors when beta auth is enabled\n    };\n\n    return getAppServicesTokenFromMe().then(token => {\n        if (token) {\n            if (checkNotExpired(token)) {\n                globalThis.cachedAppServicesToken = token;\n                return token;\n            }\n\n            return fetch(appServicesAuthTokenRefreshUrl).then(r => {\n                if (r.ok) {\n                    return getAppServicesTokenFromMe();\n                }\n                return null;\n            });\n        }\n\n        return null;\n    });\n};\n\n// Check if beta auth is enabled first, then check for app services login\nconst checkBetaAuthEnabled = async (): Promise<boolean> => {\n    try {\n        const response = await fetch(\"/auth/status\");\n        if (response.ok) {\n            const data = await response.json();\n            return data.betaAuthEnabled || false;\n        }\n    } catch {\n        // Ignore errors\n    }\n    return false;\n};\n\nconst betaAuthEnabled = await checkBetaAuthEnabled();\nexport const isUsingAppServicesLogin = betaAuthEnabled ? false : (await getAppServicesToken()) != null;\n\n// Sign out of app services\n// Learn more at https://learn.microsoft.com/azure/app-service/configure-authentication-customize-sign-in-out#sign-out-of-a-session\nexport const appServicesLogout = () => {\n    window.location.href = appServicesAuthLogoutUrl;\n};\n\n/**\n * Determines if the user is logged in either via the MSAL public client application or the app services login.\n * @param {IPublicClientApplication | undefined} client - The MSAL public client application instance, or undefined if not available.\n * @returns {Promise<boolean>} A promise that resolves to true if the user is logged in, false otherwise.\n */\nexport const checkLoggedIn = async (client: IPublicClientApplication | undefined): Promise<boolean> => {\n    if (client) {\n        const activeAccount = client.getActiveAccount();\n        if (activeAccount) {\n            return true;\n        }\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return true;\n    }\n\n    return false;\n};\n\n// Get an access token for use with the API server.\n// ID token received when logging in may not be used for this purpose because it has the incorrect audience\n// Use the access token from app services login if available\nexport const getToken = async (client: IPublicClientApplication): Promise<string | undefined> => {\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return Promise.resolve(appServicesToken.access_token);\n    }\n\n    return client\n        .acquireTokenSilent({\n            ...tokenRequest,\n            redirectUri: getRedirectUri()\n        })\n        .then(r => r.accessToken)\n        .catch(error => {\n            console.log(error);\n            return undefined;\n        });\n};\n\n/**\n * Retrieves the username of the active account.\n * If no active account is found, attempts to retrieve the username from the app services login token if available.\n * @param {IPublicClientApplication} client - The MSAL public client application instance.\n * @returns {Promise<string | null>} The username of the active account, or null if no username is found.\n */\nexport const getUsername = async (client: IPublicClientApplication): Promise<string | null> => {\n    const activeAccount = client.getActiveAccount();\n    if (activeAccount) {\n        return activeAccount.username;\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken?.user_claims) {\n        return appServicesToken.user_claims.preferred_username;\n    }\n\n    return null;\n};\n\n/**\n * Retrieves the token claims of the active account.\n * If no active account is found, attempts to retrieve the token claims from the app services login token if available.\n * @param {IPublicClientApplication} client - The MSAL public client application instance.\n * @returns {Promise<Record<string, unknown> | undefined>} A promise that resolves to the token claims of the active account, the user claims from the app services login token, or undefined if no claims are found.\n */\nexport const getTokenClaims = async (client: IPublicClientApplication): Promise<Record<string, unknown> | undefined> => {\n    const activeAccount = client.getActiveAccount();\n    if (activeAccount) {\n        return activeAccount.idTokenClaims;\n    }\n\n    const appServicesToken = await getAppServicesToken();\n    if (appServicesToken) {\n        return appServicesToken.user_claims;\n    }\n\n    return undefined;\n};\n","const BACKEND_URI = \"\";\n\nimport { ChatAppResponse, ChatAppResponseOrError, ChatAppRequest, Config, SimpleAPIResponse, HistoryListApiResponse, HistoryApiResponse } from \"./models\";\nimport { useLogin, getToken, isUsingAppServicesLogin } from \"../authConfig\";\n\nexport async function getHeaders(idToken: string | undefined): Promise<Record<string, string>> {\n    // Check for beta auth token first\n    const betaToken = localStorage.getItem(\"beta_auth_token\");\n    if (betaToken) {\n        return { Authorization: `Bearer ${betaToken}` };\n    }\n\n    // If using login and not using app services, add the id token of the logged in account as the authorization\n    if (useLogin && !isUsingAppServicesLogin) {\n        if (idToken) {\n            return { Authorization: `Bearer ${idToken}` };\n        }\n    }\n\n    return {};\n}\n\nexport async function configApi(): Promise<Config> {\n    const response = await fetch(`${BACKEND_URI}/config`, {\n        method: \"GET\"\n    });\n\n    return (await response.json()) as Config;\n}\n\nexport async function askApi(request: ChatAppRequest, idToken: string | undefined): Promise<ChatAppResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`${BACKEND_URI}/ask`, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(request)\n    });\n\n    if (response.status > 299 || !response.ok) {\n        throw Error(`Request failed with status ${response.status}`);\n    }\n    const parsedResponse: ChatAppResponseOrError = await response.json();\n    if (parsedResponse.error) {\n        throw Error(parsedResponse.error);\n    }\n\n    return parsedResponse as ChatAppResponse;\n}\n\nexport async function chatApi(request: ChatAppRequest, shouldStream: boolean, idToken: string | undefined): Promise<Response> {\n    let url = `${BACKEND_URI}/chat`;\n    if (shouldStream) {\n        url += \"/stream\";\n    }\n    const headers = await getHeaders(idToken);\n    return await fetch(url, {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(request)\n    });\n}\n\nexport async function getSpeechApi(text: string): Promise<string | null> {\n    return await fetch(\"/speech\", {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n            text: text\n        })\n    })\n        .then(response => {\n            if (response.status == 200) {\n                return response.blob();\n            } else if (response.status == 400) {\n                console.log(\"Speech synthesis is not enabled.\");\n                return null;\n            } else {\n                console.error(\"Unable to get speech synthesis.\");\n                return null;\n            }\n        })\n        .then(blob => (blob ? URL.createObjectURL(blob) : null));\n}\n\nexport function getCitationFilePath(citation: string): string {\n    // If there are parentheses at end of citation, remove part in parentheses\n    const cleanedCitation = citation.replace(/\\s*\\(.*?\\)\\s*$/, \"\").trim();\n    return `${BACKEND_URI}/content/${cleanedCitation}`;\n}\n\nexport async function uploadFileApi(request: FormData, idToken: string): Promise<SimpleAPIResponse> {\n    const response = await fetch(\"/upload\", {\n        method: \"POST\",\n        headers: await getHeaders(idToken),\n        body: request\n    });\n\n    if (!response.ok) {\n        throw new Error(`Uploading files failed: ${response.statusText}`);\n    }\n\n    const dataResponse: SimpleAPIResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function deleteUploadedFileApi(filename: string, idToken: string): Promise<SimpleAPIResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(\"/delete_uploaded\", {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ filename })\n    });\n\n    if (!response.ok) {\n        throw new Error(`Deleting file failed: ${response.statusText}`);\n    }\n\n    const dataResponse: SimpleAPIResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function listUploadedFilesApi(idToken: string): Promise<string[]> {\n    const response = await fetch(`/list_uploaded`, {\n        method: \"GET\",\n        headers: await getHeaders(idToken)\n    });\n\n    if (!response.ok) {\n        throw new Error(`Listing files failed: ${response.statusText}`);\n    }\n\n    const dataResponse: string[] = await response.json();\n    return dataResponse;\n}\n\nexport async function postChatHistoryApi(item: any, idToken: string): Promise<any> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(\"/chat_history\", {\n        method: \"POST\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(item)\n    });\n\n    if (!response.ok) {\n        throw new Error(`Posting chat history failed: ${response.statusText}`);\n    }\n\n    const dataResponse: any = await response.json();\n    return dataResponse;\n}\n\nexport async function getChatHistoryListApi(count: number, continuationToken: string | undefined, idToken: string): Promise<HistoryListApiResponse> {\n    const headers = await getHeaders(idToken);\n    let url = `${BACKEND_URI}/chat_history/sessions?count=${count}`;\n    if (continuationToken) {\n        url += `&continuationToken=${continuationToken}`;\n    }\n\n    const response = await fetch(url.toString(), {\n        method: \"GET\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Getting chat histories failed: ${response.statusText}`);\n    }\n\n    const dataResponse: HistoryListApiResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function getChatHistoryApi(id: string, idToken: string): Promise<HistoryApiResponse> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`/chat_history/sessions/${id}`, {\n        method: \"GET\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Getting chat history failed: ${response.statusText}`);\n    }\n\n    const dataResponse: HistoryApiResponse = await response.json();\n    return dataResponse;\n}\n\nexport async function deleteChatHistoryApi(id: string, idToken: string): Promise<any> {\n    const headers = await getHeaders(idToken);\n    const response = await fetch(`/chat_history/sessions/${id}`, {\n        method: \"DELETE\",\n        headers: { ...headers, \"Content-Type\": \"application/json\" }\n    });\n\n    if (!response.ok) {\n        throw new Error(`Deleting chat history failed: ${response.statusText}`);\n    }\n}\n","export const enum RetrievalMode {\n    Hybrid = \"hybrid\",\n    Vectors = \"vectors\",\n    Text = \"text\"\n}\n\nexport type ChatAppRequestOverrides = {\n    retrieval_mode?: RetrievalMode;\n    semantic_ranker?: boolean;\n    semantic_captions?: boolean;\n    query_rewriting?: boolean;\n    reasoning_effort?: string;\n    include_category?: string;\n    exclude_category?: string;\n    seed?: number;\n    top?: number;\n    retrieval_reasoning_effort?: string;\n    temperature?: number;\n    minimum_search_score?: number;\n    minimum_reranker_score?: number;\n    prompt_template?: string;\n    prompt_template_prefix?: string;\n    prompt_template_suffix?: string;\n    suggest_followup_questions?: boolean;\n    send_text_sources: boolean;\n    send_image_sources: boolean;\n    search_text_embeddings: boolean;\n    search_image_embeddings: boolean;\n    language: string;\n    use_agentic_knowledgebase: boolean;\n    use_web_source?: boolean;\n    use_sharepoint_source?: boolean;\n};\n\nexport type ResponseMessage = {\n    content: string;\n    role: string;\n};\n\nexport type Thoughts = {\n    title: string;\n    description: any; // It can be any output from the api\n    props?: { [key: string]: any };\n};\n\nexport type ActivityDetail = {\n    id?: number;\n    number?: number;\n    type?: string;\n    label?: string;\n    source?: string;\n    query?: string;\n};\n\nexport type ExternalResultMetadata = {\n    id?: string;\n    title?: string;\n    url?: string;\n    snippet?: string;\n    activity?: ActivityDetail;\n};\n\nexport type CitationActivityDetail = {\n    id?: string;\n    number?: number;\n    type?: string;\n    source?: string;\n    query?: string;\n};\n\nexport type DataPoints = {\n    text: string[];\n    images: string[];\n    citations: string[];\n    citation_activity_details?: Record<string, CitationActivityDetail>;\n    external_results_metadata?: ExternalResultMetadata[];\n};\n\nexport type ResponseContext = {\n    data_points: DataPoints;\n    followup_questions: string[] | null;\n    thoughts: Thoughts[];\n    answer?: string;\n};\n\nexport type ChatAppResponseOrError = {\n    message: ResponseMessage;\n    delta: ResponseMessage;\n    context: ResponseContext;\n    session_state: any;\n    error?: string;\n};\n\nexport type ChatAppResponse = {\n    message: ResponseMessage;\n    delta: ResponseMessage;\n    context: ResponseContext;\n    session_state: any;\n};\n\nexport type ChatAppRequestContext = {\n    overrides?: ChatAppRequestOverrides;\n};\n\nexport type ChatAppRequest = {\n    messages: ResponseMessage[];\n    context?: ChatAppRequestContext;\n    session_state: any;\n};\n\nexport type Config = {\n    defaultReasoningEffort: string;\n    defaultRetrievalReasoningEffort: string;\n    showMultimodalOptions: boolean;\n    showSemanticRankerOption: boolean;\n    showQueryRewritingOption: boolean;\n    showReasoningEffortOption: boolean;\n    streamingEnabled: boolean;\n    showVectorOption: boolean;\n    showUserUpload: boolean;\n    showLanguagePicker: boolean;\n    showSpeechInput: boolean;\n    showSpeechOutputBrowser: boolean;\n    showSpeechOutputAzure: boolean;\n    showChatHistoryBrowser: boolean;\n    showChatHistoryCosmos: boolean;\n    showAgenticRetrievalOption: boolean;\n    ragSearchTextEmbeddings: boolean;\n    ragSearchImageEmbeddings: boolean;\n    ragSendTextSources: boolean;\n    ragSendImageSources: boolean;\n    webSourceEnabled: boolean;\n    sharepointSourceEnabled: boolean;\n};\n\nexport type SimpleAPIResponse = {\n    message?: string;\n};\n\nexport interface SpeechConfig {\n    speechUrls: (string | null)[];\n    setSpeechUrls: (urls: (string | null)[]) => void;\n    audio: HTMLAudioElement;\n    isPlaying: boolean;\n    setIsPlaying: (isPlaying: boolean) => void;\n}\n\nexport type HistoryListApiResponse = {\n    sessions: {\n        id: string;\n        entra_oid: string;\n        title: string;\n        timestamp: number;\n    }[];\n    continuation_token?: string;\n};\n\nexport type HistoryApiResponse = {\n    id: string;\n    entra_oid: string;\n    answers: any;\n};\n","export type QueryPlanStep = {\n    id: number | string;\n    type: string;\n    label?: string;\n    elapsed_ms?: number;\n    knowledge_source_name?: string;\n    search_index_arguments?: {\n        search?: string;\n        search_fields?: string[];\n        semantic_configuration_name?: string;\n        source_data_fields?: { name?: string }[];\n    };\n    web_arguments?: {\n        search?: string;\n    };\n    remote_share_point_arguments?: {\n        search?: string;\n    };\n    query_time?: string;\n    count?: number;\n    input_tokens?: number;\n    output_tokens?: number;\n    reasoning_tokens?: number;\n    retrieval_reasoning_effort?: {\n        kind?: string;\n    };\n    [key: string]: unknown;\n};\n\nexport const activityTypeLabels: Record<string, string> = {\n    modelQueryPlanning: \"Query planning\",\n    searchIndex: \"Index search\",\n    web: \"Web search\",\n    remoteSharePoint: \"SharePoint search\",\n    agenticReasoning: \"Agentic reasoning\",\n    modelAnswerSynthesis: \"Answer synthesis\"\n};\n\nexport function getStepLabel(step: QueryPlanStep): string {\n    return step.label || activityTypeLabels[step.type] || step.type;\n}\n","import { renderToStaticMarkup } from \"react-dom/server\";\nimport { ChatAppResponse, getCitationFilePath } from \"../../api\";\nimport { QueryPlanStep, getStepLabel, activityTypeLabels } from \"../AnalysisPanel/agentPlanUtils\";\n\nexport type CitationDetail = {\n    reference: string;\n    index: number;\n    isWeb: boolean;\n    activityId?: string;\n    stepNumber?: number;\n    stepLabel?: string;\n    stepSource?: string;\n};\n\ntype CitationFragment =\n    | { type: \"text\"; value: string }\n    | {\n          type: \"citation\";\n          detail: CitationDetail;\n      };\n\ntype ActivityStepMeta = {\n    stepNumber: number;\n    stepLabel: string;\n};\n\ntype HtmlParsedAnswer = {\n    answerHtml: string;\n    citations: CitationDetail[];\n};\n\nconst isWebCitation = (reference: string) => reference.startsWith(\"http://\") || reference.startsWith(\"https://\");\n\nconst normalizeAnswerText = (answer: ChatAppResponse, isStreaming: boolean): string => {\n    let parsedAnswer = answer.message.content.trim();\n\n    if (isStreaming) {\n        let lastIndex = parsedAnswer.length;\n        for (let i = parsedAnswer.length - 1; i >= 0; i--) {\n            if (parsedAnswer[i] === \"]\") {\n                break;\n            } else if (parsedAnswer[i] === \"[\") {\n                lastIndex = i;\n                break;\n            }\n        }\n        parsedAnswer = parsedAnswer.substring(0, lastIndex);\n    }\n\n    return parsedAnswer;\n};\n\nconst buildActivityStepMap = (answer: ChatAppResponse): Record<string, ActivityStepMeta> => {\n    const mapping: Record<string, ActivityStepMeta> = {};\n    const thoughts = answer.context?.thoughts;\n    if (!Array.isArray(thoughts)) {\n        return mapping;\n    }\n\n    const thoughtWithPlan = thoughts.find(thought => Array.isArray(thought.props?.query_plan));\n    if (!thoughtWithPlan) {\n        return mapping;\n    }\n\n    const planSteps = (thoughtWithPlan.props?.query_plan as QueryPlanStep[]) ?? [];\n    planSteps.forEach((step, index) => {\n        if (step && step.id !== undefined && step.id !== null) {\n            mapping[String(step.id)] = {\n                stepNumber: index + 1,\n                stepLabel: getStepLabel(step)\n            };\n        }\n    });\n\n    return mapping;\n};\n\nconst collectCitations = (answer: ChatAppResponse, isStreaming: boolean): { fragments: CitationFragment[]; citations: CitationDetail[] } => {\n    const possibleCitations = answer.context.data_points.citations || [];\n    const citationActivityDetails = answer.context.data_points.citation_activity_details ?? {};\n    const activitySteps = buildActivityStepMap(answer);\n    const externalResults = answer.context.data_points.external_results_metadata || [];\n    const parsedAnswer = normalizeAnswerText(answer, isStreaming);\n    const parts = parsedAnswer.split(/\\[([^\\]]+)\\]/g);\n\n    // Helper to resolve SharePoint filename to URL\n    const resolveSharePointUrl = (citation: string): string => {\n        // If it's already a URL, return as-is\n        if (isWebCitation(citation)) {\n            return citation;\n        }\n        // Check if this looks like a filename (has an extension)\n        const hasFileExtension = /\\.(pdf|docx?|xlsx?|pptx?|txt|html?|csv)$/i.test(citation);\n        if (!hasFileExtension) {\n            return citation;\n        }\n\n        // Look for matching SharePoint URL in external_results_metadata\n        // Match by checking if the URL ends with the filename\n        const matchingResult = externalResults.find(result => {\n            if (!result.url) return false;\n            const urlParts = result.url.split(\"/\");\n            const urlFilename = urlParts[urlParts.length - 1];\n            return urlFilename === citation || decodeURIComponent(urlFilename) === citation;\n        });\n\n        return matchingResult?.url || citation;\n    };\n\n    const fragments: CitationFragment[] = [];\n    const citationMap = new Map<string, CitationDetail>();\n    const citationList: CitationDetail[] = [];\n\n    parts.forEach((part, index) => {\n        if (index % 2 === 0) {\n            fragments.push({ type: \"text\", value: part });\n            return;\n        }\n\n        const isValidCitation = possibleCitations.some(citation => citation.endsWith(part));\n        if (!isValidCitation) {\n            fragments.push({ type: \"text\", value: `[${part}]` });\n            return;\n        }\n\n        // Resolve SharePoint filename to URL if applicable\n        const resolvedReference = resolveSharePointUrl(part);\n\n        // Check if this resolved reference already exists\n        const existing = citationMap.get(resolvedReference);\n        if (existing) {\n            fragments.push({ type: \"citation\", detail: existing });\n            return;\n        }\n\n        const backendDetail = citationActivityDetails?.[part];\n        const activityId = backendDetail?.id;\n        const stepMeta = activityId ? activitySteps[String(activityId)] : undefined;\n\n        // Get label from backend type using our mapping, or fallback to stepMeta\n        const activityLabel = backendDetail?.type ? activityTypeLabels[backendDetail.type] || backendDetail.type : undefined;\n\n        const detail: CitationDetail = {\n            reference: resolvedReference,\n            index: citationList.length + 1,\n            isWeb: isWebCitation(resolvedReference),\n            activityId: activityId !== undefined ? String(activityId) : undefined,\n            stepNumber: backendDetail?.number ?? stepMeta?.stepNumber,\n            stepLabel: activityLabel ?? stepMeta?.stepLabel,\n            stepSource: backendDetail?.source\n        };\n\n        citationMap.set(resolvedReference, detail);\n        citationList.push(detail);\n        fragments.push({ type: \"citation\", detail });\n    });\n\n    return { fragments, citations: citationList };\n};\n\nconst renderCitation = (detail: CitationDetail, onCitationClicked: (citationFilePath: string) => void) => {\n    const stepBadgeLabel = detail.stepSource ?? detail.stepLabel;\n    const stepBadgeTitle =\n        detail.stepNumber !== undefined\n            ? `Linked to Step ${detail.stepNumber}${detail.stepLabel ? `: ${detail.stepLabel}` : \"\"}${detail.stepSource ? ` (${detail.stepSource})` : \"\"}`\n            : stepBadgeLabel\n              ? `Linked to ${stepBadgeLabel}`\n              : undefined;\n    const supElement = <sup title={stepBadgeTitle ?? undefined}>{detail.index}</sup>;\n\n    if (detail.isWeb) {\n        return renderToStaticMarkup(\n            <span className=\"citationBadgeContainer\">\n                <a\n                    className=\"supContainer\"\n                    title={detail.reference}\n                    href={detail.reference}\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    onClick={e => e.stopPropagation()}\n                >\n                    {supElement}\n                </a>\n            </span>\n        );\n    }\n\n    const path = getCitationFilePath(detail.reference);\n    return renderToStaticMarkup(\n        <span className=\"citationBadgeContainer\">\n            <a\n                className=\"supContainer\"\n                title={detail.reference}\n                onClick={e => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    onCitationClicked(path);\n                }}\n            >\n                {supElement}\n            </a>\n        </span>\n    );\n};\n\nexport function parseAnswerToHtml(answer: ChatAppResponse, isStreaming: boolean, onCitationClicked: (citationFilePath: string) => void): HtmlParsedAnswer {\n    const { fragments, citations } = collectCitations(answer, isStreaming);\n    const answerHtml = fragments.map(fragment => (fragment.type === \"text\" ? fragment.value : renderCitation(fragment.detail, onCitationClicked))).join(\"\");\n\n    return {\n        answerHtml,\n        citations\n    };\n}\n\nexport function extractCitationDetails(answer: ChatAppResponse, isStreaming = false): CitationDetail[] {\n    return collectCitations(answer, isStreaming).citations;\n}\n","import { Sparkle28Filled } from \"@fluentui/react-icons\";\n\nexport const AnswerIcon = () => {\n    return <Sparkle28Filled primaryFill={\"rgba(115, 118, 225, 1)\"} aria-hidden=\"true\" aria-label=\"Answer logo\" />;\n};\n","import i18next from \"i18next\";\nimport LanguageDetector from \"i18next-browser-languagedetector\";\nimport HttpApi from \"i18next-http-backend\";\nimport { initReactI18next } from \"react-i18next\";\n\nimport daTranslation from \"../locales/da/translation.json\";\nimport enTranslation from \"../locales/en/translation.json\";\nimport esTranslation from \"../locales/es/translation.json\";\nimport frTranslation from \"../locales/fr/translation.json\";\nimport jaTranslation from \"../locales/ja/translation.json\";\nimport nlTranslation from \"../locales/nl/translation.json\";\nimport ptBRTranslation from \"../locales/ptBR/translation.json\";\nimport trTranslation from \"../locales/tr/translation.json\";\nimport itTranslation from \"../locales/it/translation.json\";\nimport plTranslation from \"../locales/pl/translation.json\";\n\nexport const supportedLngs: { [key: string]: { name: string; locale: string } } = {\n    da: {\n        name: \"Dansk\",\n        locale: \"da-DK\"\n    },\n    en: {\n        name: \"English\",\n        locale: \"en-US\"\n    },\n    es: {\n        name: \"Espaol\",\n        locale: \"es-ES\"\n    },\n    fr: {\n        name: \"Franais\",\n        locale: \"fr-FR\"\n    },\n    ja: {\n        name: \"\",\n        locale: \"ja-JP\"\n    },\n    nl: {\n        name: \"Nederlands\",\n        locale: \"nl-NL\"\n    },\n    ptBR: {\n        name: \"Portugus Brasileiro\",\n        locale: \"pt-BR\"\n    },\n    tr: {\n        name: \"Trke\",\n        locale: \"tr-TR\"\n    },\n    it: {\n        name: \"Italiano\",\n        locale: \"it-IT\"\n    },\n    pl: {\n        name: \"Polski\",\n        locale: \"pl-PL\"\n    }\n};\n\ni18next\n    .use(HttpApi)\n    .use(LanguageDetector)\n    .use(initReactI18next)\n    // init i18next\n    // for all options read: https://www.i18next.com/overview/configuration-options\n    .init({\n        resources: {\n            da: { translation: daTranslation },\n            en: { translation: enTranslation },\n            es: { translation: esTranslation },\n            fr: { translation: frTranslation },\n            ja: { translation: jaTranslation },\n            nl: { translation: nlTranslation },\n            ptBR: { translation: ptBRTranslation },\n            tr: { translation: trTranslation },\n            it: { translation: itTranslation },\n            pl: { translation: plTranslation }\n        },\n        fallbackLng: \"en\",\n        supportedLngs: Object.keys(supportedLngs),\n        debug: import.meta.env.DEV,\n        interpolation: {\n            escapeValue: false // not needed for react as it escapes by default\n        }\n    });\n\nexport default i18next;\n","import { useState } from \"react\";\nimport { IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport { supportedLngs } from \"../../i18n/config\";\n\ninterface Props {\n    answer: string;\n}\n\nconst SpeechSynthesis = (window as any).speechSynthesis || (window as any).webkitSpeechSynthesis;\n\nlet synth: SpeechSynthesis | null = null;\n\ntry {\n    synth = SpeechSynthesis;\n} catch (err) {\n    console.error(\"SpeechSynthesis is not supported\");\n}\n\nconst getUtterance = function (text: string, lngCode: string = \"en-US\") {\n    if (synth) {\n        const utterance = new SpeechSynthesisUtterance(text);\n        utterance.lang = lngCode;\n        utterance.volume = 1;\n        utterance.rate = 1;\n        utterance.pitch = 1;\n\n        let voice = synth.getVoices().filter((voice: SpeechSynthesisVoice) => voice.lang === lngCode)[0];\n        if (!voice) {\n            voice = synth.getVoices().filter((voice: SpeechSynthesisVoice) => voice.lang === \"en-US\")[0];\n        }\n\n        utterance.voice = voice;\n        return utterance;\n    }\n};\n\nexport const SpeechOutputBrowser = ({ answer }: Props) => {\n    const { t, i18n } = useTranslation();\n    const currentLng = i18n.language;\n    let lngCode = supportedLngs[currentLng]?.locale;\n    if (!lngCode) {\n        lngCode = \"en-US\";\n    }\n    const [isPlaying, setIsPlaying] = useState<boolean>(false);\n\n    const startOrStopSpeech = (answer: string) => {\n        if (synth != null) {\n            if (isPlaying) {\n                synth.cancel(); // removes all utterances from the utterance queue.\n                setIsPlaying(false);\n                return;\n            }\n            const utterance: SpeechSynthesisUtterance | undefined = getUtterance(answer, lngCode);\n\n            if (!utterance) {\n                return;\n            }\n\n            synth.speak(utterance);\n\n            utterance.onstart = () => {\n                setIsPlaying(true);\n                return;\n            };\n\n            utterance.onend = () => {\n                setIsPlaying(false);\n                return;\n            };\n        }\n    };\n    const color = isPlaying ? \"red\" : \"black\";\n\n    return (\n        <IconButton\n            style={{ color: color }}\n            iconProps={{ iconName: \"Volume3\" }}\n            title={t(\"tooltips.speakAnswer\")}\n            ariaLabel={t(\"tooltips.speakAnswer\")}\n            onClick={() => startOrStopSpeech(answer)}\n            disabled={!synth}\n        />\n    );\n};\n","import { useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { IconButton } from \"@fluentui/react\";\nimport { getSpeechApi, SpeechConfig } from \"../../api\";\n\ninterface Props {\n    answer: string;\n    speechConfig: SpeechConfig;\n    index: number;\n    isStreaming: boolean;\n}\n\nexport const SpeechOutputAzure = ({ answer, speechConfig, index, isStreaming }: Props) => {\n    const [isLoading, setIsLoading] = useState(false);\n    const [localPlayingState, setLocalPlayingState] = useState(false);\n    const { t } = useTranslation();\n\n    const playAudio = async (url: string) => {\n        speechConfig.audio.src = url;\n        await speechConfig.audio\n            .play()\n            .then(() => {\n                speechConfig.audio.onended = () => {\n                    speechConfig.setIsPlaying(false);\n                    setLocalPlayingState(false);\n                };\n                speechConfig.setIsPlaying(true);\n                setLocalPlayingState(true);\n            })\n            .catch(() => {\n                alert(\"Failed to play speech output.\");\n                console.error(\"Failed to play speech output.\");\n                speechConfig.setIsPlaying(false);\n                setLocalPlayingState(false);\n            });\n    };\n\n    const startOrStopSpeech = async (answer: string) => {\n        if (speechConfig.isPlaying) {\n            speechConfig.audio.pause();\n            speechConfig.audio.currentTime = 0;\n            speechConfig.setIsPlaying(false);\n            setLocalPlayingState(false);\n            return;\n        }\n        if (speechConfig.speechUrls[index]) {\n            playAudio(speechConfig.speechUrls[index]);\n            return;\n        }\n        setIsLoading(true);\n        await getSpeechApi(answer).then(async speechUrl => {\n            if (!speechUrl) {\n                alert(\"Speech output is not available.\");\n                console.error(\"Speech output is not available.\");\n                return;\n            }\n            setIsLoading(false);\n            speechConfig.setSpeechUrls(speechConfig.speechUrls.map((url, i) => (i === index ? speechUrl : url)));\n            playAudio(speechUrl);\n        });\n    };\n\n    const color = localPlayingState ? \"red\" : \"black\";\n\n    // We always preload the Sync icon in hidden mode so that there's no visual glitch when icon changes\n    return isLoading ? (\n        <IconButton style={{ color: color }} iconProps={{ iconName: \"Sync\" }} title=\"Loading speech\" ariaLabel=\"Loading speech\" disabled={true} />\n    ) : (\n        <>\n            <IconButton iconProps={{ iconName: \"Sync\" }} ariaHidden={true} disabled={true} style={{ display: \"none\" }} />\n            <IconButton\n                style={{ color: color }}\n                iconProps={{ iconName: \"Volume3\" }}\n                title={t(\"tooltips.speakAnswer\")}\n                ariaLabel={t(\"tooltips.speakAnswer\")}\n                onClick={() => startOrStopSpeech(answer)}\n                disabled={isStreaming}\n            />\n        </>\n    );\n};\n","import { useMemo, useState } from \"react\";\nimport { Stack, IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport DOMPurify from \"dompurify\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\nimport rehypeRaw from \"rehype-raw\";\n\nimport styles from \"./Answer.module.css\";\nimport { ChatAppResponse, getCitationFilePath, SpeechConfig } from \"../../api\";\nimport { parseAnswerToHtml } from \"./AnswerParser\";\nimport { AnswerIcon } from \"./AnswerIcon\";\nimport { SpeechOutputBrowser } from \"./SpeechOutputBrowser\";\nimport { SpeechOutputAzure } from \"./SpeechOutputAzure\";\n\ninterface Props {\n    answer: ChatAppResponse;\n    index: number;\n    speechConfig: SpeechConfig;\n    isSelected?: boolean;\n    isStreaming: boolean;\n    onCitationClicked: (filePath: string) => void;\n    onThoughtProcessClicked: () => void;\n    onSupportingContentClicked: () => void;\n    onFollowupQuestionClicked?: (question: string) => void;\n    showFollowupQuestions?: boolean;\n    showSpeechOutputBrowser?: boolean;\n    showSpeechOutputAzure?: boolean;\n}\n\nexport const Answer = ({\n    answer,\n    index,\n    speechConfig,\n    isSelected,\n    isStreaming,\n    onCitationClicked,\n    onThoughtProcessClicked,\n    onSupportingContentClicked,\n    onFollowupQuestionClicked,\n    showFollowupQuestions,\n    showSpeechOutputAzure,\n    showSpeechOutputBrowser\n}: Props) => {\n    const followupQuestions = answer.context?.followup_questions;\n    const parsedAnswer = useMemo(() => parseAnswerToHtml(answer, isStreaming, onCitationClicked), [answer, isStreaming, onCitationClicked]);\n    const { t } = useTranslation();\n    const sanitizedAnswerHtml = DOMPurify.sanitize(parsedAnswer.answerHtml);\n    const [copied, setCopied] = useState(false);\n\n    const handleCopy = () => {\n        const tempElement = document.createElement(\"div\");\n        tempElement.innerHTML = sanitizedAnswerHtml;\n        tempElement.querySelectorAll(\"sup\").forEach(node => node.remove());\n        tempElement.querySelectorAll(\".citationStepBadge\").forEach(node => node.remove());\n        const textToCopy = tempElement.textContent ?? \"\";\n\n        navigator.clipboard\n            .writeText(textToCopy)\n            .then(() => {\n                setCopied(true);\n                setTimeout(() => setCopied(false), 2000);\n            })\n            .catch(err => console.error(\"Failed to copy text: \", err));\n    };\n\n    return (\n        <Stack className={`${styles.answerContainer} ${isSelected && styles.selected}`} verticalAlign=\"space-between\">\n            <Stack.Item>\n                <Stack horizontal horizontalAlign=\"space-between\">\n                    <AnswerIcon />\n                    <div>\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: copied ? \"CheckMark\" : \"Copy\" }}\n                            title={copied ? t(\"tooltips.copied\") : t(\"tooltips.copy\")}\n                            ariaLabel={copied ? t(\"tooltips.copied\") : t(\"tooltips.copy\")}\n                            onClick={handleCopy}\n                        />\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: \"Lightbulb\" }}\n                            title={t(\"tooltips.showThoughtProcess\")}\n                            ariaLabel={t(\"tooltips.showThoughtProcess\")}\n                            onClick={() => onThoughtProcessClicked()}\n                            disabled={!answer.context.thoughts?.length || isStreaming}\n                        />\n                        <IconButton\n                            style={{ color: \"black\" }}\n                            iconProps={{ iconName: \"ClipboardList\" }}\n                            title={t(\"tooltips.showSupportingContent\")}\n                            ariaLabel={t(\"tooltips.showSupportingContent\")}\n                            onClick={() => onSupportingContentClicked()}\n                            disabled={!answer.context.data_points || isStreaming}\n                        />\n                        {showSpeechOutputAzure && (\n                            <SpeechOutputAzure answer={sanitizedAnswerHtml} index={index} speechConfig={speechConfig} isStreaming={isStreaming} />\n                        )}\n                        {showSpeechOutputBrowser && <SpeechOutputBrowser answer={sanitizedAnswerHtml} />}\n                    </div>\n                </Stack>\n            </Stack.Item>\n\n            <Stack.Item grow>\n                <div className={styles.answerText}>\n                    <ReactMarkdown children={sanitizedAnswerHtml} rehypePlugins={[rehypeRaw]} remarkPlugins={[remarkGfm]} />\n                </div>\n            </Stack.Item>\n\n            {!!parsedAnswer.citations.length && (\n                <Stack.Item>\n                    <Stack horizontal wrap tokens={{ childrenGap: 5 }}>\n                        <span className={styles.citationLearnMore}>{t(\"citationWithColon\")}</span>\n                        {parsedAnswer.citations.map(citation => {\n                            const isWeb = citation.isWeb;\n                            const displayIndex = citation.index;\n                            const reference = citation.reference;\n                            if (isWeb) {\n                                // Attempt to find the matching web data point to retrieve its title\n                                const webEntry = answer.context.data_points.external_results_metadata?.find(w => w.url === reference);\n                                const titleOrUrl = webEntry?.title?.trim() ? webEntry.title : reference;\n                                return (\n                                    <span key={`${reference}-${displayIndex}`} className={styles.citationEntry}>\n                                        <a className={styles.citation} title={reference} href={reference} target=\"_blank\" rel=\"noopener noreferrer\">\n                                            {`${displayIndex}. ${titleOrUrl}`}\n                                        </a>\n                                    </span>\n                                );\n                            } else {\n                                const path = getCitationFilePath(reference);\n                                return (\n                                    <span key={`${reference}-${displayIndex}`} className={styles.citationEntry}>\n                                        <a\n                                            className={styles.citation}\n                                            title={reference}\n                                            onClick={e => {\n                                                e.preventDefault();\n                                                onCitationClicked(path);\n                                            }}\n                                        >\n                                            {`${displayIndex}. ${reference}`}\n                                        </a>\n                                    </span>\n                                );\n                            }\n                        })}\n                    </Stack>\n                </Stack.Item>\n            )}\n\n            {!!followupQuestions?.length && showFollowupQuestions && onFollowupQuestionClicked && (\n                <Stack.Item>\n                    <Stack horizontal wrap className={`${!!parsedAnswer.citations.length ? styles.followupQuestionsList : \"\"}`} tokens={{ childrenGap: 6 }}>\n                        <span className={styles.followupQuestionLearnMore}>{t(\"followupQuestions\")}</span>\n                        {followupQuestions.map((x, i) => {\n                            return (\n                                <a key={i} className={styles.followupQuestion} title={x} onClick={() => onFollowupQuestionClicked(x)}>\n                                    {`${x}`}\n                                </a>\n                            );\n                        })}\n                    </Stack>\n                </Stack.Item>\n            )}\n        </Stack>\n    );\n};\n","import { Stack } from \"@fluentui/react\";\nimport { animated, useSpring } from \"@react-spring/web\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./Answer.module.css\";\nimport { AnswerIcon } from \"./AnswerIcon\";\n\nexport const AnswerLoading = () => {\n    const { t, i18n } = useTranslation();\n    const animatedStyles = useSpring({\n        from: { opacity: 0 },\n        to: { opacity: 1 }\n    });\n\n    return (\n        <animated.div style={{ ...animatedStyles }}>\n            <Stack className={styles.answerContainer} verticalAlign=\"space-between\">\n                <AnswerIcon />\n                <Stack.Item grow>\n                    <p className={styles.answerText}>\n                        {t(\"generatingAnswer\")}\n                        <span className={styles.loadingdots} />\n                    </p>\n                </Stack.Item>\n            </Stack>\n        </animated.div>\n    );\n};\n","import { Stack, PrimaryButton } from \"@fluentui/react\";\nimport { ErrorCircle24Regular } from \"@fluentui/react-icons\";\n\nimport styles from \"./Answer.module.css\";\n\ninterface Props {\n    error: string;\n    onRetry: () => void;\n}\n\nexport const AnswerError = ({ error, onRetry }: Props) => {\n    return (\n        <Stack className={styles.answerContainer} verticalAlign=\"space-between\">\n            <ErrorCircle24Regular aria-hidden=\"true\" aria-label=\"Error icon\" primaryFill=\"red\" />\n\n            <Stack.Item grow>\n                <p className={styles.answerText}>{error}</p>\n            </Stack.Item>\n\n            <PrimaryButton className={styles.retryButton} onClick={onRetry} text=\"Retry\" />\n        </Stack>\n    );\n};\n","import { SetStateAction, useState } from \"react\";\nimport { Button, Tooltip } from \"@fluentui/react-components\";\nimport { Mic28Filled } from \"@fluentui/react-icons\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./QuestionInput.module.css\";\nimport { supportedLngs } from \"../../i18n/config\";\n\ninterface Props {\n    updateQuestion: (question: string) => void;\n}\n\nconst useCustomSpeechRecognition = () => {\n    const { i18n } = useTranslation();\n    const currentLng = i18n.language;\n    let lngCode = supportedLngs[currentLng]?.locale;\n    if (!lngCode) {\n        lngCode = \"en-US\";\n    }\n\n    const SpeechRecognition = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;\n    let speechRecognition: {\n        continuous: boolean;\n        lang: string;\n        interimResults: boolean;\n        maxAlternatives: number;\n        start: () => void;\n        onresult: (event: { results: { transcript: SetStateAction<string> }[][] }) => void;\n        onend: () => void;\n        onerror: (event: { error: string }) => void;\n        stop: () => void;\n    } | null = null;\n\n    try {\n        speechRecognition = new SpeechRecognition();\n        if (speechRecognition != null) {\n            speechRecognition.lang = lngCode;\n            speechRecognition.interimResults = true;\n        }\n    } catch (err) {\n        console.error(\"SpeechRecognition not supported\");\n        speechRecognition = null;\n    }\n\n    return speechRecognition;\n};\n\nexport const SpeechInput = ({ updateQuestion }: Props) => {\n    let speechRecognition = useCustomSpeechRecognition();\n    const { t } = useTranslation();\n    const [isRecording, setIsRecording] = useState<boolean>(false);\n    const startRecording = () => {\n        if (speechRecognition == null) {\n            console.error(\"SpeechRecognition not supported\");\n            return;\n        }\n\n        speechRecognition.onresult = (event: { results: { transcript: SetStateAction<string> }[][] }) => {\n            let input = \"\";\n            for (const result of event.results) {\n                input += result[0].transcript;\n            }\n            updateQuestion(input);\n        };\n        speechRecognition.onend = () => {\n            // NOTE: In some browsers (e.g. Chrome), the recording will stop automatically after a few seconds of silence.\n            setIsRecording(false);\n        };\n        speechRecognition.onerror = (event: { error: string }) => {\n            if (speechRecognition) {\n                speechRecognition.stop();\n                if (event.error == \"no-speech\") {\n                    alert(\"No speech was detected. Please check your system audio settings and try again.\");\n                } else if (event.error == \"language-not-supported\") {\n                    alert(\n                        `Speech recognition error detected: ${event.error}. The speech recognition input functionality does not yet work on all browsers, like Edge in Mac OS X with ARM chips. Try another browser/OS.`\n                    );\n                } else {\n                    alert(`Speech recognition error detected: ${event.error}.`);\n                }\n            }\n        };\n\n        setIsRecording(true);\n        speechRecognition.start();\n    };\n\n    const stopRecording = () => {\n        if (speechRecognition == null) {\n            console.error(\"SpeechRecognition not supported\");\n            return;\n        }\n        speechRecognition.stop();\n        setIsRecording(false);\n    };\n\n    if (speechRecognition == null) {\n        return <></>;\n    }\n    return (\n        <>\n            {!isRecording && (\n                <div className={styles.questionInputButtonsContainer}>\n                    <Tooltip content={t(\"tooltips.askWithVoice\")} relationship=\"label\">\n                        <Button size=\"large\" icon={<Mic28Filled primaryFill=\"rgba(115, 118, 225, 1)\" />} onClick={startRecording} />\n                    </Tooltip>\n                </div>\n            )}\n            {isRecording && (\n                <div className={styles.questionInputButtonsContainer}>\n                    <Tooltip content={t(\"tooltips.stopRecording\")} relationship=\"label\">\n                        <Button size=\"large\" icon={<Mic28Filled primaryFill=\"rgba(250, 0, 0, 0.7)\" />} disabled={!isRecording} onClick={stopRecording} />\n                    </Tooltip>\n                </div>\n            )}\n        </>\n    );\n};\n","/**\n * This file defines a context for managing login state in a React application.\n * Context provides a way to pass data through the component tree without having to pass props down manually at every level.\n * For more information, refer to the official React documentation:\n * https://react.dev/learn/passing-data-deeply-with-context\n */\n\nimport { createContext } from \"react\";\n\nexport const LoginContext = createContext({\n    loggedIn: false,\n    setLoggedIn: (_: boolean) => {}\n});\n","import { useState, useEffect, useContext } from \"react\";\nimport { Stack, TextField } from \"@fluentui/react\";\nimport { Button, Tooltip } from \"@fluentui/react-components\";\nimport { Send28Filled } from \"@fluentui/react-icons\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./QuestionInput.module.css\";\nimport { SpeechInput } from \"./SpeechInput\";\nimport { LoginContext } from \"../../loginContext\";\nimport { requireLogin } from \"../../authConfig\";\n\ninterface Props {\n    onSend: (question: string) => void;\n    disabled: boolean;\n    initQuestion?: string;\n    placeholder?: string;\n    clearOnSend?: boolean;\n    showSpeechInput?: boolean;\n}\n\nexport const QuestionInput = ({ onSend, disabled, placeholder, clearOnSend, initQuestion, showSpeechInput }: Props) => {\n    const [question, setQuestion] = useState<string>(\"\");\n    const { loggedIn } = useContext(LoginContext);\n    const { t } = useTranslation();\n    const [isComposing, setIsComposing] = useState(false);\n\n    useEffect(() => {\n        initQuestion && setQuestion(initQuestion);\n    }, [initQuestion]);\n\n    const sendQuestion = () => {\n        if (disabled || !question.trim()) {\n            return;\n        }\n\n        onSend(question);\n\n        if (clearOnSend) {\n            setQuestion(\"\");\n        }\n    };\n\n    const onEnterPress = (ev: React.KeyboardEvent<Element>) => {\n        if (isComposing) return;\n\n        if (ev.key === \"Enter\" && !ev.shiftKey) {\n            ev.preventDefault();\n            sendQuestion();\n        }\n    };\n\n    const handleCompositionStart = () => {\n        setIsComposing(true);\n    };\n    const handleCompositionEnd = () => {\n        setIsComposing(false);\n    };\n\n    const onQuestionChange = (_ev: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => {\n        if (!newValue) {\n            setQuestion(\"\");\n        } else if (newValue.length <= 1000) {\n            setQuestion(newValue);\n        }\n    };\n\n    const disableRequiredAccessControl = requireLogin && !loggedIn;\n    const sendQuestionDisabled = disabled || !question.trim() || disableRequiredAccessControl;\n\n    if (disableRequiredAccessControl) {\n        placeholder = \"Please login to continue...\";\n    }\n\n    return (\n        <Stack horizontal className={styles.questionInputContainer}>\n            <TextField\n                className={styles.questionInputTextArea}\n                disabled={disableRequiredAccessControl}\n                placeholder={placeholder}\n                multiline\n                resizable={false}\n                borderless\n                value={question}\n                onChange={onQuestionChange}\n                onKeyDown={onEnterPress}\n                onCompositionStart={handleCompositionStart}\n                onCompositionEnd={handleCompositionEnd}\n            />\n            <div className={styles.questionInputButtonsContainer}>\n                <Tooltip content={t(\"tooltips.submitQuestion\")} relationship=\"label\">\n                    <Button size=\"large\" icon={<Send28Filled primaryFill=\"rgba(115, 118, 225, 1)\" />} disabled={sendQuestionDisabled} onClick={sendQuestion} />\n                </Tooltip>\n            </div>\n            {showSpeechInput && <SpeechInput updateQuestion={setQuestion} />}\n        </Stack>\n    );\n};\n","import styles from \"./Example.module.css\";\n\ninterface Props {\n    text: string;\n    value: string;\n    onClick: (value: string) => void;\n}\n\nexport const Example = ({ text, value, onClick }: Props) => {\n    return (\n        <div className={styles.example} onClick={() => onClick(value)}>\n            <p className={styles.exampleText}>{text}</p>\n        </div>\n    );\n};\n","import { Example } from \"./Example\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./Example.module.css\";\n\ninterface Props {\n    onExampleClicked: (value: string) => void;\n    useMultimodalAnswering?: boolean;\n}\n\nexport const ExampleList = ({ onExampleClicked, useMultimodalAnswering }: Props) => {\n    const { t } = useTranslation();\n\n    const DEFAULT_EXAMPLES: string[] = [t(\"defaultExamples.1\"), t(\"defaultExamples.2\"), t(\"defaultExamples.3\")];\n    const MULTIMODAL_EXAMPLES: string[] = [t(\"multimodalExamples.1\"), t(\"multimodalExamples.2\"), t(\"multimodalExamples.3\")];\n\n    return (\n        <ul className={styles.examplesNavList}>\n            {(useMultimodalAnswering ? MULTIMODAL_EXAMPLES : DEFAULT_EXAMPLES).map((question, i) => (\n                <li key={i}>\n                    <Example text={question} value={question} onClick={onExampleClicked} />\n                </li>\n            ))}\n        </ul>\n    );\n};\n","import styles from \"./UserChatMessage.module.css\";\n\ninterface Props {\n    message: string;\n}\n\nexport const UserChatMessage = ({ message }: Props) => {\n    return (\n        <div className={styles.container}>\n            <div className={styles.message}>{message}</div>\n        </div>\n    );\n};\n","import { Spinner, SpinnerSize, MessageBar, MessageBarType, Link, IconButton } from \"@fluentui/react\";\nimport { useTranslation } from \"react-i18next\";\nimport React, { useState, useEffect } from \"react\";\nimport ReactMarkdown from \"react-markdown\";\nimport remarkGfm from \"remark-gfm\";\n\nimport styles from \"./MarkdownViewer.module.css\";\n\ninterface MarkdownViewerProps {\n    src: string;\n}\n\nexport const MarkdownViewer: React.FC<MarkdownViewerProps> = ({ src }) => {\n    const [content, setContent] = useState<string>(\"\");\n    const [isLoading, setIsLoading] = useState<boolean>(true);\n    const [error, setError] = useState<Error | null>(null);\n    const { t } = useTranslation();\n\n    /**\n     * Anchor links result in HTTP 404 errors as the URL they point to does not exist.\n     * This function removes them from the markdown.\n     */\n    const removeAnchorLinks = (markdown: string) => {\n        const ancorLinksRegex = /\\[.*?\\]\\(#.*?\\)/g;\n        return markdown.replace(ancorLinksRegex, \"\");\n    };\n\n    useEffect(() => {\n        const fetchMarkdown = async () => {\n            try {\n                const response = await fetch(src);\n\n                if (!response.ok) {\n                    throw new Error(\"Failed loading markdown file.\");\n                }\n\n                let markdownText = await response.text();\n                markdownText = removeAnchorLinks(markdownText);\n                setContent(markdownText);\n            } catch (error: any) {\n                setError(error);\n            } finally {\n                setIsLoading(false);\n            }\n        };\n\n        fetchMarkdown();\n    }, [src]);\n\n    return (\n        <div>\n            {isLoading ? (\n                <div className={`${styles.loading} ${styles.markdownViewer}`}>\n                    <Spinner size={SpinnerSize.large} label=\"Loading file\" />\n                </div>\n            ) : error ? (\n                <div className={`${styles.error} ${styles.markdownViewer}`}>\n                    <MessageBar messageBarType={MessageBarType.error} isMultiline={false}>\n                        {error.message}\n                        <Link href={src} download>\n                            Download the file\n                        </Link>\n                    </MessageBar>\n                </div>\n            ) : (\n                <div>\n                    <IconButton\n                        className={styles.downloadButton}\n                        style={{ color: \"black\" }}\n                        iconProps={{ iconName: \"Save\" }}\n                        title={t(\"tooltips.save\")}\n                        ariaLabel={t(\"tooltips.save\")}\n                        href={src}\n                        download\n                    />\n                    <ReactMarkdown children={content} remarkPlugins={[remarkGfm]} className={`${styles.markdown} ${styles.markdownViewer}`} />\n                </div>\n            )}\n        </div>\n    );\n};\n","import DOMPurify from \"dompurify\";\n\ntype ParsedSupportingContentItem = {\n    title: string;\n    content: string;\n};\n\nexport function parseSupportingContentItem(item: string): ParsedSupportingContentItem {\n    // Assumes the item starts with the file name followed by : and the content.\n    // Example: \"sdp_corporate.pdf: this is the content that follows\".\n    const parts = item.split(\": \");\n    const title = parts[0];\n    const content = DOMPurify.sanitize(parts.slice(1).join(\": \"));\n\n    return {\n        title,\n        content\n    };\n}\n","import DOMPurify from \"dompurify\";\n\nimport { DataPoints } from \"../../api\";\nimport { parseSupportingContentItem } from \"./SupportingContentParser\";\n\nimport styles from \"./SupportingContent.module.css\";\n\ninterface Props {\n    supportingContent?: DataPoints;\n}\n\nexport const SupportingContent = ({ supportingContent }: Props) => {\n    const textItems = supportingContent?.text ?? [];\n    const imageItems = supportingContent?.images ?? [];\n    const webItems = supportingContent?.external_results_metadata ?? [];\n    return (\n        <ul className={styles.supportingContentNavList}>\n            {textItems.map((c, ind) => {\n                const parsed = parseSupportingContentItem(c);\n                return (\n                    <li className={styles.supportingContentItem} key={`supporting-content-text-${ind}`}>\n                        <h4 className={styles.supportingContentItemHeader}>{parsed.title}</h4>\n                        <p className={styles.supportingContentItemText} dangerouslySetInnerHTML={{ __html: parsed.content }} />\n                    </li>\n                );\n            })}\n            {imageItems?.map((img, ind) => {\n                return (\n                    <li className={styles.supportingContentItem} key={`supporting-content-image-${ind}`}>\n                        <img className={styles.supportingContentItemImage} src={img} alt=\"Supporting content\" />\n                    </li>\n                );\n            })}\n            {webItems.map((item, ind) => (\n                <li className={styles.supportingContentItem} key={`supporting-content-web-${item.id ?? ind}`}>\n                    {item.url ? (\n                        <h4 className={styles.supportingContentItemHeader}>\n                            <a href={item.url} target=\"_blank\" rel=\"noreferrer\">\n                                {item.title ?? item.url}\n                            </a>\n                        </h4>\n                    ) : (\n                        <h4 className={styles.supportingContentItemHeader}>{item.title ?? \"Web result\"}</h4>\n                    )}\n                    {item.snippet && <p className={styles.supportingContentItemText} dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(item.snippet) }} />}\n                </li>\n            ))}\n        </ul>\n    );\n};\n","export enum AnalysisPanelTabs {\n    ThoughtProcessTab = \"thoughtProcess\",\n    SupportingContentTab = \"supportingContent\",\n    CitationTab = \"citation\"\n}\n","import React from \"react\";\nimport styles from \"./AnalysisPanel.module.css\";\n\nexport interface TokenUsage {\n    prompt_tokens: number;\n    completion_tokens: number;\n    reasoning_tokens: number;\n    total_tokens: number;\n}\n\ntype TokenLabelKey = \"prompt\" | \"reasoning\" | \"output\" | \"total\";\n\ntype AdditionalTotal = {\n    label: string;\n    value: number;\n    total?: number;\n};\n\ntype SupplementaryUsage = {\n    tokenUsage: TokenUsage;\n    labels?: Partial<Record<TokenLabelKey, string>>;\n    totalLabel?: string;\n    tone?: TokenUsageValueBarTone;\n};\n\ntype PercentBase = number | undefined;\n\nconst calcPercent = (value: number, base: PercentBase) => {\n    if (!base) {\n        return \"0%\";\n    }\n    const normalized = Math.max(value, 0);\n    const percent = Math.min((normalized / base) * 100, 100);\n    return `${percent}%`;\n};\n\nexport interface TokenUsageSegmentLabels {\n    prompt: string;\n    output: string;\n    reasoning?: string;\n}\n\ninterface TokenUsageStackedBarProps {\n    tokenUsage: TokenUsage;\n    labels: TokenUsageSegmentLabels;\n    includeReasoning?: boolean;\n}\n\nexport const TokenUsageStackedBar: React.FC<TokenUsageStackedBarProps> = ({ tokenUsage, labels, includeReasoning = false }) => {\n    const base = tokenUsage.total_tokens || 1;\n    const reasoningValue = includeReasoning ? tokenUsage.reasoning_tokens : 0;\n    const outputValue = tokenUsage.completion_tokens - reasoningValue;\n    const safeOutputValue = Math.max(outputValue, 0);\n    const promptValue = Math.max(tokenUsage.prompt_tokens, 0);\n    const safeReasoningValue = Math.max(reasoningValue, 0);\n    const promptPercent = calcPercent(promptValue, base);\n    const reasoningPercent = calcPercent(safeReasoningValue, base);\n    const outputPercent = calcPercent(safeOutputValue, base);\n    const minimumFlex = 0.5;\n    const promptFlex = promptValue > 0 ? promptValue : minimumFlex;\n    const reasoningFlex = includeReasoning ? (safeReasoningValue > 0 ? safeReasoningValue : minimumFlex) : 0;\n    const outputFlex = safeOutputValue > 0 ? safeOutputValue : minimumFlex;\n\n    return (\n        <div className={styles.primaryBarContainer}>\n            <div className={`${styles.tokenBar} ${styles.promptBar}`} style={{ flexGrow: promptFlex, flexBasis: promptPercent, minWidth: 0 }}>\n                <span className={styles.tokenLabel}>\n                    {labels.prompt}: {tokenUsage.prompt_tokens}\n                </span>\n            </div>\n            {includeReasoning && (\n                <div className={`${styles.tokenBar} ${styles.reasoningBar}`} style={{ flexGrow: reasoningFlex, flexBasis: reasoningPercent, minWidth: 0 }}>\n                    <span className={styles.tokenLabel}>\n                        {labels.reasoning ?? \"Reasoning\"}: {reasoningValue}\n                    </span>\n                </div>\n            )}\n            <div className={`${styles.tokenBar} ${styles.outputBar}`} style={{ flexGrow: outputFlex, flexBasis: outputPercent }}>\n                <span className={styles.tokenLabel}>\n                    {labels.output}: {safeOutputValue}\n                </span>\n            </div>\n        </div>\n    );\n};\n\nexport type TokenUsageValueBarTone = \"primary\" | \"secondary\";\ntype TokenUsageValueBarGrouping = \"grouped\" | \"standalone\";\n\ninterface TokenUsageValueBarProps {\n    label: string;\n    value: number;\n    base?: PercentBase;\n    tone?: TokenUsageValueBarTone;\n    grouping?: TokenUsageValueBarGrouping;\n}\n\nexport const TokenUsageValueBar: React.FC<TokenUsageValueBarProps> = ({ label, value, base, tone = \"primary\", grouping = \"standalone\" }) => {\n    const toneClass = tone === \"primary\" ? styles.totalBar : styles.secondaryTotalBar;\n    const groupingClass = grouping === \"grouped\" ? styles.groupedTotalBar : styles.standaloneTotalBar;\n    const resolvedBase = base ?? (value || 1);\n    const percent = calcPercent(value, resolvedBase);\n    const flexGrow = value > 0 ? value : 0.5;\n\n    // For standalone bars, use full width; for grouped bars, use percentage-based width\n    const barStyle = grouping === \"standalone\" ? { width: \"100%\" } : { width: percent, flexGrow, flexBasis: percent, minWidth: 0 };\n\n    return (\n        <div className={`${styles.tokenBar} ${toneClass} ${groupingClass}`} style={barStyle}>\n            <span className={styles.tokenLabel}>\n                {label}: {value}\n            </span>\n        </div>\n    );\n};\n\ninterface TokenUsageGraphProps {\n    tokenUsage: TokenUsage;\n    reasoningEffort?: string;\n    title?: string;\n    variant?: \"full\" | \"totalOnly\";\n    totalLabel?: string;\n    labels?: Partial<Record<TokenLabelKey, string>>;\n    additionalTotals?: AdditionalTotal[];\n    supplementaryUsages?: SupplementaryUsage[];\n}\n\nexport const TokenUsageGraph: React.FC<TokenUsageGraphProps> = ({\n    tokenUsage,\n    reasoningEffort,\n    title = \"Token usage\",\n    variant = \"full\",\n    totalLabel = \"Total\",\n    labels,\n    additionalTotals,\n    supplementaryUsages\n}) => {\n    const { total_tokens } = tokenUsage;\n    const showPrimaryBars = variant !== \"totalOnly\";\n    const promptLabel = labels?.prompt ?? \"Prompt\";\n    const reasoningLabel = labels?.reasoning ?? \"Reasoning\";\n    const outputLabel = labels?.output ?? \"Output\";\n    const resolvedTotalLabel = labels?.total ?? totalLabel;\n    const supplementary = supplementaryUsages ?? [];\n    const includeReasoning = showPrimaryBars && Boolean(reasoningEffort) && tokenUsage.reasoning_tokens > 0;\n\n    return (\n        <div className={styles.tokenUsageGraph}>\n            {title && <div className={styles.header}>{title}</div>}\n            {showPrimaryBars ? (\n                <div className={`${styles.segmentWrapper} ${styles.segmentWrapperFirst}`}>\n                    <TokenUsageStackedBar\n                        tokenUsage={tokenUsage}\n                        labels={{ prompt: promptLabel, output: outputLabel, reasoning: reasoningLabel }}\n                        includeReasoning={includeReasoning}\n                    />\n                    <TokenUsageValueBar label={resolvedTotalLabel} value={total_tokens} base={total_tokens} tone=\"primary\" grouping=\"grouped\" />\n                </div>\n            ) : (\n                <TokenUsageValueBar label={resolvedTotalLabel} value={total_tokens} base={total_tokens} tone=\"primary\" grouping=\"standalone\" />\n            )}\n            {additionalTotals?.map(extra => (\n                <TokenUsageValueBar\n                    key={extra.label}\n                    label={extra.label}\n                    value={extra.value}\n                    base={extra.total ?? total_tokens}\n                    tone=\"secondary\"\n                    grouping=\"standalone\"\n                />\n            ))}\n            {supplementary.map((segment, index) => (\n                <div key={`${segment.totalLabel ?? \"supplementary\"}-${index}`} className={styles.segmentWrapper}>\n                    {showPrimaryBars && (\n                        <TokenUsageStackedBar\n                            tokenUsage={segment.tokenUsage}\n                            labels={{\n                                prompt: segment.labels?.prompt ?? \"Prompt\",\n                                output: segment.labels?.output ?? \"Output\",\n                                reasoning: segment.labels?.reasoning ?? \"Reasoning\"\n                            }}\n                            includeReasoning={false}\n                        />\n                    )}\n                    <TokenUsageValueBar\n                        label={segment.labels?.total ?? segment.totalLabel ?? resolvedTotalLabel}\n                        value={segment.tokenUsage.total_tokens}\n                        base={segment.tokenUsage.total_tokens || 1}\n                        tone={segment.tone ?? \"secondary\"}\n                        grouping={showPrimaryBars ? \"grouped\" : \"standalone\"}\n                    />\n                </div>\n            ))}\n        </div>\n    );\n};\n","import React from \"react\";\nimport { Light as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport json from \"react-syntax-highlighter/dist/esm/languages/hljs/json\";\nimport { a11yLight } from \"react-syntax-highlighter/dist/esm/styles/hljs\";\n\nimport { getCitationFilePath } from \"../../api\";\nimport { QueryPlanStep, getStepLabel } from \"./agentPlanUtils\";\nimport styles from \"./AnalysisPanel.module.css\";\nimport { TokenUsage, TokenUsageGraph } from \"./TokenUsageGraph\";\n\nSyntaxHighlighter.registerLanguage(\"json\", json);\n\nconst renderDetail = (step: QueryPlanStep) => {\n    switch (step.type) {\n        case \"modelQueryPlanning\": {\n            const usage: TokenUsage = {\n                prompt_tokens: step.input_tokens ?? 0,\n                completion_tokens: step.output_tokens ?? 0,\n                reasoning_tokens: 0,\n                total_tokens: (step.input_tokens ?? 0) + (step.output_tokens ?? 0)\n            };\n\n            return <TokenUsageGraph tokenUsage={usage} labels={{ prompt: \"Input\", output: \"Output\", total: \"Total tokens\" }} title=\"\" />;\n        }\n        case \"searchIndex\": {\n            const search = step.search_index_arguments?.search ?? \"\";\n            return (\n                <>\n                    <div>\n                        <strong>Source:</strong> {step.knowledge_source_name ?? \"search index\"}\n                    </div>\n                    <div>\n                        <strong>Search:</strong> {search}\n                    </div>\n                </>\n            );\n        }\n        case \"web\": {\n            const webSearch = step.web_arguments?.search ?? \"\";\n            return (\n                <>\n                    <div>\n                        <strong>Source:</strong> {step.knowledge_source_name ?? \"web\"}\n                    </div>\n                    <div>\n                        <strong>Search:</strong>\n                        {webSearch}\n                    </div>\n                </>\n            );\n        }\n        case \"remoteSharePoint\": {\n            const sharepointSearch = step.remote_share_point_arguments?.search ?? \"\";\n            return (\n                <>\n                    <div>\n                        <strong>Source:</strong> {step.knowledge_source_name ?? \"SharePoint\"}\n                    </div>\n                    <div>\n                        <strong>Search: </strong>\n                        {sharepointSearch}\n                    </div>\n                </>\n            );\n        }\n        case \"agenticReasoning\": {\n            const usage: TokenUsage = {\n                prompt_tokens: 0,\n                completion_tokens: step.reasoning_tokens ?? 0,\n                reasoning_tokens: step.reasoning_tokens ?? 0,\n                total_tokens: step.reasoning_tokens ?? 0\n            };\n\n            return (\n                <>\n                    <TokenUsageGraph tokenUsage={usage} labels={{ total: \"Total tokens\" }} variant=\"totalOnly\" title=\"\" />\n                    <div style={{ fontSize: \"0.85em\", color: \"#666\", paddingLeft: \"6px\" }}>\n                        This step uses Azure AI Search models, so the token capacity does not affect the deployed model.\n                    </div>\n                </>\n            );\n        }\n        case \"modelAnswerSynthesis\": {\n            const usage: TokenUsage = {\n                prompt_tokens: step.input_tokens ?? 0,\n                completion_tokens: step.output_tokens ?? 0,\n                reasoning_tokens: 0,\n                total_tokens: (step.input_tokens ?? 0) + (step.output_tokens ?? 0)\n            };\n\n            return <TokenUsageGraph tokenUsage={usage} labels={{ prompt: \"Input\", output: \"Output\", total: \"Total tokens\" }} title=\"\" />;\n        }\n        default:\n            return (\n                <SyntaxHighlighter language=\"json\" wrapLines wrapLongLines className={styles.tCodeBlock} style={a11yLight}>\n                    {JSON.stringify(step, null, 2)}\n                </SyntaxHighlighter>\n            );\n    }\n};\n\ninterface Props {\n    queryPlan: QueryPlanStep[];\n    onEffortExtracted?: (effort: string | undefined) => void;\n    onCitationClicked?: (citationFilePath: string) => void;\n    results?: any[];\n}\n\nexport const AgentPlan: React.FC<Props> = ({ queryPlan, onEffortExtracted, onCitationClicked, results }) => {\n    // Helper to get search query for a step\n    const getStepQuery = (step: QueryPlanStep): string | undefined => {\n        if (step.search_index_arguments?.search) return step.search_index_arguments.search;\n        if (step.web_arguments?.search) return step.web_arguments.search;\n        if (step.remote_share_point_arguments?.search) return step.remote_share_point_arguments.search;\n        return undefined;\n    };\n\n    // Helper to get results for a specific step\n    const getResultsForStep = (step: QueryPlanStep): any[] => {\n        if (!results || results.length === 0) return [];\n        const stepQuery = getStepQuery(step);\n        if (!stepQuery) return [];\n\n        // Filter by both query and step type, then de-duplicate by filename\n        const filtered = results.filter(result => result.activity?.query === stepQuery && result.type == step.type);\n        const uniqueMap = new Map(filtered.map(r => [r.sourcepage || r.web_url || r.url, r]));\n        return Array.from(uniqueMap.values());\n    };\n\n    const stepNumberLookup = React.useMemo(() => {\n        const lookup: Record<string, number> = {};\n        queryPlan.forEach((step, index) => {\n            if (step != null && step.id !== undefined && step.id !== null) {\n                lookup[String(step.id)] = index + 1;\n            }\n        });\n        return lookup;\n    }, [queryPlan]);\n\n    const iterations = React.useMemo(() => {\n        if (!queryPlan || queryPlan.length === 0) {\n            return [] as QueryPlanStep[][];\n        }\n\n        const planningIndices = queryPlan.reduce<number[]>((indices, step, index) => {\n            if (step.type === \"modelQueryPlanning\") {\n                indices.push(index);\n            }\n            return indices;\n        }, []);\n\n        if (planningIndices.length <= 1) {\n            return [queryPlan];\n        }\n\n        const iterationsList: QueryPlanStep[][] = [];\n        const prePlanningSteps = planningIndices[0] > 0 ? queryPlan.slice(0, planningIndices[0]) : [];\n\n        planningIndices.forEach((planningIndex, idx) => {\n            const nextPlanningIndex = planningIndices[idx + 1] ?? queryPlan.length;\n            const iterationSteps = queryPlan.slice(planningIndex, nextPlanningIndex);\n\n            if (idx === 0 && prePlanningSteps.length > 0) {\n                iterationsList.push([...prePlanningSteps, ...iterationSteps]);\n            } else if (iterationSteps.length > 0) {\n                iterationsList.push(iterationSteps);\n            }\n        });\n\n        return iterationsList;\n    }, [queryPlan]);\n\n    React.useEffect(() => {\n        // Extract effort from first agentic reasoning step\n        const agenticStep = queryPlan.find(step => step.type === \"agenticReasoning\");\n        const effort = agenticStep?.retrieval_reasoning_effort?.kind;\n        if (onEffortExtracted) {\n            onEffortExtracted(effort);\n        }\n    }, [queryPlan, onEffortExtracted]);\n\n    if (iterations.length === 0) {\n        return null;\n    }\n\n    return (\n        <div>\n            {iterations.map((iterationSteps, iterationIndex) => {\n                const hasMultipleIterations = iterations.length > 1;\n                const headerLabel = hasMultipleIterations ? `Iteration ${iterationIndex + 1} Execution steps` : \"Execution steps\";\n\n                return (\n                    <div className={styles.iterationSection} key={`iteration-${iterationIndex}`}>\n                        <div className={styles.header}>{headerLabel}</div>\n                        <table className={styles.subqueriesTable}>\n                            <thead>\n                                <tr>\n                                    <th>Step</th>\n                                    <th>Details</th>\n                                    <th>Elapsed MS</th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                                {iterationSteps.map(step => {\n                                    const stepId = step?.id;\n                                    const stepNumber = stepId !== undefined ? stepNumberLookup[String(stepId)] : undefined;\n                                    const stepResults = getResultsForStep(step);\n\n                                    return (\n                                        <tr key={step.id}>\n                                            <td>\n                                                <div className={styles.stepHeaderCell}>\n                                                    {stepNumber && <span className={styles.stepNumberText}>{`Step ${stepNumber}:`}</span>}\n                                                    <span className={styles.stepLabel}>{getStepLabel(step)}</span>\n                                                </div>\n                                            </td>\n                                            <td>\n                                                {renderDetail(step)}\n                                                {(step.type === \"searchIndex\" || step.type === \"remoteSharePoint\" || step.type === \"web\") &&\n                                                    (stepResults.length > 0 ? (\n                                                        <div className={styles.stepResults}>\n                                                            {stepResults.map((result, idx) => {\n                                                                // Handle different result types\n                                                                if (result.type === \"remoteSharePoint\" && result.web_url) {\n                                                                    return (\n                                                                        <div key={idx} className={styles.stepResult}>\n                                                                            <a href={result.web_url} target=\"_blank\" rel=\"noopener noreferrer\">\n                                                                                {result.title || result.web_url}\n                                                                            </a>\n                                                                        </div>\n                                                                    );\n                                                                } else if (result.url) {\n                                                                    // Web result\n                                                                    return (\n                                                                        <div key={idx} className={styles.stepResult}>\n                                                                            <a href={result.url} target=\"_blank\" rel=\"noopener noreferrer\">\n                                                                                {result.title || result.url}\n                                                                            </a>\n                                                                        </div>\n                                                                    );\n                                                                } else if (result.sourcepage) {\n                                                                    // Document result - make it clickable to open citation tab\n                                                                    const path = getCitationFilePath(result.sourcepage);\n                                                                    return (\n                                                                        <div key={idx} className={styles.stepResult}>\n                                                                            <a\n                                                                                onClick={e => {\n                                                                                    e.preventDefault();\n                                                                                    if (onCitationClicked) {\n                                                                                        onCitationClicked(path);\n                                                                                    }\n                                                                                }}\n                                                                                style={{ cursor: \"pointer\" }}\n                                                                            >\n                                                                                {result.sourcepage}\n                                                                            </a>\n                                                                        </div>\n                                                                    );\n                                                                }\n                                                                return null;\n                                                            })}\n                                                        </div>\n                                                    ) : (\n                                                        <div className={styles.noResults}>No results found</div>\n                                                    ))}\n                                            </td>\n                                            <td title={step.query_time ?? undefined}>{step.elapsed_ms ?? \"\"}</td>\n                                        </tr>\n                                    );\n                                })}\n                            </tbody>\n                        </table>\n                    </div>\n                );\n            })}\n        </div>\n    );\n};\n","import { Stack } from \"@fluentui/react\";\nimport React from \"react\";\nimport { Light as SyntaxHighlighter } from \"react-syntax-highlighter\";\nimport json from \"react-syntax-highlighter/dist/esm/languages/hljs/json\";\nimport { a11yLight } from \"react-syntax-highlighter/dist/esm/styles/hljs\";\n\nimport styles from \"./AnalysisPanel.module.css\";\n\nimport { Thoughts } from \"../../api\";\nimport { AgentPlan } from \"./AgentPlan\";\nimport { TokenUsageGraph } from \"./TokenUsageGraph\";\n\nSyntaxHighlighter.registerLanguage(\"json\", json);\n\ninterface Props {\n    thoughts: Thoughts[];\n    onCitationClicked?: (citationFilePath: string) => void;\n}\n\n// Helper to truncate URLs\nfunction truncateImageUrl(val: string) {\n    if (typeof val === \"string\" && val.startsWith(\"data:image/\")) {\n        return val.slice(0, 30) + \"...\";\n    }\n    return val;\n}\n\nexport const ThoughtProcess = ({ thoughts, onCitationClicked }: Props) => {\n    const [effort, setEffort] = React.useState<string | undefined>();\n\n    return (\n        <ul className={styles.tList}>\n            {thoughts.map((t, ind) => {\n                const hasAgenticPlan = Array.isArray(t.props?.query_plan) && t.props.query_plan.length > 0;\n                return (\n                    <li className={styles.tListItem} key={ind}>\n                        <div className={styles.tStep}>{t.title}</div>\n                        <Stack horizontal tokens={{ childrenGap: 5 }} className={styles.tPropRow}>\n                            {t.props &&\n                                (Object.keys(t.props).filter(k => k !== \"token_usage\" && k !== \"query_plan\") || []).map((k: any) => (\n                                    <span className={styles.tProp} key={k}>\n                                        {k}: {truncateImageUrl(JSON.stringify(t.props?.[k]))}\n                                    </span>\n                                ))}\n                            {hasAgenticPlan && effort && <span className={styles.tProp}>effort: {effort}</span>}\n                        </Stack>\n                        {t.props?.token_usage && !hasAgenticPlan && (\n                            <TokenUsageGraph tokenUsage={t.props.token_usage} reasoningEffort={t.props.reasoning_effort} />\n                        )}\n                        {hasAgenticPlan && (\n                            <AgentPlan\n                                queryPlan={t.props?.query_plan ?? []}\n                                onEffortExtracted={setEffort}\n                                onCitationClicked={onCitationClicked}\n                                results={Array.isArray(t.description) ? t.description : []}\n                            />\n                        )}\n                        {Array.isArray(t.description) || (t.description !== null && typeof t.description === \"object\") ? (\n                            <SyntaxHighlighter language=\"json\" wrapLines wrapLongLines className={styles.tCodeBlock} style={a11yLight}>\n                                {JSON.stringify(t.description, (key, value) => truncateImageUrl(value), 2)}\n                            </SyntaxHighlighter>\n                        ) : (\n                            <div>{t.description}</div>\n                        )}\n                    </li>\n                );\n            })}\n        </ul>\n    );\n};\n","import { useMsal } from \"@azure/msal-react\";\nimport { Pivot, PivotItem } from \"@fluentui/react\";\nimport { useEffect, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { ChatAppResponse, getHeaders } from \"../../api\";\nimport { getToken, useLogin } from \"../../authConfig\";\nimport { MarkdownViewer } from \"../MarkdownViewer\";\nimport { SupportingContent } from \"../SupportingContent\";\nimport styles from \"./AnalysisPanel.module.css\";\nimport { AnalysisPanelTabs } from \"./AnalysisPanelTabs\";\nimport { ThoughtProcess } from \"./ThoughtProcess\";\n\ninterface Props {\n    className: string;\n    activeTab: AnalysisPanelTabs;\n    onActiveTabChanged: (tab: AnalysisPanelTabs) => void;\n    activeCitation: string | undefined;\n    citationHeight: string;\n    answer: ChatAppResponse;\n    onCitationClicked?: (citationFilePath: string) => void;\n}\n\nconst pivotItemDisabledStyle = { disabled: true, style: { color: \"grey\" } };\n\nexport const AnalysisPanel = ({ answer, activeTab, activeCitation, citationHeight, className, onActiveTabChanged, onCitationClicked }: Props) => {\n    const isDisabledThoughtProcessTab: boolean = !answer.context.thoughts;\n    const dataPoints = answer.context.data_points;\n    const hasSupportingContent = Boolean(\n        dataPoints &&\n            ((dataPoints.text && dataPoints.text.length > 0) ||\n                (dataPoints.images && dataPoints.images.length > 0) ||\n                (dataPoints.external_results_metadata && dataPoints.external_results_metadata.length > 0))\n    );\n    const isDisabledSupportingContentTab: boolean = !hasSupportingContent;\n    const isDisabledCitationTab: boolean = !activeCitation;\n    const [citation, setCitation] = useState(\"\");\n\n    const client = useLogin ? useMsal().instance : undefined;\n    const { t } = useTranslation();\n\n    const fetchCitation = async () => {\n        const token = client ? await getToken(client) : undefined;\n        if (activeCitation) {\n            // Get hash from the URL as it may contain #page=N\n            // which helps browser PDF renderer jump to correct page N\n            const originalHash = activeCitation.indexOf(\"#\") ? activeCitation.split(\"#\")[1] : \"\";\n            const response = await fetch(activeCitation, {\n                method: \"GET\",\n                headers: await getHeaders(token)\n            });\n            const citationContent = await response.blob();\n            let citationObjectUrl = URL.createObjectURL(citationContent);\n            // Add hash back to the new blob URL\n            if (originalHash) {\n                citationObjectUrl += \"#\" + originalHash;\n            }\n            setCitation(citationObjectUrl);\n        }\n    };\n    useEffect(() => {\n        fetchCitation();\n    }, []);\n\n    const renderFileViewer = () => {\n        if (!activeCitation) {\n            return null;\n        }\n\n        const fileExtension = activeCitation.split(\".\").pop()?.toLowerCase();\n        switch (fileExtension) {\n            case \"png\":\n                return <img src={citation} className={styles.citationImg} alt=\"Citation Image\" />;\n            case \"md\":\n                return <MarkdownViewer src={activeCitation} />;\n            default:\n                return <iframe title=\"Citation\" src={citation} width=\"100%\" height={citationHeight} />;\n        }\n    };\n\n    return (\n        <Pivot\n            className={className}\n            selectedKey={activeTab}\n            onLinkClick={pivotItem => pivotItem && onActiveTabChanged(pivotItem.props.itemKey! as AnalysisPanelTabs)}\n        >\n            <PivotItem\n                itemKey={AnalysisPanelTabs.ThoughtProcessTab}\n                headerText={t(\"headerTexts.thoughtProcess\")}\n                headerButtonProps={isDisabledThoughtProcessTab ? pivotItemDisabledStyle : undefined}\n            >\n                <ThoughtProcess thoughts={answer.context.thoughts || []} onCitationClicked={onCitationClicked} />\n            </PivotItem>\n            <PivotItem\n                itemKey={AnalysisPanelTabs.SupportingContentTab}\n                headerText={t(\"headerTexts.supportingContent\")}\n                headerButtonProps={isDisabledSupportingContentTab ? pivotItemDisabledStyle : undefined}\n            >\n                <SupportingContent supportingContent={answer.context.data_points} />\n            </PivotItem>\n            <PivotItem\n                itemKey={AnalysisPanelTabs.CitationTab}\n                headerText={t(\"headerTexts.citation\")}\n                headerButtonProps={isDisabledCitationTab ? pivotItemDisabledStyle : undefined}\n            >\n                {renderFileViewer()}\n            </PivotItem>\n        </Pivot>\n    );\n};\n","import { useState, useCallback } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./HistoryItem.module.css\";\nimport { DefaultButton } from \"@fluentui/react\";\nimport { Delete24Regular } from \"@fluentui/react-icons\";\n\nexport interface HistoryData {\n    id: string;\n    title: string;\n    timestamp: number;\n}\n\ninterface HistoryItemProps {\n    item: HistoryData;\n    onSelect: (id: string) => void;\n    onDelete: (id: string) => void;\n}\n\nexport function HistoryItem({ item, onSelect, onDelete }: HistoryItemProps) {\n    const [isModalOpen, setIsModalOpen] = useState(false);\n\n    const handleDelete = useCallback(() => {\n        setIsModalOpen(false);\n        onDelete(item.id);\n    }, [item.id, onDelete]);\n\n    return (\n        <div className={styles.historyItem}>\n            <button onClick={() => onSelect(item.id)} className={styles.historyItemButton}>\n                <div className={styles.historyItemTitle}>{item.title}</div>\n            </button>\n            <button onClick={() => setIsModalOpen(true)} className={styles.deleteButton} aria-label=\"delete this chat history\">\n                <Delete24Regular className={styles.deleteIcon} />\n            </button>\n            <DeleteHistoryModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} onConfirm={handleDelete} />\n        </div>\n    );\n}\n\nfunction DeleteHistoryModal({ isOpen, onClose, onConfirm }: { isOpen: boolean; onClose: () => void; onConfirm: () => void }) {\n    if (!isOpen) return null;\n    const { t } = useTranslation();\n    return (\n        <div className={styles.modalOverlay}>\n            <div className={styles.modalContent}>\n                <h2 className={styles.modalTitle}>{t(\"history.deleteModalTitle\")}</h2>\n                <p className={styles.modalDescription}>{t(\"history.deleteModalDescription\")}</p>\n                <div className={styles.modalActions}>\n                    <DefaultButton onClick={onClose} className={styles.modalCancelButton}>\n                        {t(\"history.cancelLabel\")}\n                    </DefaultButton>\n                    <DefaultButton onClick={onConfirm} className={styles.modalConfirmButton}>\n                        {t(\"history.deleteLabel\")}\n                    </DefaultButton>\n                </div>\n            </div>\n        </div>\n    );\n}\n","import { ChatAppResponse } from \"../../api\";\n\nexport type HistoryMetaData = { id: string; title: string; timestamp: number };\nexport type Answers = [user: string, response: ChatAppResponse][];\n\nexport const enum HistoryProviderOptions {\n    None = \"none\",\n    IndexedDB = \"indexedDB\",\n    CosmosDB = \"cosmosDB\"\n}\n\nexport interface IHistoryProvider {\n    getProviderName(): HistoryProviderOptions;\n    resetContinuationToken(): void;\n    getNextItems(count: number, idToken?: string): Promise<HistoryMetaData[]>;\n    addItem(id: string, answers: Answers, idToken?: string): Promise<void>;\n    getItem(id: string, idToken?: string): Promise<Answers | null>;\n    deleteItem(id: string, idToken?: string): Promise<void>;\n}\n","import { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\n\nexport class NoneProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.None;\n    resetContinuationToken(): void {\n        return;\n    }\n    async getNextItems(count: number): Promise<HistoryMetaData[]> {\n        return [];\n    }\n    async addItem(id: string, answers: Answers): Promise<void> {\n        return;\n    }\n    async getItem(id: string): Promise<null> {\n        return null;\n    }\n    async deleteItem(id: string): Promise<void> {\n        return;\n    }\n}\n","import { IDBPDatabase, openDB } from \"idb\";\nimport { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\n\nexport class IndexedDBProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.IndexedDB;\n\n    private dbName: string;\n    private storeName: string;\n    private dbPromise: Promise<IDBPDatabase> | null = null;\n    private cursorKey: IDBValidKey | undefined;\n    private isCusorEnd: boolean = false;\n\n    constructor(dbName: string, storeName: string) {\n        this.dbName = dbName;\n        this.storeName = storeName;\n        this.cursorKey = undefined;\n        this.isCusorEnd = false;\n    }\n\n    private async init() {\n        const storeName = this.storeName;\n        if (!this.dbPromise) {\n            this.dbPromise = openDB(this.dbName, 1, {\n                upgrade(db) {\n                    if (!db.objectStoreNames.contains(storeName)) {\n                        const store = db.createObjectStore(storeName, { keyPath: \"id\" });\n                        store.createIndex(\"timestamp\", \"timestamp\");\n                    }\n                }\n            });\n        }\n        return this.dbPromise;\n    }\n\n    resetContinuationToken() {\n        this.cursorKey = undefined;\n        this.isCusorEnd = false;\n    }\n\n    async getNextItems(count: number): Promise<HistoryMetaData[]> {\n        const db = await this.init();\n        const tx = db.transaction(this.storeName, \"readonly\");\n        const store = tx.objectStore(this.storeName);\n        const index = store.index(\"timestamp\");\n\n        // return empty array if cursor is already at the end\n        if (this.isCusorEnd) {\n            return [];\n        }\n\n        // set cursor to the last key\n        let cursor = this.cursorKey ? await index.openCursor(IDBKeyRange.upperBound(this.cursorKey), \"prev\") : await index.openCursor(null, \"prev\");\n\n        // return empty array means no more history or no data. set isCursorEnd to true and return empty array\n        if (!cursor) {\n            this.isCusorEnd = true;\n            return [];\n        }\n\n        const loadedItems: { id: string; title: string; timestamp: number; answers: Answers }[] = [];\n        for (let i = 0; i < count && cursor; i++) {\n            loadedItems.push(cursor.value);\n            cursor = await cursor.continue();\n        }\n\n        // set isCursorEnd to true if cursor is null\n        if (!cursor) {\n            this.isCusorEnd = true;\n        }\n\n        // update cursorKey\n        this.cursorKey = cursor?.key;\n\n        return loadedItems;\n    }\n\n    async addItem(id: string, answers: Answers): Promise<void> {\n        const timestamp = new Date().getTime();\n        const db = await this.init(); // \n        const tx = db.transaction(this.storeName, \"readwrite\");\n        const current = await tx.objectStore(this.storeName).get(id);\n        if (current) {\n            await tx.objectStore(this.storeName).put({ ...current, id, timestamp, answers });\n        } else {\n            const title = answers[0][0].length > 50 ? answers[0][0].substring(0, 50) + \"...\" : answers[0][0];\n            await tx.objectStore(this.storeName).add({ id, title, timestamp, answers });\n        }\n        await tx.done;\n        return;\n    }\n\n    async getItem(id: string): Promise<Answers | null> {\n        const db = await this.init();\n        const tx = db.transaction(this.storeName, \"readonly\");\n        const item = await tx.objectStore(this.storeName).get(id);\n        return item ? item.answers : null;\n    }\n\n    async deleteItem(id: string): Promise<void> {\n        const db = await this.init();\n        await db.delete(this.storeName, id);\n        return;\n    }\n}\n","import { IHistoryProvider, Answers, HistoryProviderOptions, HistoryMetaData } from \"./IProvider\";\nimport { deleteChatHistoryApi, getChatHistoryApi, getChatHistoryListApi, postChatHistoryApi } from \"../../api\";\n\nexport class CosmosDBProvider implements IHistoryProvider {\n    getProviderName = () => HistoryProviderOptions.CosmosDB;\n\n    private continuationToken: string | undefined;\n    private isItemEnd: boolean = false;\n\n    resetContinuationToken() {\n        this.continuationToken = undefined;\n        this.isItemEnd = false;\n    }\n\n    async getNextItems(count: number, idToken?: string): Promise<HistoryMetaData[]> {\n        if (this.isItemEnd) {\n            return [];\n        }\n\n        try {\n            const response = await getChatHistoryListApi(count, this.continuationToken, idToken || \"\");\n            this.continuationToken = response.continuation_token;\n            if (!this.continuationToken) {\n                this.isItemEnd = true;\n            }\n            return response.sessions.map(session => ({\n                id: session.id,\n                title: session.title,\n                timestamp: session.timestamp\n            }));\n        } catch (e) {\n            console.error(e);\n            return [];\n        }\n    }\n\n    async addItem(id: string, answers: Answers, idToken?: string): Promise<void> {\n        await postChatHistoryApi({ id, answers }, idToken || \"\");\n        return;\n    }\n\n    async getItem(id: string, idToken?: string): Promise<Answers | null> {\n        const response = await getChatHistoryApi(id, idToken || \"\");\n        return response.answers || null;\n    }\n\n    async deleteItem(id: string, idToken?: string): Promise<void> {\n        await deleteChatHistoryApi(id, idToken || \"\");\n        return;\n    }\n}\n","import { useMemo } from \"react\";\nimport { IHistoryProvider, HistoryProviderOptions } from \"../HistoryProviders/IProvider\";\nimport { NoneProvider } from \"../HistoryProviders/None\";\nimport { IndexedDBProvider } from \"../HistoryProviders/IndexedDB\";\nimport { CosmosDBProvider } from \"../HistoryProviders/CosmosDB\";\n\nexport const useHistoryManager = (provider: HistoryProviderOptions): IHistoryProvider => {\n    const providerInstance = useMemo(() => {\n        switch (provider) {\n            case HistoryProviderOptions.IndexedDB:\n                return new IndexedDBProvider(\"chat-database\", \"chat-history\");\n            case HistoryProviderOptions.CosmosDB:\n                return new CosmosDBProvider();\n            case HistoryProviderOptions.None:\n            default:\n                return new NoneProvider();\n        }\n    }, [provider]);\n\n    return providerInstance;\n};\n","import { useMsal } from \"@azure/msal-react\";\nimport { getToken, useLogin } from \"../../authConfig\";\nimport { Panel, PanelType, Spinner } from \"@fluentui/react\";\nimport { useEffect, useMemo, useRef, useState } from \"react\";\nimport { HistoryData, HistoryItem } from \"../HistoryItem\";\nimport { Answers, HistoryProviderOptions } from \"../HistoryProviders/IProvider\";\nimport { useHistoryManager, HistoryMetaData } from \"../HistoryProviders\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./HistoryPanel.module.css\";\n\nconst HISTORY_COUNT_PER_LOAD = 20;\n\nexport const HistoryPanel = ({\n    provider,\n    isOpen,\n    notify,\n    onClose,\n    onChatSelected\n}: {\n    provider: HistoryProviderOptions;\n    isOpen: boolean;\n    notify: boolean;\n    onClose: () => void;\n    onChatSelected: (answers: Answers) => void;\n}) => {\n    const historyManager = useHistoryManager(provider);\n    const [history, setHistory] = useState<HistoryMetaData[]>([]);\n    const [isLoading, setIsLoading] = useState(false);\n    const [hasMoreHistory, setHasMoreHistory] = useState(false);\n\n    const client = useLogin ? useMsal().instance : undefined;\n\n    useEffect(() => {\n        if (!isOpen) return;\n        if (notify) {\n            setHistory([]);\n            historyManager.resetContinuationToken();\n            setHasMoreHistory(true);\n        }\n    }, [isOpen, notify]);\n\n    const loadMoreHistory = async () => {\n        setIsLoading(() => true);\n        const token = client ? await getToken(client) : undefined;\n        const items = await historyManager.getNextItems(HISTORY_COUNT_PER_LOAD, token);\n        if (items.length === 0) {\n            setHasMoreHistory(false);\n        }\n        setHistory(prevHistory => [...prevHistory, ...items]);\n        setIsLoading(() => false);\n    };\n\n    const handleSelect = async (id: string) => {\n        const token = client ? await getToken(client) : undefined;\n        const item = await historyManager.getItem(id, token);\n        if (item) {\n            onChatSelected(item);\n        }\n    };\n\n    const handleDelete = async (id: string) => {\n        const token = client ? await getToken(client) : undefined;\n        await historyManager.deleteItem(id, token);\n        setHistory(prevHistory => prevHistory.filter(item => item.id !== id));\n    };\n\n    const groupedHistory = useMemo(() => groupHistory(history), [history]);\n\n    const { t } = useTranslation();\n\n    return (\n        <Panel\n            type={PanelType.customNear}\n            style={{ padding: \"0px\" }}\n            headerText={t(\"history.chatHistory\")}\n            customWidth=\"300px\"\n            isBlocking={false}\n            isOpen={isOpen}\n            onDismiss={() => onClose()}\n            onDismissed={() => {\n                setHistory([]);\n                setHasMoreHistory(true);\n                historyManager.resetContinuationToken();\n            }}\n        >\n            <div>\n                {Object.entries(groupedHistory).map(([group, items]) => (\n                    <div key={group} className={styles.group}>\n                        <p className={styles.groupLabel}>{t(group)}</p>\n                        {items.map(item => (\n                            <HistoryItem key={item.id} item={item} onSelect={handleSelect} onDelete={handleDelete} />\n                        ))}\n                    </div>\n                ))}\n                {isLoading && <Spinner style={{ marginTop: \"10px\" }} />}\n                {history.length === 0 && !isLoading && <p>{t(\"history.noHistory\")}</p>}\n                {hasMoreHistory && !isLoading && <InfiniteLoadingButton func={loadMoreHistory} />}\n            </div>\n        </Panel>\n    );\n};\n\nfunction groupHistory(history: HistoryData[]) {\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n    const lastWeek = new Date(today);\n    lastWeek.setDate(lastWeek.getDate() - 7);\n    const lastMonth = new Date(today);\n    lastMonth.setDate(lastMonth.getDate() - 30);\n\n    return history.reduce(\n        (groups, item) => {\n            const itemDate = new Date(item.timestamp);\n            let group;\n\n            if (itemDate >= today) {\n                group = \"history.today\";\n            } else if (itemDate >= yesterday) {\n                group = \"history.yesterday\";\n            } else if (itemDate >= lastWeek) {\n                group = \"history.last7days\";\n            } else if (itemDate >= lastMonth) {\n                group = \"history.last30days\";\n            } else {\n                group = itemDate.toLocaleDateString(undefined, { year: \"numeric\", month: \"long\" });\n            }\n\n            if (!groups[group]) {\n                groups[group] = [];\n            }\n            groups[group].push(item);\n            return groups;\n        },\n        {} as Record<string, HistoryData[]>\n    );\n}\n\nconst InfiniteLoadingButton = ({ func }: { func: () => void }) => {\n    const buttonRef = useRef(null);\n\n    useEffect(() => {\n        const observer = new IntersectionObserver(\n            entries => {\n                entries.forEach(entry => {\n                    if (entry.isIntersecting) {\n                        if (buttonRef.current) {\n                            func();\n                        }\n                    }\n                });\n            },\n            {\n                root: null,\n                threshold: 0\n            }\n        );\n\n        if (buttonRef.current) {\n            observer.observe(buttonRef.current);\n        }\n\n        return () => {\n            if (buttonRef.current) {\n                observer.unobserve(buttonRef.current);\n            }\n        };\n    }, []);\n\n    return <button ref={buttonRef} onClick={func} />;\n};\n","import { History24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./HistoryButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n    disabled?: boolean;\n}\n\nexport const HistoryButton = ({ className, disabled, onClick }: Props) => {\n    const { t } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<History24Regular />} disabled={disabled} onClick={onClick}>\n                {t(\"history.openChatHistory\")}\n            </Button>\n        </div>\n    );\n};\n","import { Settings24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./SettingsButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n}\n\nexport const SettingsButton = ({ className, onClick }: Props) => {\n    const { t } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<Settings24Regular />} onClick={onClick}>\n                {t(\"developerSettings\")}\n            </Button>\n        </div>\n    );\n};\n","import { Delete24Regular } from \"@fluentui/react-icons\";\nimport { Button } from \"@fluentui/react-components\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./ClearChatButton.module.css\";\n\ninterface Props {\n    className?: string;\n    onClick: () => void;\n    disabled?: boolean;\n}\n\nexport const ClearChatButton = ({ className, disabled, onClick }: Props) => {\n    const { t, i18n } = useTranslation();\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <Button icon={<Delete24Regular />} disabled={disabled} onClick={onClick}>\n                {t(\"clearChat\")}\n            </Button>\n        </div>\n    );\n};\n","import React, { useState, ChangeEvent } from \"react\";\nimport { Callout, Label, Text } from \"@fluentui/react\";\nimport { Button } from \"@fluentui/react-components\";\nimport { Add24Regular, Delete24Regular } from \"@fluentui/react-icons\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport { SimpleAPIResponse, uploadFileApi, deleteUploadedFileApi, listUploadedFilesApi } from \"../../api\";\nimport { useLogin, getToken } from \"../../authConfig\";\nimport styles from \"./UploadFile.module.css\";\n\ninterface Props {\n    className?: string;\n    disabled?: boolean;\n}\n\nexport const UploadFile: React.FC<Props> = ({ className, disabled }: Props) => {\n    // State variables to manage the component behavior\n    const [isCalloutVisible, setIsCalloutVisible] = useState<boolean>(false);\n    const [isUploading, setIsUploading] = useState<boolean>(false);\n    const [isLoading, setIsLoading] = useState<boolean>(true);\n    const [deletionStatus, setDeletionStatus] = useState<{ [filename: string]: \"pending\" | \"error\" | \"success\" }>({});\n    const [uploadedFile, setUploadedFile] = useState<SimpleAPIResponse>();\n    const [uploadedFileError, setUploadedFileError] = useState<string>();\n    const [uploadedFiles, setUploadedFiles] = useState<string[]>([]);\n    const { t } = useTranslation();\n\n    if (!useLogin) {\n        throw new Error(\"The UploadFile component requires useLogin to be true\");\n    }\n\n    const client = useMsal().instance;\n\n    // Handler for the \"Manage file uploads\" button\n    const handleButtonClick = async () => {\n        setIsCalloutVisible(!isCalloutVisible); // Toggle the Callout visibility\n\n        // Update uploaded files by calling the API\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n            listUploadedFiles(idToken);\n        } catch (error) {\n            console.error(error);\n            setIsLoading(false);\n        }\n    };\n\n    const listUploadedFiles = async (idToken: string) => {\n        listUploadedFilesApi(idToken).then(files => {\n            setIsLoading(false);\n            setDeletionStatus({});\n            setUploadedFiles(files);\n        });\n    };\n\n    const handleRemoveFile = async (filename: string) => {\n        setDeletionStatus({ ...deletionStatus, [filename]: \"pending\" });\n\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n\n            await deleteUploadedFileApi(filename, idToken);\n            setDeletionStatus({ ...deletionStatus, [filename]: \"success\" });\n            listUploadedFiles(idToken);\n        } catch (error) {\n            setDeletionStatus({ ...deletionStatus, [filename]: \"error\" });\n            console.error(error);\n        }\n    };\n\n    // Handler for the form submission (file upload)\n    const handleUploadFile = async (e: ChangeEvent<HTMLInputElement>) => {\n        e.preventDefault();\n        if (!e.target.files || e.target.files.length === 0) {\n            return;\n        }\n        setIsUploading(true); // Start the loading state\n        const file: File = e.target.files[0];\n        const formData = new FormData();\n        formData.append(\"file\", file);\n\n        try {\n            const idToken = await getToken(client);\n            if (!idToken) {\n                throw new Error(\"No authentication token available\");\n            }\n            const response: SimpleAPIResponse = await uploadFileApi(formData, idToken);\n            setUploadedFile(response);\n            setIsUploading(false);\n            setUploadedFileError(undefined);\n            listUploadedFiles(idToken);\n        } catch (error) {\n            console.error(error);\n            setIsUploading(false);\n            setUploadedFileError(t(\"upload.uploadedFileError\"));\n        }\n    };\n\n    return (\n        <div className={`${styles.container} ${className ?? \"\"}`}>\n            <div>\n                <Button id=\"calloutButton\" icon={<Add24Regular />} disabled={disabled} onClick={handleButtonClick}>\n                    {t(\"upload.manageFileUploads\")}\n                </Button>\n\n                {isCalloutVisible && (\n                    <Callout\n                        role=\"dialog\"\n                        gapSpace={0}\n                        className={styles.callout}\n                        target=\"#calloutButton\"\n                        onDismiss={() => setIsCalloutVisible(false)}\n                        setInitialFocus\n                    >\n                        <form encType=\"multipart/form-data\">\n                            <div>\n                                <Label>{t(\"upload.fileLabel\")}</Label>\n                                <input\n                                    accept=\".txt, .md, .json, .png, .jpg, .jpeg, .bmp, .heic, .tiff, .pdf, .docx, .xlsx, .pptx, .html\"\n                                    className={styles.chooseFiles}\n                                    type=\"file\"\n                                    onChange={handleUploadFile}\n                                />\n                            </div>\n                        </form>\n\n                        {/* Show a loading message while files are being uploaded */}\n                        {isUploading && <Text>{t(\"upload.uploadingFiles\")}</Text>}\n                        {!isUploading && uploadedFileError && <Text>{uploadedFileError}</Text>}\n                        {!isUploading && uploadedFile && <Text>{uploadedFile.message}</Text>}\n\n                        {/* Display the list of already uploaded */}\n                        <h3>{t(\"upload.uploadedFilesLabel\")}</h3>\n\n                        {isLoading && <Text>{t(\"upload.loading\")}</Text>}\n                        {!isLoading && uploadedFiles.length === 0 && <Text>{t(\"upload.noFilesUploaded\")}</Text>}\n                        {uploadedFiles.map((filename, index) => {\n                            return (\n                                <div key={index} className={styles.list}>\n                                    <div className={styles.item}>{filename}</div>\n                                    {/* Button to remove a file from the list */}\n                                    <Button\n                                        icon={<Delete24Regular />}\n                                        onClick={() => handleRemoveFile(filename)}\n                                        disabled={deletionStatus[filename] === \"pending\" || deletionStatus[filename] === \"success\"}\n                                    >\n                                        {!deletionStatus[filename] && t(\"upload.deleteFile\")}\n                                        {deletionStatus[filename] == \"pending\" && t(\"upload.deletingFile\")}\n                                        {deletionStatus[filename] == \"error\" && t(\"upload.errorDeleting\")}\n                                        {deletionStatus[filename] == \"success\" && t(\"upload.fileDeleted\")}\n                                    </Button>\n                                </div>\n                            );\n                        })}\n                    </Callout>\n                )}\n            </div>\n        </div>\n    );\n};\n","import { Label } from \"@fluentui/react\";\nimport { useMsal } from \"@azure/msal-react\";\nimport {\n    DataGridBody,\n    DataGridRow,\n    DataGrid,\n    DataGridHeader,\n    DataGridHeaderCell,\n    DataGridCell,\n    createTableColumn,\n    TableColumnDefinition\n} from \"@fluentui/react-table\";\nimport { getTokenClaims } from \"../../authConfig\";\nimport { useState, useEffect } from \"react\";\n\ntype Claim = {\n    name: string;\n    value: string;\n};\n\nexport const TokenClaimsDisplay = () => {\n    const { instance } = useMsal();\n    const activeAccount = instance.getActiveAccount();\n    const [claims, setClaims] = useState<Record<string, unknown> | undefined>(undefined);\n\n    useEffect(() => {\n        const fetchClaims = async () => {\n            setClaims(await getTokenClaims(instance));\n        };\n\n        fetchClaims();\n    }, []);\n\n    const ToString = (a: string | any) => {\n        if (typeof a === \"string\") {\n            return a;\n        } else {\n            return JSON.stringify(a);\n        }\n    };\n\n    let createClaims = (o: Record<string, unknown> | undefined) => {\n        return Object.keys(o ?? {}).map((key: string) => {\n            let originalKey = key;\n            try {\n                // Some claim names may be a URL to a full schema, just use the last part of the URL in this case\n                const url = new URL(key);\n                const parts = url.pathname.split(\"/\");\n                key = parts[parts.length - 1];\n            } catch (error) {\n                // Do not parse key if it's not a URL\n            }\n            return { name: key, value: ToString((o ?? {})[originalKey]) };\n        });\n    };\n    const items: Claim[] = createClaims(claims);\n\n    const columns: TableColumnDefinition<Claim>[] = [\n        createTableColumn<Claim>({\n            columnId: \"name\",\n            compare: (a: Claim, b: Claim) => {\n                return a.name.localeCompare(b.name);\n            },\n            renderHeaderCell: () => {\n                return \"Name\";\n            },\n            renderCell: item => {\n                return item.name;\n            }\n        }),\n        createTableColumn<Claim>({\n            columnId: \"value\",\n            compare: (a: Claim, b: Claim) => {\n                return a.value.localeCompare(b.value);\n            },\n            renderHeaderCell: () => {\n                return \"Value\";\n            },\n            renderCell: item => {\n                return item.value;\n            }\n        })\n    ];\n\n    return (\n        <div style={{ marginTop: \"20px\" }}>\n            <Label>ID Token Claims</Label>\n            <DataGrid items={items} columns={columns} sortable getRowId={item => item.name}>\n                <DataGridHeader>\n                    <DataGridRow>{({ renderHeaderCell }) => <DataGridHeaderCell>{renderHeaderCell()}</DataGridHeaderCell>}</DataGridRow>\n                </DataGridHeader>\n                <DataGridBody<Claim>>\n                    {({ item, rowId }) => <DataGridRow<Claim> key={rowId}>{({ renderCell }) => <DataGridCell>{renderCell(item)}</DataGridCell>}</DataGridRow>}\n                </DataGridBody>\n            </DataGrid>\n        </div>\n    );\n};\n","import { useTranslation } from \"react-i18next\";\nimport { LocalLanguage24Regular } from \"@fluentui/react-icons\";\nimport { IDropdownOption, Dropdown } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\n\nimport { supportedLngs } from \"./config\";\nimport styles from \"./LanguagePicker.module.css\";\n\ninterface Props {\n    onLanguageChange: (language: string) => void;\n}\n\nexport const LanguagePicker = ({ onLanguageChange }: Props) => {\n    const { i18n } = useTranslation();\n\n    const handleLanguageChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<string> | undefined) => {\n        onLanguageChange(option?.data || i18n.language);\n    };\n    const languagePickerId = useId(\"languagePicker\");\n    const { t } = useTranslation();\n\n    return (\n        <div className={styles.languagePicker}>\n            <LocalLanguage24Regular className={styles.languagePickerIcon} />\n            <Dropdown\n                id={languagePickerId}\n                selectedKey={i18n.language}\n                options={Object.entries(supportedLngs).map(([code, details]) => ({\n                    key: code,\n                    text: details.name,\n                    selected: code === i18n.language,\n                    data: code\n                }))}\n                onChange={handleLanguageChange}\n                ariaLabel={t(\"labels.languagePicker\")}\n            />\n        </div>\n    );\n};\n","import { ITextFieldProps, DefaultButton, IconButton, IButtonStyles, Callout, IStackTokens, Stack, IStackStyles, initializeIcons } from \"@fluentui/react\";\nimport { useBoolean, useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\n\nconst stackTokens: IStackTokens = {\n    childrenGap: 4,\n    maxWidth: 300\n};\n\nconst labelCalloutStackStyles: Partial<IStackStyles> = { root: { padding: 20 } };\nconst iconButtonStyles: Partial<IButtonStyles> = { root: { marginBottom: -3 } };\nconst iconProps = { iconName: \"Info\" };\n\ninterface IHelpCalloutProps {\n    label: string | undefined;\n    labelId: string;\n    fieldId: string | undefined;\n    helpText: string;\n}\n\nexport const HelpCallout = (props: IHelpCalloutProps): JSX.Element => {\n    const [isCalloutVisible, { toggle: toggleIsCalloutVisible }] = useBoolean(false);\n    const descriptionId: string = useId(\"description\");\n    const iconButtonId: string = useId(\"iconButton\");\n    const { t } = useTranslation();\n\n    return (\n        <>\n            <Stack horizontal verticalAlign=\"center\" tokens={stackTokens}>\n                <label id={props.labelId} htmlFor={props.fieldId}>\n                    {props.label}\n                </label>\n                <IconButton\n                    id={iconButtonId}\n                    iconProps={iconProps}\n                    title={t(\"tooltips.info\")}\n                    ariaLabel={t(\"tooltips.info\")}\n                    onClick={toggleIsCalloutVisible}\n                    styles={iconButtonStyles}\n                />\n            </Stack>\n            {isCalloutVisible && (\n                <Callout target={\"#\" + iconButtonId} setInitialFocus onDismiss={toggleIsCalloutVisible} ariaDescribedBy={descriptionId} role=\"alertdialog\">\n                    <Stack tokens={stackTokens} horizontalAlign=\"start\" styles={labelCalloutStackStyles}>\n                        <span id={descriptionId}>{props.helpText}</span>\n                        <DefaultButton onClick={toggleIsCalloutVisible}>{t(\"labels.closeButton\")}</DefaultButton>\n                    </Stack>\n                </Callout>\n            )}\n        </>\n    );\n};\n","import { useEffect, useState } from \"react\";\nimport { Stack, IDropdownOption, Dropdown, Checkbox, IDropdownProps } from \"@fluentui/react\";\nimport { useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./VectorSettings.module.css\";\nimport { HelpCallout } from \"../../components/HelpCallout\";\nimport { RetrievalMode } from \"../../api\";\n\ninterface Props {\n    showImageOptions?: boolean;\n    defaultRetrievalMode: RetrievalMode;\n    defaultSearchTextEmbeddings?: boolean;\n    defaultSearchImageEmbeddings?: boolean;\n    updateRetrievalMode: (retrievalMode: RetrievalMode) => void;\n    updateSearchTextEmbeddings: (searchTextEmbeddings: boolean) => void;\n    updateSearchImageEmbeddings: (searchImageEmbeddings: boolean) => void;\n}\n\nexport const VectorSettings = ({\n    updateRetrievalMode,\n    updateSearchTextEmbeddings,\n    updateSearchImageEmbeddings,\n    showImageOptions,\n    defaultRetrievalMode,\n    defaultSearchTextEmbeddings = true,\n    defaultSearchImageEmbeddings = true\n}: Props) => {\n    const [retrievalMode, setRetrievalMode] = useState<RetrievalMode>(defaultRetrievalMode || RetrievalMode.Hybrid);\n    const [searchTextEmbeddings, setSearchTextEmbeddings] = useState<boolean>(defaultSearchTextEmbeddings);\n    const [searchImageEmbeddings, setSearchImageEmbeddings] = useState<boolean>(defaultSearchImageEmbeddings);\n\n    const onRetrievalModeChange = (_ev: React.FormEvent<HTMLDivElement>, option?: IDropdownOption<RetrievalMode> | undefined) => {\n        setRetrievalMode(option?.data || RetrievalMode.Hybrid);\n        updateRetrievalMode(option?.data || RetrievalMode.Hybrid);\n    };\n\n    const onSearchTextEmbeddingsChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setSearchTextEmbeddings(checked || false);\n        updateSearchTextEmbeddings(checked || false);\n    };\n\n    const onSearchImageEmbeddingsChange = (_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, checked?: boolean) => {\n        setSearchImageEmbeddings(checked || false);\n        updateSearchImageEmbeddings(checked || false);\n    };\n\n    // Only run if showImageOptions changes from true to false or false to true\n    useEffect(() => {\n        if (!showImageOptions) {\n            // If images are disabled, we must disable image embeddings\n            setSearchImageEmbeddings(false);\n            updateSearchImageEmbeddings(false);\n        } else {\n            // When image options become available, reset to default\n            setSearchImageEmbeddings(defaultSearchImageEmbeddings);\n            updateSearchImageEmbeddings(defaultSearchImageEmbeddings);\n        }\n    }, [showImageOptions, updateSearchImageEmbeddings, defaultSearchImageEmbeddings]);\n\n    const retrievalModeId = useId(\"retrievalMode\");\n    const retrievalModeFieldId = useId(\"retrievalModeField\");\n    const vectorFieldsId = useId(\"vectorFields\");\n    const vectorFieldsFieldId = useId(\"vectorFieldsField\");\n    const { t } = useTranslation();\n\n    return (\n        <Stack className={styles.container} tokens={{ childrenGap: 10 }}>\n            <Dropdown\n                id={retrievalModeFieldId}\n                label={t(\"labels.retrievalMode.label\")}\n                selectedKey={retrievalMode.toString()}\n                options={[\n                    {\n                        key: \"hybrid\",\n                        text: t(\"labels.retrievalMode.options.hybrid\"),\n                        selected: retrievalMode == RetrievalMode.Hybrid,\n                        data: RetrievalMode.Hybrid\n                    },\n                    {\n                        key: \"vectors\",\n                        text: t(\"labels.retrievalMode.options.vectors\"),\n                        selected: retrievalMode == RetrievalMode.Vectors,\n                        data: RetrievalMode.Vectors\n                    },\n                    { key: \"text\", text: t(\"labels.retrievalMode.options.texts\"), selected: retrievalMode == RetrievalMode.Text, data: RetrievalMode.Text }\n                ]}\n                required\n                onChange={onRetrievalModeChange}\n                aria-labelledby={retrievalModeId}\n                onRenderLabel={(props: IDropdownProps | undefined) => (\n                    <HelpCallout labelId={retrievalModeId} fieldId={retrievalModeFieldId} helpText={t(\"helpTexts.retrievalMode\")} label={props?.label} />\n                )}\n            />\n\n            {showImageOptions && [RetrievalMode.Vectors, RetrievalMode.Hybrid].includes(retrievalMode) && (\n                <fieldset className={styles.fieldset}>\n                    <legend className={styles.legend}>{t(\"labels.vector.label\")}</legend>\n                    <Stack tokens={{ childrenGap: 8 }}>\n                        <Checkbox\n                            id={vectorFieldsFieldId + \"-text\"}\n                            label={t(\"labels.vector.options.embedding\")}\n                            checked={searchTextEmbeddings}\n                            onChange={onSearchTextEmbeddingsChange}\n                            aria-labelledby={vectorFieldsId + \"-text\"}\n                            onRenderLabel={props => (\n                                <HelpCallout\n                                    labelId={vectorFieldsId + \"-text\"}\n                                    fieldId={vectorFieldsFieldId + \"-text\"}\n                                    helpText={t(\"helpTexts.textEmbeddings\")}\n                                    label={props?.label}\n                                />\n                            )}\n                        />\n                        <Checkbox\n                            id={vectorFieldsFieldId + \"-image\"}\n                            label={t(\"labels.vector.options.imageEmbedding\")}\n                            checked={searchImageEmbeddings}\n                            onChange={onSearchImageEmbeddingsChange}\n                            aria-labelledby={vectorFieldsId + \"-image\"}\n                            onRenderLabel={props => (\n                                <HelpCallout\n                                    labelId={vectorFieldsId + \"-image\"}\n                                    fieldId={vectorFieldsFieldId + \"-image\"}\n                                    helpText={t(\"helpTexts.imageEmbeddings\")}\n                                    label={props?.label}\n                                />\n                            )}\n                        />\n                    </Stack>\n                </fieldset>\n            )}\n        </Stack>\n    );\n};\n","import { useId } from \"@fluentui/react-hooks\";\nimport { useTranslation } from \"react-i18next\";\nimport { TextField, ITextFieldProps, Checkbox, ICheckboxProps, Dropdown, IDropdownProps, IDropdownOption, Stack } from \"@fluentui/react\";\nimport { HelpCallout } from \"../HelpCallout\";\nimport { VectorSettings } from \"../VectorSettings\";\nimport { RetrievalMode } from \"../../api\";\nimport styles from \"./Settings.module.css\";\n\n// Add type for onRenderLabel\ntype RenderLabelType = ITextFieldProps | IDropdownProps | ICheckboxProps;\n\nexport interface SettingsProps {\n    promptTemplate: string;\n    temperature: number;\n    retrieveCount: number;\n    agenticReasoningEffort: string;\n    seed: number | null;\n    minimumSearchScore: number;\n    minimumRerankerScore: number;\n    useSemanticRanker: boolean;\n    useSemanticCaptions: boolean;\n    useQueryRewriting: boolean;\n    reasoningEffort: string;\n    excludeCategory: string;\n    includeCategory: string;\n    retrievalMode: RetrievalMode;\n    sendTextSources: boolean;\n    sendImageSources: boolean;\n    searchTextEmbeddings: boolean;\n    searchImageEmbeddings: boolean;\n    showSemanticRankerOption: boolean;\n    showQueryRewritingOption: boolean;\n    showReasoningEffortOption: boolean;\n    showMultimodalOptions: boolean;\n    showVectorOption: boolean;\n    useLogin: boolean;\n    loggedIn: boolean;\n    requireAccessControl: boolean;\n    className?: string;\n    onChange: (field: string, value: any) => void;\n    streamingEnabled?: boolean; // Only used in chat\n    shouldStream?: boolean; // Only used in Chat\n    useSuggestFollowupQuestions?: boolean; // Only used in Chat\n    promptTemplatePrefix?: string;\n    promptTemplateSuffix?: string;\n    showAgenticRetrievalOption?: boolean;\n    useAgenticKnowledgeBase?: boolean;\n    hideMinimalRetrievalReasoningOption?: boolean;\n    useWebSource?: boolean;\n    showWebSourceOption?: boolean;\n    useSharePointSource?: boolean;\n    showSharePointSourceOption?: boolean;\n}\n\nexport const Settings = ({\n    promptTemplate,\n    temperature,\n    retrieveCount,\n    agenticReasoningEffort,\n    seed,\n    minimumSearchScore,\n    minimumRerankerScore,\n    useSemanticRanker,\n    useSemanticCaptions,\n    useQueryRewriting,\n    reasoningEffort,\n    excludeCategory,\n    includeCategory,\n    retrievalMode,\n    searchTextEmbeddings,\n    searchImageEmbeddings,\n    sendTextSources,\n    sendImageSources,\n    showSemanticRankerOption,\n    showQueryRewritingOption,\n    showReasoningEffortOption,\n    showMultimodalOptions,\n    showVectorOption,\n    useLogin,\n    loggedIn,\n    requireAccessControl,\n    className,\n    onChange,\n    streamingEnabled,\n    shouldStream,\n    useSuggestFollowupQuestions,\n    promptTemplatePrefix,\n    promptTemplateSuffix,\n    showAgenticRetrievalOption,\n    useAgenticKnowledgeBase = false,\n    hideMinimalRetrievalReasoningOption = false,\n    useWebSource = false,\n    showWebSourceOption = false,\n    useSharePointSource = false,\n    showSharePointSourceOption = false\n}: SettingsProps) => {\n    const { t } = useTranslation();\n\n    // Form field IDs\n    const promptTemplateId = useId(\"promptTemplate\");\n    const promptTemplateFieldId = useId(\"promptTemplateField\");\n    const temperatureId = useId(\"temperature\");\n    const temperatureFieldId = useId(\"temperatureField\");\n    const seedId = useId(\"seed\");\n    const seedFieldId = useId(\"seedField\");\n    const agenticRetrievalId = useId(\"agenticRetrieval\");\n    const agenticRetrievalFieldId = useId(\"agenticRetrievalField\");\n    const webSourceId = useId(\"webSource\");\n    const webSourceFieldId = useId(\"webSourceField\");\n    const sharePointSourceId = useId(\"sharePointSource\");\n    const sharePointSourceFieldId = useId(\"sharePointSourceField\");\n    const searchScoreId = useId(\"searchScore\");\n    const searchScoreFieldId = useId(\"searchScoreField\");\n    const rerankerScoreId = useId(\"rerankerScore\");\n    const rerankerScoreFieldId = useId(\"rerankerScoreField\");\n    const retrieveCountId = useId(\"retrieveCount\");\n    const retrieveCountFieldId = useId(\"retrieveCountField\");\n    const agenticReasoningEffortId = useId(\"agenticReasoningEffort\");\n    const agenticReasoningEffortFieldId = useId(\"agenticReasoningEffortField\");\n    const includeCategoryId = useId(\"includeCategory\");\n    const includeCategoryFieldId = useId(\"includeCategoryField\");\n    const excludeCategoryId = useId(\"excludeCategory\");\n    const excludeCategoryFieldId = useId(\"excludeCategoryField\");\n    const semanticRankerId = useId(\"semanticRanker\");\n    const semanticRankerFieldId = useId(\"semanticRankerField\");\n    const queryRewritingFieldId = useId(\"queryRewritingField\");\n    const reasoningEffortFieldId = useId(\"reasoningEffortField\");\n    const semanticCaptionsId = useId(\"semanticCaptions\");\n    const semanticCaptionsFieldId = useId(\"semanticCaptionsField\");\n    const shouldStreamId = useId(\"shouldStream\");\n    const shouldStreamFieldId = useId(\"shouldStreamField\");\n    const suggestFollowupQuestionsId = useId(\"suggestFollowupQuestions\");\n    const suggestFollowupQuestionsFieldId = useId(\"suggestFollowupQuestionsField\");\n\n    const webSourceDisablesStreamingAndFollowup = !!useWebSource;\n\n    const retrievalReasoningOptions: IDropdownOption[] = [\n        { key: \"minimal\", text: t(\"labels.agenticReasoningEffortOptions.minimal\") },\n        { key: \"low\", text: t(\"labels.agenticReasoningEffortOptions.low\") },\n        { key: \"medium\", text: t(\"labels.agenticReasoningEffortOptions.medium\") }\n    ];\n\n    const renderLabel = (props: RenderLabelType | undefined, labelId: string, fieldId: string, helpText: string) => (\n        <HelpCallout labelId={labelId} fieldId={fieldId} helpText={helpText} label={props?.label} />\n    );\n\n    return (\n        <div className={className}>\n            {streamingEnabled && (\n                <>\n                    <Checkbox\n                        id={shouldStreamFieldId}\n                        className={styles.settingsSeparator}\n                        checked={webSourceDisablesStreamingAndFollowup ? false : shouldStream}\n                        label={t(\"labels.shouldStream\")}\n                        onChange={(_ev, checked) => onChange(\"shouldStream\", !!checked)}\n                        aria-labelledby={shouldStreamId}\n                        disabled={webSourceDisablesStreamingAndFollowup}\n                        onRenderLabel={props => renderLabel(props, shouldStreamId, shouldStreamFieldId, t(\"helpTexts.streamChat\"))}\n                    />\n\n                    <Checkbox\n                        id={suggestFollowupQuestionsFieldId}\n                        className={styles.settingsSeparator}\n                        checked={webSourceDisablesStreamingAndFollowup ? false : useSuggestFollowupQuestions}\n                        label={t(\"labels.useSuggestFollowupQuestions\")}\n                        onChange={(_ev, checked) => onChange(\"useSuggestFollowupQuestions\", !!checked)}\n                        aria-labelledby={suggestFollowupQuestionsId}\n                        disabled={webSourceDisablesStreamingAndFollowup}\n                        onRenderLabel={props =>\n                            renderLabel(props, suggestFollowupQuestionsId, suggestFollowupQuestionsFieldId, t(\"helpTexts.suggestFollowupQuestions\"))\n                        }\n                    />\n                </>\n            )}\n\n            <h3 className={styles.sectionHeader}>{t(\"searchSettings\")}</h3>\n\n            {showAgenticRetrievalOption && (\n                <Checkbox\n                    id={agenticRetrievalFieldId}\n                    className={styles.settingsSeparator}\n                    checked={useAgenticKnowledgeBase}\n                    label={t(\"labels.useAgenticKnowledgeBase\")}\n                    onChange={(_ev, checked) => onChange(\"useAgenticKnowledgeBase\", !!checked)}\n                    aria-labelledby={agenticRetrievalId}\n                    onRenderLabel={props => renderLabel(props, agenticRetrievalId, agenticRetrievalFieldId, t(\"helpTexts.useAgenticKnowledgeBase\"))}\n                />\n            )}\n\n            {showAgenticRetrievalOption && useAgenticKnowledgeBase && (\n                <Dropdown\n                    id={agenticReasoningEffortFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.agenticReasoningEffort\")}\n                    selectedKey={agenticReasoningEffort}\n                    onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) => {\n                        const newValue = option?.key?.toString() ?? agenticReasoningEffort;\n                        onChange(\"agenticReasoningEffort\", newValue);\n                        // If selecting minimal, disable and deselect web source\n                        if (newValue === \"minimal\" && useWebSource) {\n                            onChange(\"useWebSource\", false);\n                        }\n                    }}\n                    aria-labelledby={agenticReasoningEffortId}\n                    options={retrievalReasoningOptions}\n                    onRenderLabel={props => renderLabel(props, agenticReasoningEffortId, agenticReasoningEffortFieldId, t(\"helpTexts.agenticReasoningEffort\"))}\n                />\n            )}\n\n            {showAgenticRetrievalOption && useAgenticKnowledgeBase && showWebSourceOption && (\n                <Checkbox\n                    id={webSourceFieldId}\n                    className={styles.settingsSeparator}\n                    checked={useWebSource}\n                    label={t(\"labels.useWebSource\")}\n                    onChange={(_ev, checked) => {\n                        onChange(\"useWebSource\", !!checked);\n                        // If enabling web source, disable streaming and follow-up questions\n                        if (checked) {\n                            if (shouldStream) {\n                                onChange(\"shouldStream\", false);\n                            }\n                            if (useSuggestFollowupQuestions) {\n                                onChange(\"useSuggestFollowupQuestions\", false);\n                            }\n                        }\n                    }}\n                    aria-labelledby={webSourceId}\n                    disabled={!useAgenticKnowledgeBase || agenticReasoningEffort === \"minimal\"}\n                    onRenderLabel={props => renderLabel(props, webSourceId, webSourceFieldId, t(\"helpTexts.useWebSource\"))}\n                />\n            )}\n            {showAgenticRetrievalOption && useAgenticKnowledgeBase && showSharePointSourceOption && (\n                <Checkbox\n                    id={sharePointSourceFieldId}\n                    className={styles.settingsSeparator}\n                    checked={useSharePointSource}\n                    label={t(\"labels.useSharePointSource\")}\n                    onChange={(_ev, checked) => onChange(\"useSharePointSource\", !!checked)}\n                    aria-labelledby={sharePointSourceId}\n                    disabled={!useAgenticKnowledgeBase}\n                    onRenderLabel={props => renderLabel(props, sharePointSourceId, sharePointSourceFieldId, t(\"helpTexts.useSharePointSource\"))}\n                />\n            )}\n            {!useAgenticKnowledgeBase && (\n                <TextField\n                    id={searchScoreFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.minimumSearchScore\")}\n                    type=\"number\"\n                    min={0}\n                    step={0.01}\n                    defaultValue={minimumSearchScore.toString()}\n                    onChange={(_ev, val) => onChange(\"minimumSearchScore\", parseFloat(val || \"0\"))}\n                    aria-labelledby={searchScoreId}\n                    onRenderLabel={props => renderLabel(props, searchScoreId, searchScoreFieldId, t(\"helpTexts.searchScore\"))}\n                />\n            )}\n\n            {showSemanticRankerOption && (\n                <TextField\n                    id={rerankerScoreFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.minimumRerankerScore\")}\n                    type=\"number\"\n                    min={1}\n                    max={4}\n                    step={0.1}\n                    defaultValue={minimumRerankerScore.toString()}\n                    onChange={(_ev, val) => onChange(\"minimumRerankerScore\", parseFloat(val || \"0\"))}\n                    aria-labelledby={rerankerScoreId}\n                    onRenderLabel={props => renderLabel(props, rerankerScoreId, rerankerScoreFieldId, t(\"helpTexts.rerankerScore\"))}\n                />\n            )}\n\n            {!useAgenticKnowledgeBase && (\n                <TextField\n                    id={retrieveCountFieldId}\n                    className={styles.settingsSeparator}\n                    label={t(\"labels.retrieveCount\")}\n                    type=\"number\"\n                    min={1}\n                    max={50}\n                    defaultValue={retrieveCount.toString()}\n                    onChange={(_ev, val) => onChange(\"retrieveCount\", parseInt(val || \"3\"))}\n                    aria-labelledby={retrieveCountId}\n                    onRenderLabel={props => renderLabel(props, retrieveCountId, retrieveCountFieldId, t(\"helpTexts.retrieveNumber\"))}\n                />\n            )}\n            <Dropdown\n                id={includeCategoryFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.includeCategory\")}\n                selectedKey={includeCategory}\n                onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) => onChange(\"includeCategory\", option?.key || \"\")}\n                aria-labelledby={includeCategoryId}\n                options={[\n                    { key: \"\", text: t(\"labels.includeCategoryOptions.all\") }\n                    // { key: \"example\", text: \"Example Category\" } // Add more categories as needed\n                ]}\n                onRenderLabel={props => renderLabel(props, includeCategoryId, includeCategoryFieldId, t(\"helpTexts.includeCategory\"))}\n            />\n            <TextField\n                id={excludeCategoryFieldId}\n                className={styles.settingsSeparator}\n                label={t(\"labels.excludeCategory\")}\n                defaultValue={excludeCategory}\n                onChange={(_ev, val) => onChange(\"excludeCategory\", val || \"\")}\n                aria-labelledby={excludeCategoryId}\n                onRenderLabel={props => renderLabel(props, excludeCategoryId, excludeCategoryFieldId, t(\"helpTexts.excludeCategory\"))}\n            />\n            {showSemanticRankerOption && !useAgenticKnowledgeBase && (\n                <>\n                    <Checkbox\n                        id={semanticRankerFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useSemanticRanker}\n                        label={t(\"labels.useSemanticRanker\")}\n                        onChange={(_ev, checked) => onChange(\"useSemanticRanker\", !!checked)}\n                        aria-labelledby={semanticRankerId}\n                        onRenderLabel={props => renderLabel(props, semanticRankerId, semanticRankerFieldId, t(\"helpTexts.useSemanticReranker\"))}\n                    />\n\n                    <Checkbox\n                        id={semanticCaptionsFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useSemanticCaptions}\n                        label={t(\"labels.useSemanticCaptions\")}\n                        onChange={(_ev, checked) => onChange(\"useSemanticCaptions\", !!checked)}\n                        disabled={!useSemanticRanker}\n                        aria-labelledby={semanticCaptionsId}\n                        onRenderLabel={props => renderLabel(props, semanticCaptionsId, semanticCaptionsFieldId, t(\"helpTexts.useSemanticCaptions\"))}\n                    />\n                </>\n            )}\n            {showQueryRewritingOption && !useAgenticKnowledgeBase && (\n                <>\n                    <Checkbox\n                        id={queryRewritingFieldId}\n                        className={styles.settingsSeparator}\n                        checked={useQueryRewriting}\n                        disabled={!useSemanticRanker}\n                        label={t(\"labels.useQueryRewriting\")}\n                        onChange={(_ev, checked) => onChange(\"useQueryRewriting\", !!checked)}\n                        aria-labelledby={queryRewritingFieldId}\n                        onRenderLabel={props => renderLabel(props, queryRewritingFieldId, queryRewritingFieldId, t(\"helpTexts.useQueryRewriting\"))}\n                    />\n                </>\n            )}\n            {showReasoningEffortOption && (\n                <Dropdown\n                    id={reasoningEffortFieldId}\n                    selectedKey={reasoningEffort}\n                    label={t(\"labels.reasoningEffort\")}\n                    onChange={(_ev?: React.FormEvent<HTMLElement | HTMLInputElement>, option?: IDropdownOption) =>\n                        onChange(\"reasoningEffort\", option?.key || \"\")\n                    }\n                    aria-labelledby={reasoningEffortFieldId}\n                    options={[\n                        { key: \"minimal\", text: t(\"labels.reasoningEffortOptions.minimal\") },\n                        { key: \"low\", text: t(\"labels.reasoningEffortOptions.low\") },\n                        { key: \"medium\", text: t(\"labels.reasoningEffortOptions.medium\") },\n                        { key: \"high\", text: t(\"labels.reasoningEffortOptions.high\") }\n                    ]}\n                    onRenderLabel={props => renderLabel(props, queryRewritingFieldId, queryRewritingFieldId, t(\"helpTexts.reasoningEffort\"))}\n                />\n            )}\n            {showVectorOption && !useAgenticKnowledgeBase && (\n                <>\n                    <VectorSettings\n                        defaultRetrievalMode={retrievalMode}\n                        defaultSearchTextEmbeddings={searchTextEmbeddings}\n                        defaultSearchImageEmbeddings={searchImageEmbeddings}\n                        showImageOptions={showMultimodalOptions}\n                        updateRetrievalMode={val => onChange(\"retrievalMode\", val)}\n                        updateSearchTextEmbeddings={val => onChange(\"searchTextEmbeddings\", val)}\n                        updateSearchImageEmbeddings={val => onChange(\"searchImageEmbeddings\", val)}\n                    />\n                </>\n            )}\n\n            {!useWebSource && (\n                <>\n                    <h3 className={styles.sectionHeader}>{t(\"llmSettings\")}</h3>\n                    <TextField\n                        id={promptTemplateFieldId}\n                        className={styles.settingsSeparator}\n                        defaultValue={promptTemplate}\n                        label={t(\"labels.promptTemplate\")}\n                        multiline\n                        autoAdjustHeight\n                        onChange={(_ev, val) => onChange(\"promptTemplate\", val || \"\")}\n                        aria-labelledby={promptTemplateId}\n                        onRenderLabel={props => renderLabel(props, promptTemplateId, promptTemplateFieldId, t(\"helpTexts.promptTemplate\"))}\n                    />\n                    <TextField\n                        id={temperatureFieldId}\n                        className={styles.settingsSeparator}\n                        label={t(\"labels.temperature\")}\n                        type=\"number\"\n                        min={0}\n                        max={1}\n                        step={0.1}\n                        defaultValue={temperature.toString()}\n                        onChange={(_ev, val) => onChange(\"temperature\", parseFloat(val || \"0\"))}\n                        aria-labelledby={temperatureId}\n                        onRenderLabel={props => renderLabel(props, temperatureId, temperatureFieldId, t(\"helpTexts.temperature\"))}\n                    />\n                    <TextField\n                        id={seedFieldId}\n                        className={styles.settingsSeparator}\n                        label={t(\"labels.seed\")}\n                        type=\"text\"\n                        defaultValue={seed?.toString() || \"\"}\n                        onChange={(_ev, val) => onChange(\"seed\", val ? parseInt(val) : null)}\n                        aria-labelledby={seedId}\n                        onRenderLabel={props => renderLabel(props, seedId, seedFieldId, t(\"helpTexts.seed\"))}\n                    />\n\n                    {showMultimodalOptions && !useAgenticKnowledgeBase && (\n                        <fieldset className={styles.fieldset + \" \" + styles.settingsSeparator}>\n                            <legend className={styles.legend}>{t(\"labels.llmInputs\")}</legend>\n                            <Stack tokens={{ childrenGap: 8 }}>\n                                <Checkbox\n                                    id=\"sendTextSources\"\n                                    label={t(\"labels.llmInputsOptions.texts\")}\n                                    checked={sendTextSources}\n                                    onChange={(_ev, checked) => {\n                                        onChange(\"sendTextSources\", !!checked);\n                                    }}\n                                    onRenderLabel={props => renderLabel(props, \"sendTextSourcesLabel\", \"sendTextSources\", t(\"helpTexts.llmTextInputs\"))}\n                                />\n                                <Checkbox\n                                    id=\"sendImageSources\"\n                                    label={t(\"labels.llmInputsOptions.images\")}\n                                    checked={sendImageSources}\n                                    onChange={(_ev, checked) => {\n                                        onChange(\"sendImageSources\", !!checked);\n                                    }}\n                                    onRenderLabel={props => renderLabel(props, \"sendImageSourcesLabel\", \"sendImageSources\", t(\"helpTexts.llmImageInputs\"))}\n                                />\n                            </Stack>\n                        </fieldset>\n                    )}\n                </>\n            )}\n        </div>\n    );\n};\n","import { useRef, useState, useEffect, useContext } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport { Helmet } from \"react-helmet-async\";\nimport { Panel, DefaultButton } from \"@fluentui/react\";\nimport readNDJSONStream from \"ndjson-readablestream\";\n\nimport appLogo from \"../../assets/applogo.svg\";\nimport styles from \"./Chat.module.css\";\n\nimport { chatApi, configApi, RetrievalMode, ChatAppResponse, ChatAppResponseOrError, ChatAppRequest, ResponseMessage, SpeechConfig } from \"../../api\";\nimport { Answer, AnswerError, AnswerLoading } from \"../../components/Answer\";\nimport { QuestionInput } from \"../../components/QuestionInput\";\nimport { ExampleList } from \"../../components/Example\";\nimport { UserChatMessage } from \"../../components/UserChatMessage\";\nimport { AnalysisPanel, AnalysisPanelTabs } from \"../../components/AnalysisPanel\";\nimport { HistoryPanel } from \"../../components/HistoryPanel\";\nimport { HistoryProviderOptions, useHistoryManager } from \"../../components/HistoryProviders\";\nimport { HistoryButton } from \"../../components/HistoryButton\";\nimport { SettingsButton } from \"../../components/SettingsButton\";\nimport { ClearChatButton } from \"../../components/ClearChatButton\";\nimport { UploadFile } from \"../../components/UploadFile\";\nimport { useLogin, getToken, requireAccessControl } from \"../../authConfig\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { TokenClaimsDisplay } from \"../../components/TokenClaimsDisplay\";\nimport { LoginContext } from \"../../loginContext\";\nimport { LanguagePicker } from \"../../i18n/LanguagePicker\";\nimport { Settings } from \"../../components/Settings/Settings\";\n\nconst Chat = () => {\n    const [isConfigPanelOpen, setIsConfigPanelOpen] = useState(false);\n    const [isHistoryPanelOpen, setIsHistoryPanelOpen] = useState(false);\n    const [promptTemplate, setPromptTemplate] = useState<string>(\"\");\n    const [temperature, setTemperature] = useState<number>(0.3);\n    const [seed, setSeed] = useState<number | null>(null);\n    const [minimumRerankerScore, setMinimumRerankerScore] = useState<number>(1.9);\n    const [minimumSearchScore, setMinimumSearchScore] = useState<number>(0);\n    const [retrieveCount, setRetrieveCount] = useState<number>(3);\n    const [agenticReasoningEffort, setRetrievalReasoningEffort] = useState<string>(\"minimal\");\n    const [retrievalMode, setRetrievalMode] = useState<RetrievalMode>(RetrievalMode.Hybrid);\n    const [useSemanticRanker, setUseSemanticRanker] = useState<boolean>(true);\n    const [useQueryRewriting, setUseQueryRewriting] = useState<boolean>(false);\n    const [reasoningEffort, setReasoningEffort] = useState<string>(\"\");\n    const [streamingEnabled, setStreamingEnabled] = useState<boolean>(true);\n    const [shouldStream, setShouldStream] = useState<boolean>(true);\n    const previousShouldStreamRef = useRef<boolean>(true);\n    const forcedStreamingRef = useRef<boolean>(false);\n    const [useSemanticCaptions, setUseSemanticCaptions] = useState<boolean>(false);\n    const [includeCategory, setIncludeCategory] = useState<string>(\"\");\n    const [excludeCategory, setExcludeCategory] = useState<string>(\"\");\n    const [useSuggestFollowupQuestions, setUseSuggestFollowupQuestions] = useState<boolean>(false);\n    const [searchTextEmbeddings, setSearchTextEmbeddings] = useState<boolean>(true);\n    const [searchImageEmbeddings, setSearchImageEmbeddings] = useState<boolean>(false);\n    const [sendTextSources, setSendTextSources] = useState<boolean>(true);\n    const [sendImageSources, setSendImageSources] = useState<boolean>(false);\n\n    const lastQuestionRef = useRef<string>(\"\");\n    const chatMessageStreamEnd = useRef<HTMLDivElement | null>(null);\n\n    const [isLoading, setIsLoading] = useState<boolean>(false);\n    const [isStreaming, setIsStreaming] = useState<boolean>(false);\n    const [error, setError] = useState<unknown>();\n\n    const [activeCitation, setActiveCitation] = useState<string>();\n    const [activeAnalysisPanelTab, setActiveAnalysisPanelTab] = useState<AnalysisPanelTabs | undefined>(undefined);\n\n    const [selectedAnswer, setSelectedAnswer] = useState<number>(0);\n    const [answers, setAnswers] = useState<[user: string, response: ChatAppResponse][]>([]);\n    const [streamedAnswers, setStreamedAnswers] = useState<[user: string, response: ChatAppResponse][]>([]);\n    const [speechUrls, setSpeechUrls] = useState<(string | null)[]>([]);\n\n    const [showMultimodalOptions, setShowMultimodalOptions] = useState<boolean>(false);\n    const [showSemanticRankerOption, setShowSemanticRankerOption] = useState<boolean>(false);\n    const [showQueryRewritingOption, setShowQueryRewritingOption] = useState<boolean>(false);\n    const [showReasoningEffortOption, setShowReasoningEffortOption] = useState<boolean>(false);\n    const [showVectorOption, setShowVectorOption] = useState<boolean>(false);\n    const [showUserUpload, setShowUserUpload] = useState<boolean>(false);\n    const [showLanguagePicker, setshowLanguagePicker] = useState<boolean>(false);\n    const [showSpeechInput, setShowSpeechInput] = useState<boolean>(false);\n    const [showSpeechOutputBrowser, setShowSpeechOutputBrowser] = useState<boolean>(false);\n    const [showSpeechOutputAzure, setShowSpeechOutputAzure] = useState<boolean>(false);\n    const [showChatHistoryBrowser, setShowChatHistoryBrowser] = useState<boolean>(false);\n    const [showChatHistoryCosmos, setShowChatHistoryCosmos] = useState<boolean>(false);\n    const [showAgenticRetrievalOption, setShowAgenticRetrievalOption] = useState<boolean>(false);\n    const [webSourceSupported, setWebSourceSupported] = useState<boolean>(false);\n    const [webSourceEnabled, setWebSourceEnabled] = useState<boolean>(false);\n    const [sharePointSourceSupported, setSharePointSourceSupported] = useState<boolean>(false);\n    const [sharePointSourceEnabled, setSharePointSourceEnabled] = useState<boolean>(false);\n    const [useAgenticKnowledgeBase, setUseAgenticRetrieval] = useState<boolean>(false);\n    const [hideMinimalRetrievalReasoningOption, setHideMinimalRetrievalReasoningOption] = useState<boolean>(false);\n    const streamingDisabledByOverrides = useAgenticKnowledgeBase && webSourceEnabled;\n\n    const audio = useRef(new Audio()).current;\n    const [isPlaying, setIsPlaying] = useState(false);\n\n    const speechConfig: SpeechConfig = {\n        speechUrls,\n        setSpeechUrls,\n        audio,\n        isPlaying,\n        setIsPlaying\n    };\n\n    const getConfig = async () => {\n        configApi().then(config => {\n            setShowMultimodalOptions(config.showMultimodalOptions);\n            if (config.showMultimodalOptions) {\n                // Initialize from server config so defaults match deployment settings\n                setSendTextSources(config.ragSendTextSources !== undefined ? config.ragSendTextSources : true);\n                setSendImageSources(config.ragSendImageSources);\n                setSearchTextEmbeddings(config.ragSearchTextEmbeddings);\n                setSearchImageEmbeddings(config.ragSearchImageEmbeddings);\n            }\n            setUseSemanticRanker(config.showSemanticRankerOption);\n            setShowSemanticRankerOption(config.showSemanticRankerOption);\n            setUseQueryRewriting(config.showQueryRewritingOption);\n            setShowQueryRewritingOption(config.showQueryRewritingOption);\n            setShowReasoningEffortOption(config.showReasoningEffortOption);\n            setStreamingEnabled(config.streamingEnabled);\n            if (config.showReasoningEffortOption) {\n                setReasoningEffort(config.defaultReasoningEffort);\n            }\n            setShowVectorOption(config.showVectorOption);\n            if (!config.showVectorOption) {\n                setRetrievalMode(RetrievalMode.Text);\n            }\n            setShowUserUpload(config.showUserUpload);\n            setshowLanguagePicker(config.showLanguagePicker);\n            setShowSpeechInput(config.showSpeechInput);\n            setShowSpeechOutputBrowser(config.showSpeechOutputBrowser);\n            setShowSpeechOutputAzure(config.showSpeechOutputAzure);\n            setShowChatHistoryBrowser(config.showChatHistoryBrowser);\n            setShowChatHistoryCosmos(config.showChatHistoryCosmos);\n            setShowAgenticRetrievalOption(config.showAgenticRetrievalOption);\n            setUseAgenticRetrieval(config.showAgenticRetrievalOption);\n            setWebSourceSupported(config.webSourceEnabled);\n            setWebSourceEnabled(config.webSourceEnabled);\n            setSharePointSourceSupported(config.sharepointSourceEnabled);\n            setSharePointSourceEnabled(config.sharepointSourceEnabled);\n            if (config.showAgenticRetrievalOption) {\n                setRetrieveCount(10);\n            }\n            const defaultRetrievalEffort = config.defaultRetrievalReasoningEffort ?? \"minimal\";\n            setHideMinimalRetrievalReasoningOption(config.webSourceEnabled);\n            setRetrievalReasoningEffort(defaultRetrievalEffort);\n        });\n    };\n\n    const handleAsyncRequest = async (question: string, answers: [string, ChatAppResponse][], responseBody: ReadableStream<any>) => {\n        let answer: string = \"\";\n        let askResponse: ChatAppResponse = {} as ChatAppResponse;\n\n        const updateState = (newContent: string) => {\n            return new Promise(resolve => {\n                setTimeout(() => {\n                    answer += newContent;\n                    const latestResponse: ChatAppResponse = {\n                        ...askResponse,\n                        message: { content: answer, role: askResponse.message.role }\n                    };\n                    setStreamedAnswers([...answers, [question, latestResponse]]);\n                    resolve(null);\n                }, 33);\n            });\n        };\n        try {\n            setIsStreaming(true);\n            for await (const event of readNDJSONStream(responseBody)) {\n                if (event[\"context\"] && event[\"context\"][\"data_points\"]) {\n                    event[\"message\"] = event[\"delta\"];\n                    askResponse = event as ChatAppResponse;\n                } else if (event[\"delta\"] && event[\"delta\"][\"content\"]) {\n                    setIsLoading(false);\n                    await updateState(event[\"delta\"][\"content\"]);\n                } else if (event[\"context\"]) {\n                    // Update context with new keys from latest event\n                    askResponse.context = { ...askResponse.context, ...event[\"context\"] };\n                } else if (event[\"error\"]) {\n                    throw Error(event[\"error\"]);\n                }\n            }\n        } finally {\n            setIsStreaming(false);\n        }\n        const fullResponse: ChatAppResponse = {\n            ...askResponse,\n            message: { content: answer, role: askResponse.message.role }\n        };\n        return fullResponse;\n    };\n\n    const client = useLogin ? useMsal().instance : undefined;\n    const { loggedIn } = useContext(LoginContext);\n\n    const historyProvider: HistoryProviderOptions = (() => {\n        if (useLogin && showChatHistoryCosmos) return HistoryProviderOptions.CosmosDB;\n        if (showChatHistoryBrowser) return HistoryProviderOptions.IndexedDB;\n        return HistoryProviderOptions.None;\n    })();\n    const historyManager = useHistoryManager(historyProvider);\n\n    const updateStreamingPreference = (isStreamingEnabledOverride: boolean, disablesStreamingOverride: boolean) => {\n        if (!isStreamingEnabledOverride) {\n            setShouldStream(current => {\n                if (!forcedStreamingRef.current) {\n                    previousShouldStreamRef.current = current;\n                }\n                forcedStreamingRef.current = true;\n                return current ? false : current;\n            });\n            return;\n        }\n\n        if (disablesStreamingOverride) {\n            setShouldStream(current => {\n                if (!forcedStreamingRef.current) {\n                    previousShouldStreamRef.current = current;\n                }\n                forcedStreamingRef.current = true;\n                return current ? false : current;\n            });\n            return;\n        }\n\n        forcedStreamingRef.current = false;\n        setShouldStream(current => {\n            const desiredShouldStream = previousShouldStreamRef.current;\n            return current === desiredShouldStream ? current : desiredShouldStream;\n        });\n    };\n\n    const makeApiRequest = async (question: string) => {\n        lastQuestionRef.current = question;\n\n        error && setError(undefined);\n        setIsLoading(true);\n        setActiveCitation(undefined);\n        setActiveAnalysisPanelTab(undefined);\n\n        const token = client ? await getToken(client) : undefined;\n\n        try {\n            const messages: ResponseMessage[] = answers.flatMap(a => [\n                { content: a[0], role: \"user\" },\n                { content: a[1].message.content, role: \"assistant\" }\n            ]);\n\n            const request: ChatAppRequest = {\n                messages: [...messages, { content: question, role: \"user\" }],\n                context: {\n                    overrides: {\n                        prompt_template: promptTemplate.length === 0 ? undefined : promptTemplate,\n                        include_category: includeCategory.length === 0 ? undefined : includeCategory,\n                        exclude_category: excludeCategory.length === 0 ? undefined : excludeCategory,\n                        top: retrieveCount,\n                        ...(useAgenticKnowledgeBase ? { retrieval_reasoning_effort: agenticReasoningEffort } : {}),\n                        temperature: temperature,\n                        minimum_reranker_score: minimumRerankerScore,\n                        minimum_search_score: minimumSearchScore,\n                        retrieval_mode: retrievalMode,\n                        semantic_ranker: useSemanticRanker,\n                        semantic_captions: useSemanticCaptions,\n                        query_rewriting: useQueryRewriting,\n                        reasoning_effort: reasoningEffort,\n                        suggest_followup_questions: useSuggestFollowupQuestions,\n                        search_text_embeddings: searchTextEmbeddings,\n                        search_image_embeddings: searchImageEmbeddings,\n                        send_text_sources: sendTextSources,\n                        send_image_sources: sendImageSources,\n                        language: i18n.language,\n                        use_agentic_knowledgebase: useAgenticKnowledgeBase,\n                        use_web_source: webSourceSupported ? webSourceEnabled : false,\n                        use_sharepoint_source: sharePointSourceSupported ? sharePointSourceEnabled : false,\n                        ...(seed !== null ? { seed: seed } : {})\n                    }\n                },\n                // AI Chat Protocol: Client must pass on any session state received from the server\n                session_state: answers.length ? answers[answers.length - 1][1].session_state : null\n            };\n\n            const response = await chatApi(request, shouldStream, token);\n            if (!response.body) {\n                throw Error(\"No response body\");\n            }\n            if (response.status > 299 || !response.ok) {\n                throw Error(`Request failed with status ${response.status}`);\n            }\n            if (shouldStream) {\n                const parsedResponse: ChatAppResponse = await handleAsyncRequest(question, answers, response.body);\n                setAnswers([...answers, [question, parsedResponse]]);\n                if (typeof parsedResponse.session_state === \"string\" && parsedResponse.session_state !== \"\") {\n                    const token = client ? await getToken(client) : undefined;\n                    historyManager.addItem(parsedResponse.session_state, [...answers, [question, parsedResponse]], token);\n                }\n            } else {\n                const parsedResponse: ChatAppResponseOrError = await response.json();\n                if (parsedResponse.error) {\n                    throw Error(parsedResponse.error);\n                }\n                setAnswers([...answers, [question, parsedResponse as ChatAppResponse]]);\n                if (typeof parsedResponse.session_state === \"string\" && parsedResponse.session_state !== \"\") {\n                    const token = client ? await getToken(client) : undefined;\n                    historyManager.addItem(parsedResponse.session_state, [...answers, [question, parsedResponse as ChatAppResponse]], token);\n                }\n            }\n            setSpeechUrls([...speechUrls, null]);\n        } catch (e) {\n            setError(e);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const clearChat = () => {\n        lastQuestionRef.current = \"\";\n        error && setError(undefined);\n        setActiveCitation(undefined);\n        setActiveAnalysisPanelTab(undefined);\n        setAnswers([]);\n        setSpeechUrls([]);\n        setStreamedAnswers([]);\n        setIsLoading(false);\n        setIsStreaming(false);\n    };\n\n    useEffect(() => chatMessageStreamEnd.current?.scrollIntoView({ behavior: \"smooth\" }), [isLoading]);\n    useEffect(() => chatMessageStreamEnd.current?.scrollIntoView({ behavior: \"auto\" }), [streamedAnswers]);\n    useEffect(() => {\n        getConfig();\n    }, []);\n\n    // Preserve streaming preference when agentic retrieval forces streaming off.\n    useEffect(() => {\n        updateStreamingPreference(streamingEnabled, streamingDisabledByOverrides);\n    }, [streamingDisabledByOverrides, streamingEnabled]);\n\n    const handleSettingsChange = (field: string, value: any) => {\n        switch (field) {\n            case \"promptTemplate\":\n                setPromptTemplate(value);\n                break;\n            case \"temperature\":\n                setTemperature(value);\n                break;\n            case \"seed\":\n                setSeed(value);\n                break;\n            case \"minimumRerankerScore\":\n                setMinimumRerankerScore(value);\n                break;\n            case \"minimumSearchScore\":\n                setMinimumSearchScore(value);\n                break;\n            case \"retrieveCount\":\n                setRetrieveCount(value);\n                break;\n            case \"agenticReasoningEffort\": {\n                setRetrievalReasoningEffort(value);\n                // If selecting minimal while web source is enabled, disable web source\n                if (value === \"minimal\" && webSourceEnabled) {\n                    setWebSourceEnabled(false);\n                    setHideMinimalRetrievalReasoningOption(false);\n                    // Web source was disabled, so restore streaming\n                    updateStreamingPreference(streamingEnabled, false);\n                }\n                break;\n            }\n            case \"useSemanticRanker\":\n                setUseSemanticRanker(value);\n                break;\n            case \"useQueryRewriting\":\n                setUseQueryRewriting(value);\n                break;\n            case \"reasoningEffort\":\n                setReasoningEffort(value);\n                break;\n            case \"useSemanticCaptions\":\n                setUseSemanticCaptions(value);\n                break;\n            case \"excludeCategory\":\n                setExcludeCategory(value);\n                break;\n            case \"includeCategory\":\n                setIncludeCategory(value);\n                break;\n            case \"shouldStream\":\n                {\n                    const normalizedShouldStream = !!value;\n                    forcedStreamingRef.current = false;\n                    previousShouldStreamRef.current = normalizedShouldStream;\n                    setShouldStream(normalizedShouldStream);\n                }\n                break;\n            case \"useSuggestFollowupQuestions\":\n                setUseSuggestFollowupQuestions(value);\n                break;\n            case \"llmInputs\":\n                break;\n            case \"sendTextSources\":\n                setSendTextSources(value);\n                break;\n            case \"sendImageSources\":\n                setSendImageSources(value);\n                break;\n            case \"searchTextEmbeddings\":\n                setSearchTextEmbeddings(value);\n                break;\n            case \"searchImageEmbeddings\":\n                setSearchImageEmbeddings(value);\n                break;\n            case \"retrievalMode\":\n                setRetrievalMode(value);\n                break;\n            case \"useAgenticKnowledgeBase\": {\n                setUseAgenticRetrieval(value);\n                let effectiveWebSource = webSourceEnabled;\n                if (!value && webSourceEnabled) {\n                    effectiveWebSource = false;\n                    setWebSourceEnabled(false);\n                    setHideMinimalRetrievalReasoningOption(false);\n                }\n                // Only web source disables streaming\n                const shouldDisableStreaming = !!value && effectiveWebSource;\n                updateStreamingPreference(streamingEnabled, shouldDisableStreaming);\n                break;\n            }\n            case \"useWebSource\":\n                if (!webSourceSupported) {\n                    setWebSourceEnabled(false);\n                    return;\n                }\n                const normalizedWebSource = !!value;\n                setWebSourceEnabled(normalizedWebSource);\n                setHideMinimalRetrievalReasoningOption(normalizedWebSource);\n                // When enabling web source, disable follow-up questions and streaming\n                if (normalizedWebSource) {\n                    setUseSuggestFollowupQuestions(false);\n                }\n                const shouldDisableStreaming = useAgenticKnowledgeBase && normalizedWebSource;\n                updateStreamingPreference(streamingEnabled, shouldDisableStreaming);\n                break;\n            case \"useSharePointSource\":\n                if (!sharePointSourceSupported) {\n                    setSharePointSourceEnabled(false);\n                    return;\n                }\n                setSharePointSourceEnabled(!!value);\n                break;\n        }\n    };\n\n    const onExampleClicked = (example: string) => {\n        makeApiRequest(example);\n    };\n\n    const onShowCitation = (citation: string, index: number) => {\n        if (activeCitation === citation && activeAnalysisPanelTab === AnalysisPanelTabs.CitationTab && selectedAnswer === index) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveCitation(citation);\n            setActiveAnalysisPanelTab(AnalysisPanelTabs.CitationTab);\n        }\n\n        setSelectedAnswer(index);\n    };\n\n    const onToggleTab = (tab: AnalysisPanelTabs, index: number) => {\n        if (activeAnalysisPanelTab === tab && selectedAnswer === index) {\n            setActiveAnalysisPanelTab(undefined);\n        } else {\n            setActiveAnalysisPanelTab(tab);\n        }\n\n        setSelectedAnswer(index);\n    };\n\n    const { t, i18n } = useTranslation();\n\n    return (\n        <div className={styles.container}>\n            {/* Setting the page title using react-helmet-async */}\n            <Helmet>\n                <title>{t(\"pageTitle\")}</title>\n            </Helmet>\n            <div className={styles.commandsSplitContainer}>\n                <div className={styles.commandsContainer}>\n                    {((useLogin && showChatHistoryCosmos) || showChatHistoryBrowser) && (\n                        <HistoryButton className={styles.commandButton} onClick={() => setIsHistoryPanelOpen(!isHistoryPanelOpen)} />\n                    )}\n                </div>\n                <div className={styles.commandsContainer}>\n                    <ClearChatButton className={styles.commandButton} onClick={clearChat} disabled={!lastQuestionRef.current || isLoading} />\n                    {showUserUpload && <UploadFile className={styles.commandButton} disabled={!loggedIn} />}\n                    <SettingsButton className={styles.commandButton} onClick={() => setIsConfigPanelOpen(!isConfigPanelOpen)} />\n                </div>\n            </div>\n            <div className={styles.chatRoot} style={{ marginLeft: isHistoryPanelOpen ? \"300px\" : \"0\" }}>\n                <div className={styles.chatContainer}>\n                    {!lastQuestionRef.current ? (\n                        <div className={styles.chatEmptyState}>\n                            <img src={appLogo} alt=\"App logo\" width=\"120\" height=\"120\" />\n\n                            <h1 className={styles.chatEmptyStateTitle}>{t(\"chatEmptyStateTitle\")}</h1>\n                            <h2 className={styles.chatEmptyStateSubtitle}>{t(\"chatEmptyStateSubtitle\")}</h2>\n                            {showLanguagePicker && <LanguagePicker onLanguageChange={newLang => i18n.changeLanguage(newLang)} />}\n\n                            <ExampleList onExampleClicked={onExampleClicked} useMultimodalAnswering={showMultimodalOptions} />\n                        </div>\n                    ) : (\n                        <div className={styles.chatMessageStream}>\n                            {isStreaming &&\n                                streamedAnswers.map((streamedAnswer, index) => (\n                                    <div key={index}>\n                                        <UserChatMessage message={streamedAnswer[0]} />\n                                        <div className={styles.chatMessageGpt}>\n                                            <Answer\n                                                isStreaming={true}\n                                                key={index}\n                                                answer={streamedAnswer[1]}\n                                                index={index}\n                                                speechConfig={speechConfig}\n                                                isSelected={false}\n                                                onCitationClicked={c => onShowCitation(c, index)}\n                                                onThoughtProcessClicked={() => onToggleTab(AnalysisPanelTabs.ThoughtProcessTab, index)}\n                                                onSupportingContentClicked={() => onToggleTab(AnalysisPanelTabs.SupportingContentTab, index)}\n                                                onFollowupQuestionClicked={q => makeApiRequest(q)}\n                                                showFollowupQuestions={useSuggestFollowupQuestions && answers.length - 1 === index}\n                                                showSpeechOutputAzure={showSpeechOutputAzure}\n                                                showSpeechOutputBrowser={showSpeechOutputBrowser}\n                                            />\n                                        </div>\n                                    </div>\n                                ))}\n                            {!isStreaming &&\n                                answers.map((answer, index) => (\n                                    <div key={index}>\n                                        <UserChatMessage message={answer[0]} />\n                                        <div className={styles.chatMessageGpt}>\n                                            <Answer\n                                                isStreaming={false}\n                                                key={index}\n                                                answer={answer[1]}\n                                                index={index}\n                                                speechConfig={speechConfig}\n                                                isSelected={selectedAnswer === index && activeAnalysisPanelTab !== undefined}\n                                                onCitationClicked={c => onShowCitation(c, index)}\n                                                onThoughtProcessClicked={() => onToggleTab(AnalysisPanelTabs.ThoughtProcessTab, index)}\n                                                onSupportingContentClicked={() => onToggleTab(AnalysisPanelTabs.SupportingContentTab, index)}\n                                                onFollowupQuestionClicked={q => makeApiRequest(q)}\n                                                showFollowupQuestions={useSuggestFollowupQuestions && answers.length - 1 === index}\n                                                showSpeechOutputAzure={showSpeechOutputAzure}\n                                                showSpeechOutputBrowser={showSpeechOutputBrowser}\n                                            />\n                                        </div>\n                                    </div>\n                                ))}\n                            {isLoading && (\n                                <>\n                                    <UserChatMessage message={lastQuestionRef.current} />\n                                    <div className={styles.chatMessageGptMinWidth}>\n                                        <AnswerLoading />\n                                    </div>\n                                </>\n                            )}\n                            {error ? (\n                                <>\n                                    <UserChatMessage message={lastQuestionRef.current} />\n                                    <div className={styles.chatMessageGptMinWidth}>\n                                        <AnswerError error={error.toString()} onRetry={() => makeApiRequest(lastQuestionRef.current)} />\n                                    </div>\n                                </>\n                            ) : null}\n                            <div ref={chatMessageStreamEnd} />\n                        </div>\n                    )}\n\n                    <div className={styles.chatInput}>\n                        <QuestionInput\n                            clearOnSend\n                            placeholder={t(\"defaultExamples.placeholder\")}\n                            disabled={isLoading}\n                            onSend={question => makeApiRequest(question)}\n                            showSpeechInput={showSpeechInput}\n                        />\n                    </div>\n                </div>\n\n                {answers.length > 0 && activeAnalysisPanelTab && (\n                    <AnalysisPanel\n                        className={styles.chatAnalysisPanel}\n                        activeCitation={activeCitation}\n                        onActiveTabChanged={x => onToggleTab(x, selectedAnswer)}\n                        citationHeight=\"810px\"\n                        answer={answers[selectedAnswer][1]}\n                        activeTab={activeAnalysisPanelTab}\n                        onCitationClicked={c => onShowCitation(c, selectedAnswer)}\n                    />\n                )}\n\n                {((useLogin && showChatHistoryCosmos) || showChatHistoryBrowser) && (\n                    <HistoryPanel\n                        provider={historyProvider}\n                        isOpen={isHistoryPanelOpen}\n                        notify={!isStreaming && !isLoading}\n                        onClose={() => setIsHistoryPanelOpen(false)}\n                        onChatSelected={answers => {\n                            if (answers.length === 0) return;\n                            setAnswers(answers);\n                            lastQuestionRef.current = answers[answers.length - 1][0];\n                        }}\n                    />\n                )}\n\n                <Panel\n                    headerText={t(\"labels.headerText\")}\n                    isOpen={isConfigPanelOpen}\n                    isBlocking={false}\n                    onDismiss={() => setIsConfigPanelOpen(false)}\n                    closeButtonAriaLabel={t(\"labels.closeButton\")}\n                    onRenderFooterContent={() => <DefaultButton onClick={() => setIsConfigPanelOpen(false)}>{t(\"labels.closeButton\")}</DefaultButton>}\n                    isFooterAtBottom={true}\n                >\n                    <Settings\n                        promptTemplate={promptTemplate}\n                        temperature={temperature}\n                        retrieveCount={retrieveCount}\n                        agenticReasoningEffort={agenticReasoningEffort}\n                        seed={seed}\n                        minimumSearchScore={minimumSearchScore}\n                        minimumRerankerScore={minimumRerankerScore}\n                        useSemanticRanker={useSemanticRanker}\n                        useSemanticCaptions={useSemanticCaptions}\n                        useQueryRewriting={useQueryRewriting}\n                        reasoningEffort={reasoningEffort}\n                        excludeCategory={excludeCategory}\n                        includeCategory={includeCategory}\n                        retrievalMode={retrievalMode}\n                        showMultimodalOptions={showMultimodalOptions}\n                        sendTextSources={sendTextSources}\n                        sendImageSources={sendImageSources}\n                        searchTextEmbeddings={searchTextEmbeddings}\n                        searchImageEmbeddings={searchImageEmbeddings}\n                        showSemanticRankerOption={showSemanticRankerOption}\n                        showQueryRewritingOption={showQueryRewritingOption}\n                        showReasoningEffortOption={showReasoningEffortOption}\n                        showVectorOption={showVectorOption}\n                        useLogin={!!useLogin}\n                        loggedIn={loggedIn}\n                        requireAccessControl={requireAccessControl}\n                        shouldStream={shouldStream}\n                        streamingEnabled={streamingEnabled}\n                        useSuggestFollowupQuestions={useSuggestFollowupQuestions}\n                        showAgenticRetrievalOption={showAgenticRetrievalOption}\n                        useAgenticKnowledgeBase={useAgenticKnowledgeBase}\n                        useWebSource={webSourceEnabled}\n                        showWebSourceOption={webSourceSupported}\n                        useSharePointSource={sharePointSourceEnabled}\n                        showSharePointSourceOption={sharePointSourceSupported}\n                        hideMinimalRetrievalReasoningOption={hideMinimalRetrievalReasoningOption}\n                        onChange={handleSettingsChange}\n                    />\n                    {useLogin && <TokenClaimsDisplay />}\n                </Panel>\n            </div>\n        </div>\n    );\n};\n\nexport default Chat;\n","import { DefaultButton } from \"@fluentui/react\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { useTranslation } from \"react-i18next\";\n\nimport styles from \"./LoginButton.module.css\";\nimport { getRedirectUri, loginRequest, appServicesLogout, getUsername, checkLoggedIn } from \"../../authConfig\";\nimport { useState, useEffect, useContext } from \"react\";\nimport { LoginContext } from \"../../loginContext\";\n\nexport const LoginButton = () => {\n    const { instance } = useMsal();\n    const { loggedIn, setLoggedIn } = useContext(LoginContext);\n    const activeAccount = instance.getActiveAccount();\n    const [username, setUsername] = useState(\"\");\n    const { t } = useTranslation();\n\n    useEffect(() => {\n        const fetchUsername = async () => {\n            setUsername((await getUsername(instance)) ?? \"\");\n        };\n\n        fetchUsername();\n    }, []);\n\n    const handleLoginPopup = () => {\n        /**\n         * When using popup and silent APIs, we recommend setting the redirectUri to a blank page or a page\n         * that does not implement MSAL. Keep in mind that all redirect routes must be registered with the application\n         * For more information, please follow this link: https://github.com/AzureAD/microsoft-authentication-library-for-js/blob/dev/lib/msal-browser/docs/login-user.md#redirecturi-considerations\n         */\n        instance\n            .loginPopup({\n                ...loginRequest,\n                redirectUri: getRedirectUri()\n            })\n            .catch(error => console.log(error))\n            .then(async () => {\n                setLoggedIn(await checkLoggedIn(instance));\n                setUsername((await getUsername(instance)) ?? \"\");\n            });\n    };\n    const handleLogoutPopup = () => {\n        if (activeAccount) {\n            instance\n                .logoutPopup({\n                    mainWindowRedirectUri: \"/\", // redirects the top level app after logout\n                    account: instance.getActiveAccount()\n                })\n                .catch(error => console.log(error))\n                .then(async () => {\n                    setLoggedIn(await checkLoggedIn(instance));\n                    setUsername((await getUsername(instance)) ?? \"\");\n                });\n        } else {\n            appServicesLogout();\n        }\n    };\n    return (\n        <DefaultButton\n            text={loggedIn ? `${t(\"logout\")}\\n${username}` : `${t(\"login\")}`}\n            className={styles.loginButton}\n            onClick={loggedIn ? handleLogoutPopup : handleLoginPopup}\n        ></DefaultButton>\n    );\n};\n","import React, { useState, useEffect, useRef, RefObject } from \"react\";\nimport { Outlet, NavLink, Link } from \"react-router-dom\";\nimport { useTranslation } from \"react-i18next\";\nimport styles from \"./Layout.module.css\";\n\nimport { useLogin } from \"../../authConfig\";\n\nimport { LoginButton } from \"../../components/LoginButton\";\nimport { IconButton } from \"@fluentui/react\";\n\nconst Layout = () => {\n    const { t } = useTranslation();\n    const [menuOpen, setMenuOpen] = useState(false);\n    const [isBetaAuth, setIsBetaAuth] = useState(false);\n    const menuRef: RefObject<HTMLDivElement> = useRef(null);\n\n    // Check if beta auth is enabled\n    useEffect(() => {\n        const checkBetaAuth = async () => {\n            try {\n                const response = await fetch(\"/auth/status\");\n                if (response.ok) {\n                    const data = await response.json();\n                    setIsBetaAuth(data.betaAuthEnabled || false);\n                }\n            } catch {\n                // Ignore errors\n            }\n        };\n        checkBetaAuth();\n    }, []);\n\n    const handleLogout = () => {\n        localStorage.removeItem(\"beta_auth_token\");\n        localStorage.removeItem(\"beta_auth_username\");\n        window.location.reload();\n    };\n\n    const toggleMenu = () => {\n        setMenuOpen(!menuOpen);\n    };\n\n    const handleClickOutside = (event: MouseEvent) => {\n        if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\n            setMenuOpen(false);\n        }\n    };\n\n    useEffect(() => {\n        if (menuOpen) {\n            document.addEventListener(\"mousedown\", handleClickOutside);\n        } else {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        }\n        return () => {\n            document.removeEventListener(\"mousedown\", handleClickOutside);\n        };\n    }, [menuOpen]);\n\n    return (\n        <div className={styles.layout}>\n            <header className={styles.header} role={\"banner\"}>\n                <div className={styles.headerContainer} ref={menuRef}>\n                    <Link to=\"/\" className={styles.headerTitleContainer}>\n                        <h3 className={styles.headerTitle}>{t(\"headerTitle\")}</h3>\n                    </Link>\n                    <nav>\n                        <ul className={`${styles.headerNavList} ${menuOpen ? styles.show : \"\"}`}>\n                            <li>\n                                <NavLink\n                                    to=\"/\"\n                                    className={({ isActive }) => (isActive ? styles.headerNavPageLinkActive : styles.headerNavPageLink)}\n                                    onClick={() => setMenuOpen(false)}\n                                >\n                                    {t(\"chat\")}\n                                </NavLink>\n                            </li>\n                            <li>\n                                <NavLink\n                                    to=\"/qa\"\n                                    className={({ isActive }) => (isActive ? styles.headerNavPageLinkActive : styles.headerNavPageLink)}\n                                    onClick={() => setMenuOpen(false)}\n                                >\n                                    {t(\"qa\")}\n                                </NavLink>\n                            </li>\n                        </ul>\n                    </nav>\n                    <div className={styles.loginMenuContainer}>\n                        {useLogin && <LoginButton />}\n                        {isBetaAuth && (\n                            <IconButton\n                                iconProps={{ iconName: \"SignOut\" }}\n                                title={t(\"logout\")}\n                                ariaLabel={t(\"logout\")}\n                                onClick={handleLogout}\n                                styles={{\n                                    root: {\n                                        color: \"white\",\n                                        marginLeft: \"8px\"\n                                    },\n                                    rootHovered: {\n                                        color: \"#e0e0e0\"\n                                    }\n                                }}\n                            />\n                        )}\n                        <IconButton\n                            iconProps={{ iconName: \"GlobalNavButton\" }}\n                            className={styles.menuToggle}\n                            onClick={toggleMenu}\n                            ariaLabel={t(\"labels.toggleMenu\")}\n                        />\n                    </div>\n                </div>\n            </header>\n\n            <main className={styles.main} id=\"main-content\">\n                <Outlet />\n            </main>\n        </div>\n    );\n};\n\nexport default Layout;\n","import { useEffect, useRef, useState } from \"react\";\nimport { useMsal } from \"@azure/msal-react\";\nimport { useLogin, checkLoggedIn } from \"./authConfig\";\nimport { LoginContext } from \"./loginContext\";\nimport Layout from \"./pages/layout/Layout\";\n\nconst LayoutWrapper = () => {\n    const [loggedIn, setLoggedIn] = useState(false);\n    if (useLogin) {\n        const { instance } = useMsal();\n        // Keep track of the mounted state to avoid setting state in an unmounted component\n        const mounted = useRef<boolean>(true);\n        useEffect(() => {\n            mounted.current = true;\n            checkLoggedIn(instance)\n                .then(isLoggedIn => {\n                    if (mounted.current) setLoggedIn(isLoggedIn);\n                })\n                .catch(e => {\n                    console.error(\"checkLoggedIn failed\", e);\n                });\n            return () => {\n                mounted.current = false;\n            };\n        }, [instance]);\n\n        return (\n            <LoginContext.Provider value={{ loggedIn, setLoggedIn }}>\n                <Layout />\n            </LoginContext.Provider>\n        );\n    } else {\n        return (\n            <LoginContext.Provider\n                value={{\n                    loggedIn,\n                    setLoggedIn\n                }}\n            >\n                <Layout />\n            </LoginContext.Provider>\n        );\n    }\n};\n\nexport default LayoutWrapper;\n","import { useState } from \"react\";\nimport { Stack, TextField, PrimaryButton, MessageBar, MessageBarType, Text } from \"@fluentui/react\";\nimport styles from \"./BetaLogin.module.css\";\n\ninterface BetaLoginProps {\n    onLoginSuccess: (token: string, username: string) => void;\n}\n\nexport const BetaLogin = ({ onLoginSuccess }: BetaLoginProps) => {\n    const [username, setUsername] = useState(\"\");\n    const [password, setPassword] = useState(\"\");\n    const [isLoading, setIsLoading] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const handleLogin = async () => {\n        if (!username || !password) {\n            setError(\"Bitte Username und Passwort eingeben\");\n            return;\n        }\n\n        setIsLoading(true);\n        setError(null);\n\n        try {\n            const response = await fetch(\"/auth/login\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify({ username, password })\n            });\n\n            if (!response.ok) {\n                const errorData = await response.json();\n                throw new Error(errorData.error || \"Login fehlgeschlagen\");\n            }\n\n            const data = await response.json();\n            localStorage.setItem(\"beta_auth_token\", data.token);\n            localStorage.setItem(\"beta_auth_username\", data.username);\n            onLoginSuccess(data.token, data.username);\n        } catch (err) {\n            setError(err instanceof Error ? err.message : \"Login fehlgeschlagen\");\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleKeyPress = (e: React.KeyboardEvent) => {\n        if (e.key === \"Enter\") {\n            handleLogin();\n        }\n    };\n\n    return (\n        <div className={styles.container}>\n            <div className={styles.loginBox}>\n                <Stack tokens={{ childrenGap: 20 }}>\n                    <Text variant=\"xxLarge\" className={styles.title}>\n                        Keiko Personal Assistant\n                    </Text>\n                    <Text variant=\"large\" className={styles.subtitle}>\n                        Beta-Zugang\n                    </Text>\n\n                    {error && (\n                        <MessageBar messageBarType={MessageBarType.error} isMultiline={false}>\n                            {error}\n                        </MessageBar>\n                    )}\n\n                    <TextField\n                        label=\"Username\"\n                        value={username}\n                        onChange={(_, newValue) => setUsername(newValue || \"\")}\n                        onKeyPress={handleKeyPress}\n                        disabled={isLoading}\n                        autoComplete=\"username\"\n                    />\n\n                    <TextField\n                        label=\"Passwort\"\n                        type=\"password\"\n                        value={password}\n                        onChange={(_, newValue) => setPassword(newValue || \"\")}\n                        onKeyPress={handleKeyPress}\n                        disabled={isLoading}\n                        autoComplete=\"current-password\"\n                        canRevealPassword\n                    />\n\n                    <PrimaryButton text={isLoading ? \"Anmelden...\" : \"Anmelden\"} onClick={handleLogin} disabled={isLoading} />\n\n                    <Text variant=\"small\" className={styles.info}>\n                        Dies ist eine Beta-Version. Bitte verwenden Sie die Ihnen zugewiesenen Zugangsdaten.\n                    </Text>\n                </Stack>\n            </div>\n        </div>\n    );\n};\n\n","import { useState, useEffect, ReactNode } from \"react\";\nimport { BetaLogin } from \"../BetaLogin\";\n\ninterface BetaAuthWrapperProps {\n    children: ReactNode;\n}\n\nexport const BetaAuthWrapper = ({ children }: BetaAuthWrapperProps) => {\n    const [isAuthenticated, setIsAuthenticated] = useState(false);\n    const [isLoading, setIsLoading] = useState(true);\n    const [betaAuthEnabled, setBetaAuthEnabled] = useState(false);\n\n    useEffect(() => {\n        checkBetaAuth();\n    }, []);\n\n    const checkBetaAuth = async () => {\n        try {\n            // Check if beta auth is enabled using the status endpoint\n            const response = await fetch(\"/auth/status\");\n\n            if (response.ok) {\n                const data = await response.json();\n                if (data.betaAuthEnabled) {\n                    setBetaAuthEnabled(true);\n                    // Check if we have a valid token\n                    const token = localStorage.getItem(\"beta_auth_token\");\n                    if (token) {\n                        // Validate token by making a test request\n                        const testResponse = await fetch(\"/config\", {\n                            headers: { Authorization: `Bearer ${token}` }\n                        });\n                        if (testResponse.ok) {\n                            setIsAuthenticated(true);\n                        } else {\n                            // Token invalid, clear it\n                            localStorage.removeItem(\"beta_auth_token\");\n                            localStorage.removeItem(\"beta_auth_username\");\n                        }\n                    }\n                } else {\n                    // Beta auth not enabled\n                    setBetaAuthEnabled(false);\n                    setIsAuthenticated(true);\n                }\n            } else {\n                // On error, assume beta auth is not enabled\n                setBetaAuthEnabled(false);\n                setIsAuthenticated(true);\n            }\n        } catch (error) {\n            console.error(\"Error checking beta auth:\", error);\n            // On error, assume beta auth is not enabled\n            setBetaAuthEnabled(false);\n            setIsAuthenticated(true);\n        } finally {\n            setIsLoading(false);\n        }\n    };\n\n    const handleLoginSuccess = (token: string, username: string) => {\n        setIsAuthenticated(true);\n    };\n\n    const handleLogout = () => {\n        localStorage.removeItem(\"beta_auth_token\");\n        localStorage.removeItem(\"beta_auth_username\");\n        setIsAuthenticated(false);\n    };\n\n    if (isLoading) {\n        return <div>Loading...</div>;\n    }\n\n    if (betaAuthEnabled && !isAuthenticated) {\n        return <BetaLogin onLoginSuccess={handleLoginSuccess} />;\n    }\n\n    return <>{children}</>;\n};\n\nexport default BetaAuthWrapper;\n","import React from \"react\";\nimport ReactDOM from \"react-dom/client\";\nimport { createHashRouter, RouterProvider } from \"react-router-dom\";\nimport { I18nextProvider } from \"react-i18next\";\nimport { HelmetProvider } from \"react-helmet-async\";\nimport { initializeIcons } from \"@fluentui/react\";\nimport { MsalProvider } from \"@azure/msal-react\";\nimport { AuthenticationResult, EventType, PublicClientApplication } from \"@azure/msal-browser\";\n\nimport \"./index.css\";\n\nimport Chat from \"./pages/chat/Chat\";\nimport LayoutWrapper from \"./layoutWrapper\";\nimport i18next from \"./i18n/config\";\nimport { msalConfig, useLogin } from \"./authConfig\";\nimport BetaAuthWrapper from \"./components/BetaAuthWrapper\";\n\ninitializeIcons();\n\nconst router = createHashRouter([\n    {\n        path: \"/\",\n        element: <LayoutWrapper />,\n        children: [\n            {\n                index: true,\n                element: <Chat />\n            },\n            {\n                path: \"qa\",\n                lazy: () => import(\"./pages/ask/Ask\")\n            },\n            {\n                path: \"*\",\n                lazy: () => import(\"./pages/NoPage\")\n            }\n        ]\n    }\n]);\n\nconst root = ReactDOM.createRoot(document.getElementById(\"root\") as HTMLElement);\n\n// Bootstrap the app once; conditionally wrap with MsalProvider when login is enabled\n(async () => {\n    let msalInstance: PublicClientApplication | undefined;\n\n    if (useLogin) {\n        msalInstance = new PublicClientApplication(msalConfig);\n        try {\n            await msalInstance.initialize();\n\n            // Default active account to the first one if none is set\n            if (!msalInstance.getActiveAccount() && msalInstance.getAllAccounts().length > 0) {\n                msalInstance.setActiveAccount(msalInstance.getAllAccounts()[0]);\n            }\n\n            // Keep active account in sync on login success\n            msalInstance.addEventCallback(event => {\n                if (event.eventType === EventType.LOGIN_SUCCESS && event.payload) {\n                    const result = event.payload as AuthenticationResult;\n                    if (result.account) {\n                        msalInstance!.setActiveAccount(result.account);\n                    }\n                }\n            });\n        } catch (e) {\n            // Non-fatal: render the app even if MSAL initialization fails\n            // eslint-disable-next-line no-console\n            console.error(\"MSAL initialize failed\", e);\n            msalInstance = undefined;\n        }\n    }\n\n    const appTree = (\n        <React.StrictMode>\n            <I18nextProvider i18n={i18next}>\n                <HelmetProvider>\n                    <BetaAuthWrapper>\n                        {useLogin && msalInstance ? (\n                            <MsalProvider instance={msalInstance}>\n                                <RouterProvider router={router} />\n                            </MsalProvider>\n                        ) : (\n                            <RouterProvider router={router} />\n                        )}\n                    </BetaAuthWrapper>\n                </HelmetProvider>\n            </I18nextProvider>\n        </React.StrictMode>\n    );\n\n    root.render(appTree);\n})();\n"],"file":"assets/index-DO-zPLG9.js"}